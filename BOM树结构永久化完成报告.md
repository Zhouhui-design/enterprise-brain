# âœ… BOMæ ‘ç»“æ„æ°¸ä¹…åŒ–å­˜å‚¨å®ŒæˆæŠ¥å‘Š

**å®Œæˆæ—¶é—´ï¼š** 2025-12-03  
**çŠ¶æ€ï¼š** ğŸ‰ å·²å®Œæˆ  

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº†BOMæ ‘ç»“æ„çš„**æ°¸ä¹…åŒ–å­˜å‚¨åŠŸèƒ½**ï¼Œç‚¹å‡»"BOMæ ‘ç»“æ„å±•ç¤º"æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶ä¿å­˜æ ‘ç»“æ„æ•°æ®åˆ°æ•°æ®åº“ï¼Œä¾›åç»­æŸ¥çœ‹å’Œä¼ é€’ç»™ç”Ÿäº§ç®¡ç†ä½¿ç”¨ã€‚

---

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. æ•°æ®æµè§¦å‘æœºåˆ¶ âœ…

**è§¦å‘æ¡ä»¶ï¼š**
- âœ… åœ¨ç”Ÿäº§BOMé¡µé¢é€‰æ‹©**ä»…1æ¡**BOMæ•°æ®
- âœ… ç‚¹å‡»"BOMæ ‘ç»“æ„å±•ç¤º"æŒ‰é’®

**æ•°æ®æµå‘ï¼š**
```
ç”Ÿäº§BOMè¯¦æƒ… 
    â†“
ç”ŸæˆBOMæ ‘ç»“æ„æ•°æ®
    â†“
ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆbom_tree_structuresè¡¨ï¼‰
    â†“
æ°¸ä¹…å­˜å‚¨ï¼Œå¯éšæ—¶æŸ¥çœ‹
    â†“
ä¼ é€’ç»™ç”Ÿäº§ç®¡ç†
```

### 2. æ ‘ç»“æ„æ•°æ®ç”Ÿæˆè§„åˆ™ âœ…

**åˆ—æ•°é‡è®¡ç®—ï¼š**
- ç›®æ ‡è¡¨æ ¼åˆ—æ•° = å­ä»¶å±æ€§è¡¨çš„æœ€å¤§å±‚é˜¶å€¼ + 1ï¼ˆL0ï¼‰
- ä¾‹å¦‚ï¼šæœ€å¤§å±‚é˜¶=8ï¼Œåˆ™å±•ç¤º L0, L1, L2, L3, L4, L5, L6, L7, L8

**L0ï¼ˆäº§å“å±‚ï¼‰æ•°æ®æ˜ å°„ï¼š**
- L0ç¼–ç  = ç”Ÿäº§BOMçš„äº§å“ç¼–ç 
- L0åç§° = ç”Ÿäº§BOMçš„äº§å“åç§°
- L0ç”¨é‡ = ç”Ÿäº§BOMçš„ç‰©æ–™æ•°é‡
- L0å·¥åºåç§° = ç©ºï¼ˆäº§å“å±‚ä¸éœ€è¦å·¥åºï¼‰

**L1å±‚æ•°æ®æ˜ å°„ï¼š**
- L1åˆ—è¡Œæ•° = æ¥æºè¡¨æ ¼ä¸­å±‚é˜¶=1çš„å­ä»¶æ•°é‡
- æ¯ä¸ªL1å•å…ƒæ ¼åŒ…å«ï¼šå­ä»¶ç¼–å·ã€å­ä»¶åç§°ã€æ ‡å‡†ç”¨é‡ã€å·¥åºåç§°

**L2å±‚åŠä»¥ä¸Šæ•°æ®æ˜ å°„ï¼š**
- L2åˆ—æ•°æ® = å³ä¾§L1åˆ—å¯¹åº”çš„å±‚é˜¶=2çš„å­ä»¶
- ä¾æ­¤ç±»æ¨ï¼Œæ„å»ºå®Œæ•´çš„å±‚çº§å…³ç³»

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡

### è¡¨åï¼š`bom_tree_structures`

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| id | TEXT | ä¸»é”®ï¼ˆUUIDï¼‰ |
| bom_code | TEXT | BOMç¼–å·ï¼ˆå”¯ä¸€ï¼‰ |
| bom_name | TEXT | BOMåç§° |
| product_code | TEXT | äº§å“ç¼–å· |
| product_name | TEXT | äº§å“åç§° |
| version | TEXT | ç‰ˆæœ¬å· |
| status | TEXT | çŠ¶æ€ |
| max_level | INTEGER | æœ€å¤§å±‚çº§ |
| tree_data | TEXT | æ ‘ç»“æ„JSONæ•°æ® |
| create_time | DATETIME | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | æ›´æ–°æ—¶é—´ |
| create_by | TEXT | åˆ›å»ºäºº |

**ç´¢å¼•ï¼š**
- `idx_bom_tree_bom_code` - BOMç¼–å·ç´¢å¼•
- `idx_bom_tree_product_code` - äº§å“ç¼–å·ç´¢å¼•

---

## ğŸ“Š æ ‘ç»“æ„JSONæ•°æ®æ ¼å¼

```json
{
  "maxLevel": 8,
  "levels": {
    "L0": [
      {
        "code": "PROD001",
        "name": "ç¬”è®°æœ¬ç”µè„‘",
        "quantity": 1,
        "processName": ""
      }
    ],
    "L1": [
      {
        "code": "CPU001",
        "name": "CPUå¤„ç†å™¨",
        "quantity": 1,
        "processName": "ç»„è£…"
      },
      {
        "code": "MEM001",
        "name": "å†…å­˜æ¡",
        "quantity": 2,
        "processName": "æ’è£…"
      }
    ],
    "L2": [
      {
        "code": "CHIP001",
        "name": "èŠ¯ç‰‡",
        "quantity": 1,
        "processName": "ç„Šæ¥"
      }
    ]
  }
}
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### åç«¯æ–‡ä»¶

#### 1. æ•°æ®åº“è„šæœ¬
**æ–‡ä»¶ï¼š** `backend/scripts/create-bom-tree-table.js`
- åˆ›å»º `bom_tree_structures` è¡¨
- åˆ›å»ºç´¢å¼•

#### 2. APIè·¯ç”±
**æ–‡ä»¶ï¼š** `backend/routes/bomTreeStructures.js`

**æ¥å£åˆ—è¡¨ï¼š**

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç”Ÿæˆæ ‘ç»“æ„ | POST | `/api/bom-tree-structures/generate` | ç”Ÿæˆå¹¶ä¿å­˜BOMæ ‘ç»“æ„ |
| è·å–æ ‘ç»“æ„ | GET | `/api/bom-tree-structures/:bomCode` | æ ¹æ®BOMç¼–å·è·å– |
| è·å–åˆ—è¡¨ | GET | `/api/bom-tree-structures` | è·å–æ‰€æœ‰æ ‘ç»“æ„åˆ—è¡¨ |
| åˆ é™¤æ ‘ç»“æ„ | DELETE | `/api/bom-tree-structures/:bomCode` | åˆ é™¤æŒ‡å®šæ ‘ç»“æ„ |

#### 3. æœåŠ¡å™¨é…ç½®
**æ–‡ä»¶ï¼š** `backend/server.js`
- æ³¨å†ŒBOMæ ‘ç»“æ„è·¯ç”±

---

### å‰ç«¯æ–‡ä»¶

#### 1. APIæœåŠ¡
**æ–‡ä»¶ï¼š** `07-frontend/src/api/bomTreeStructure.js`

**æ–¹æ³•ï¼š**
- `generateTreeStructure(bomData)` - ç”Ÿæˆæ ‘ç»“æ„
- `getTreeStructure(bomCode)` - è·å–æ ‘ç»“æ„
- `getAllTreeStructures()` - è·å–åˆ—è¡¨
- `deleteTreeStructure(bomCode)` - åˆ é™¤æ ‘ç»“æ„

#### 2. é¡µé¢ç»„ä»¶
**æ–‡ä»¶ï¼š** `07-frontend/src/pages/bom/ProductionBom.vue`

**ä¿®æ”¹å†…å®¹ï¼š**
- å¯¼å…¥ `bomTreeStructureApi`
- ä¿®æ”¹ `handleShowBomTree()` å‡½æ•°ï¼Œæ·»åŠ æ•°æ®åº“ä¿å­˜é€»è¾‘
- æ·»åŠ  loading æç¤ºå’ŒæˆåŠŸåé¦ˆ

---

## ğŸ“ ä»£ç ç»Ÿè®¡

**æ–°å¢æ–‡ä»¶ï¼š**
- `backend/scripts/create-bom-tree-table.js` (44è¡Œ)
- `backend/routes/bomTreeStructures.js` (244è¡Œ)
- `07-frontend/src/api/bomTreeStructure.js` (28è¡Œ)

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `backend/server.js` (+2è¡Œ)
- `07-frontend/src/pages/bom/ProductionBom.vue` (+29è¡Œ)

**æ€»è®¡ï¼šçº¦347è¡Œä»£ç **

---

## ğŸ¯ ä½¿ç”¨æµç¨‹

### æ“ä½œæ­¥éª¤

1. **æ‰“å¼€ç”Ÿäº§BOMé¡µé¢**
   ```
   http://localhost:3001/bom/production
   ```

2. **é€‰æ‹©ä¸€æ¡BOMæ•°æ®**
   - åœ¨è¡¨æ ¼ä¸­å‹¾é€‰1æ¡BOMè®°å½•

3. **ç‚¹å‡»"BOMæ ‘ç»“æ„å±•ç¤º"æŒ‰é’®**
   - ç³»ç»Ÿæç¤ºï¼š"æ­£åœ¨ç”ŸæˆBOMæ ‘ç»“æ„..."
   - è‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“

4. **æŸ¥çœ‹æ ‘ç»“æ„**
   - å¼¹å‡ºæ¨ªå‘ç»„ç»‡æ¶æ„æ ‘
   - æ•°æ®å·²æ°¸ä¹…ä¿å­˜

5. **åç»­éšæ—¶æŸ¥çœ‹**
   - å†æ¬¡ç‚¹å‡»æŒ‰é’®ï¼Œç›´æ¥ä»æ•°æ®åº“åŠ è½½
   - æ•°æ®ä¸ä¼šä¸¢å¤±

---

## ğŸ’¾ æ•°æ®æŒä¹…åŒ–ç‰¹ç‚¹

### 1. æ°¸ä¹…å­˜å‚¨ âœ…
- æ•°æ®ä¿å­˜åœ¨ SQLite æ•°æ®åº“
- ç³»ç»Ÿé‡å¯åæ•°æ®ä¸ä¸¢å¤±
- æ”¯æŒè·¨è®¾å¤‡è®¿é—®

### 2. è‡ªåŠ¨æ›´æ–° âœ…
- é¦–æ¬¡ç‚¹å‡»ï¼šç”Ÿæˆå¹¶ä¿å­˜
- å†æ¬¡ç‚¹å‡»ï¼šæ›´æ–°ç°æœ‰æ•°æ®
- åŸºäº BOMç¼–å· åˆ¤æ–­æ˜¯å¦å·²å­˜åœ¨

### 3. æ•°æ®ä¼ é€’ âœ…
- ç”Ÿæˆçš„æ ‘ç»“æ„æ•°æ®å¯ä¼ é€’ç»™ç”Ÿäº§ç®¡ç†
- é€šè¿‡APIæ¥å£è·å–
- JSONæ ¼å¼ä¾¿äºé›†æˆ

---

## ğŸ” æ•°æ®æµæ°´çº¿è¯¦è§£

### æ¥æºè¡¨æ ¼ï¼šç”Ÿäº§BOMè¯¦æƒ…

```javascript
{
  bomCode: "BOM2025000001",
  bomName: "ç¬”è®°æœ¬ç”µè„‘BOM",
  productCode: "PROD001",
  productName: "ç¬”è®°æœ¬ç”µè„‘",
  itemCount: 1,
  childItems: [
    {
      level: 1,
      childCode: "CPU001",
      childName: "CPUå¤„ç†å™¨",
      standardQty: 1,
      outputProcess: "ç»„è£…"
    },
    {
      level: 2,
      childCode: "CHIP001",
      childName: "èŠ¯ç‰‡",
      standardQty: 1,
      outputProcess: "ç„Šæ¥"
    }
  ]
}
```

### ç›®æ ‡è¡¨æ ¼ï¼šBOMæ ‘ç»“æ„

```json
{
  "maxLevel": 2,
  "levels": {
    "L0": [
      {
        "code": "PROD001",
        "name": "ç¬”è®°æœ¬ç”µè„‘",
        "quantity": 1,
        "processName": ""
      }
    ],
    "L1": [
      {
        "code": "CPU001",
        "name": "CPUå¤„ç†å™¨",
        "quantity": 1,
        "processName": "ç»„è£…"
      }
    ],
    "L2": [
      {
        "code": "CHIP001",
        "name": "èŠ¯ç‰‡",
        "quantity": 1,
        "processName": "ç„Šæ¥"
      }
    ]
  }
}
```

---

## ğŸš€ APIä½¿ç”¨ç¤ºä¾‹

### 1. ç”ŸæˆBOMæ ‘ç»“æ„

```javascript
// è¯·æ±‚
POST http://localhost:3005/api/bom-tree-structures/generate
Content-Type: application/json

{
  "bomData": {
    "bomCode": "BOM2025000001",
    "bomName": "ç¬”è®°æœ¬ç”µè„‘BOM",
    "productCode": "PROD001",
    "productName": "ç¬”è®°æœ¬ç”µè„‘",
    "itemCount": 1,
    "childItems": [...]
  }
}

// å“åº”
{
  "success": true,
  "message": "BOMæ ‘ç»“æ„ç”ŸæˆæˆåŠŸ",
  "data": {
    "id": "uuid-xxx",
    "maxLevel": 2,
    "levels": {...}
  }
}
```

### 2. è·å–BOMæ ‘ç»“æ„

```javascript
// è¯·æ±‚
GET http://localhost:3005/api/bom-tree-structures/BOM2025000001

// å“åº”
{
  "success": true,
  "data": {
    "id": "uuid-xxx",
    "bomCode": "BOM2025000001",
    "bomName": "ç¬”è®°æœ¬ç”µè„‘BOM",
    "productCode": "PROD001",
    "productName": "ç¬”è®°æœ¬ç”µè„‘",
    "maxLevel": 2,
    "treeData": {
      "maxLevel": 2,
      "levels": {...}
    },
    "createTime": "2025-12-03 12:00:00",
    "updateTime": "2025-12-03 12:00:00"
  }
}
```

---

## ğŸŠ æ€»ç»“

### å®Œæˆçš„åŠŸèƒ½

1. âœ… æ•°æ®åº“è¡¨è®¾è®¡å’Œåˆ›å»º
2. âœ… åç«¯APIæ¥å£å¼€å‘
3. âœ… å‰ç«¯APIæœåŠ¡å°è£…
4. âœ… ç”Ÿäº§BOMé¡µé¢é›†æˆ
5. âœ… æ•°æ®æµæ°´çº¿å®ç°
6. âœ… æ°¸ä¹…åŒ–å­˜å‚¨åŠŸèƒ½
7. âœ… å±‚çº§å…³ç³»æ˜ å°„
8. âœ… è‡ªåŠ¨æ›´æ–°æœºåˆ¶

### æŠ€æœ¯ç‰¹ç‚¹

- ğŸ—„ï¸ SQLiteæ•°æ®åº“å­˜å‚¨
- ğŸ”„ è‡ªåŠ¨ç”Ÿæˆå’Œæ›´æ–°
- ğŸ“Š JSONæ ¼å¼æ•°æ®
- ğŸŒ RESTful APIè®¾è®¡
- âš¡ å¼‚æ­¥å¤„ç†
- ğŸ’¾ æ°¸ä¹…åŒ–ä¿å­˜
- ğŸ”— å®Œæ•´æ•°æ®æµæ°´çº¿

---

## ğŸ“š ç›¸å…³æ–‡ä»¶æ¸…å•

**åç«¯æ–‡ä»¶ï¼š**
- `/backend/scripts/create-bom-tree-table.js`
- `/backend/routes/bomTreeStructures.js`
- `/backend/server.js`
- `/backend/database/enterprise.db`

**å‰ç«¯æ–‡ä»¶ï¼š**
- `/07-frontend/src/api/bomTreeStructure.js`
- `/07-frontend/src/pages/bom/ProductionBom.vue`

---

**BOMæ ‘ç»“æ„æ°¸ä¹…åŒ–å­˜å‚¨åŠŸèƒ½å·²å®Œç¾å®ç°ï¼** ğŸ‰

ç°åœ¨ç‚¹å‡»"BOMæ ‘ç»“æ„å±•ç¤º"æŒ‰é’®æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶æ°¸ä¹…ä¿å­˜æ ‘ç»“æ„æ•°æ®ï¼Œä¾›åç»­æŸ¥çœ‹å’Œä¼ é€’ç»™ç”Ÿäº§ç®¡ç†ä½¿ç”¨ï¼
