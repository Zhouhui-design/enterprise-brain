# 恢复到14:38分备份报告

**恢复时间**: 2025-12-15 19:16  
**目标版本**: 2025-12-15 14:37:49  
**提交哈希**: 6704ed2

---

## ✅ 恢复结果

### 代码状态
- ✅ **成功恢复到14:37分提交**
- 提交信息: `feat: 修正工序计划菜单命名，删除重复的喷塑工序计划路由`
- 分支: `feature-3`
- 工作区: **干净** (无未提交变更)

### 数据库状态 (恢复后)

#### 备料计划
```
来源工序: 打包
总数: 1条
需补货数: 1条
```

#### 工序计划表
```
打包工序计划 (packing_process_plans): 2条
组装工序计划 (assembly_process_plans): 0条
喷塑工序计划 (spray_painting_process_plans): 204条 ⚠️
缝纫工序计划 (sewing_process_plans): 0条
```

---

## ⚠️ 重要发现

### 问题1: 喷塑工序计划数据异常
- **当前**: 204条数据
- **预期**: 0条数据 (因为备料计划只有1条打包工序)
- **原因**: 这是旧数据残留

### 问题2: 数据库与代码不同步
- **代码**: 已恢复到14:37分
- **数据库**: 仍然包含之前测试的数据
- **说明**: Git只恢复代码,不恢复数据库

---

## 📋 恢复操作记录

### 执行的命令
```bash
# 1. 查找14:37分的提交
git log --all --oneline --date=format:'%Y-%m-%d %H:%M:%S' --pretty=format:'%h - %ad - %s' | grep "2025-12-15"

# 2. 重置到目标提交
git reset --hard 6704ed2

# 3. 验证状态
git log -1
git status

# 4. 检查数据库
/tmp/check_all_process_plans.sh
```

### 丢弃的变更
以下文件的修改已被丢弃:
- ❌ `.vscode/launch.json` (新文件)
- ❌ `backend/config/processTypes.js` (修改)
- ❌ `backend/diagnose-material-push.js` (新文件)
- ❌ `backend/manual-push-test.js` (新文件)
- ❌ `backend/services/materialPreparationPlanService.js` (修改)
- ❌ `backend/services/realProcessPlanService.js` (修改)
- ❌ 多个文档和备份文件

---

## 💡 下一步建议

### 选项A: 清理数据库 (推荐)
1. 清空所有工序计划表
2. 清空备料计划表
3. 从销售订单重新开始测试

### 选项B: 保留数据库
- 直接在当前数据库状态下继续开发
- 风险: 可能有旧数据冲突

### 选项C: 恢复数据库备份
- 如果有14:37分的数据库备份,可以恢复
- 需要确认备份文件路径

---

## 🔍 快速诊断命令

### 查看当前代码版本
```bash
cd /home/sardenesy/ai_workspaces/ai_desktop_3
git log -1 --oneline
```

### 查看数据库状态
```bash
/tmp/check_all_process_plans.sh
```

### 清空所有工序计划表 (谨慎操作)
```bash
mysql -u root -p'zH754277289hUi~197547' enterprise_brain -e "
TRUNCATE TABLE packing_process_plans;
TRUNCATE TABLE assembly_process_plans;
TRUNCATE TABLE spray_painting_process_plans;
TRUNCATE TABLE sewing_process_plans;
TRUNCATE TABLE material_preparation_plans;
"
```

---

## ✅ 恢复成功确认

- [x] 代码已恢复到14:37:49
- [x] 工作区干净无变更
- [x] Git状态正常
- [ ] 数据库需要单独处理 (可选)

---

**报告生成时间**: 2025-12-15 19:16  
**操作人**: AI助手  
**风险等级**: 低 (仅代码恢复,数据库未动)
