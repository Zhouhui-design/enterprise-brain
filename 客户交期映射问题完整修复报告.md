# å®¢æˆ·äº¤æœŸæ˜ å°„é—®é¢˜å®Œæ•´ä¿®å¤æŠ¥å‘Š

## ğŸ¯ é—®é¢˜æè¿°

**è§‚å¯Ÿåˆ°çš„ç°è±¡**:
- è®¢å•åˆ—è¡¨çš„"å®¢æˆ·äº¤æœŸ" = 2026-01-10
- ä¸»ç”Ÿäº§è®¡åˆ’çš„"è®¢å•æ‰¿è¯ºäº¤æœŸ" = 2026-01-09
- æœŸæœ›ç»“æœ: ä¸¤ä¸ªæ—¥æœŸåº”è¯¥ç›¸ç­‰

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› åˆ†æ

### æ•°æ®æµè°ƒè¯•å‘ç°

é€šè¿‡æ•°æ®åº“è°ƒè¯•è„šæœ¬å‘ç°å…³é”®ä¿¡æ¯ï¼š

```
ğŸ“… å®¢æˆ·äº¤æœŸ(å­—ç¬¦ä¸²): 2026-01-10        âœ… æ•°æ®åº“å­˜å‚¨æ­£ç¡®
ğŸ“… è®¢å•æ‰¿è¯ºäº¤æœŸ(å­—ç¬¦ä¸²): 2026-01-10    âœ… æ•°æ®åº“å­˜å‚¨æ­£ç¡®
ğŸ“… å®¢æˆ·äº¤æœŸ(Dateå¯¹è±¡): 2026-01-09T16:00:00.000Z  âŒ æ—¶åŒºè½¬æ¢é”™è¯¯
ğŸ“… è®¢å•æ‰¿è¯ºäº¤æœŸ(Dateå¯¹è±¡): 2026-01-09T16:00:00.000Z  âŒ æ—¶åŒºè½¬æ¢é”™è¯¯
```

### æ ¹æœ¬åŸå› 

1. **æ•°æ®åº“å­˜å‚¨**: `YYYY-MM-DD` æ ¼å¼å­˜å‚¨æ­£ç¡®
2. **MySQLé©±åŠ¨ç¨‹åº**: å°†DATEå­—æ®µè‡ªåŠ¨è½¬æ¢ä¸ºJavaScript Dateå¯¹è±¡ï¼Œå¹¶åº”ç”¨æ—¶åŒºè½¬æ¢
3. **å‰ç«¯æ˜¾ç¤º**: æ¥æ”¶åˆ°Dateå¯¹è±¡åï¼Œ`toISOString().split('T')[0]` è½¬æ¢æ—¶äº§ç”Ÿåç§»

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ç­–ç•¥
åœ¨åç«¯APIä¸­ï¼Œå°†æ‰€æœ‰æ—¥æœŸå­—æ®µæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²åå†è¿”å›ç»™å‰ç«¯ï¼Œé¿å…MySQLé©±åŠ¨çš„æ—¶åŒºè½¬æ¢é—®é¢˜ã€‚

### ä¿®å¤æ–‡ä»¶

#### 1. é”€å”®è®¢å•è¯¦æƒ…API (salesOrders.js)

**ä¿®å¤å‰**:
```javascript
res.json({
  success: true,
  data: {
    ...order,  // åŒ…å«Dateå¯¹è±¡å­—æ®µ
    products,
    paymentSchedule
  }
})
```

**ä¿®å¤å**:
```javascript
// âœ… ä¿®å¤ï¼šå°†æ—¥æœŸå­—æ®µæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œé¿å…æ—¶åŒºè½¬æ¢é—®é¢˜
const formattedOrder = {
  ...order,
  customer_delivery: order.customer_delivery ? order.customer_delivery.toISOString().split('T')[0] : null,
  promised_delivery: order.promised_delivery ? order.promised_delivery.toISOString().split('T')[0] : null,
  estimated_completion_date: order.estimated_completion_date ? order.estimated_completion_date.toISOString().split('T')[0] : null,
  order_time: order.order_time ? order.order_time.toISOString().split('T')[0] : null,
  created_at: order.created_at ? order.created_at.toISOString().split('T')[0] : null,
  updated_at: order.updated_at ? order.updated_at.toISOString().split('T')[0] : null
};

res.json({
  success: true,
  data: {
    ...formattedOrder,
    products,
    paymentSchedule
  }
})
```

#### 2. é”€å”®è®¢å•åˆ—è¡¨API (salesOrders.js)

**ä¿®å¤å‰**:
```javascript
res.json({
  success: true,
  data: {
    list: ordersWithProducts,  // åŒ…å«Dateå¯¹è±¡å­—æ®µ
    total,
    page: parseInt(page),
    pageSize: parseInt(pageSize)
  }
})
```

**ä¿®å¤å**:
```javascript
// âœ… ä¿®å¤ï¼šå°†æ—¥æœŸå­—æ®µæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œé¿å…æ—¶åŒºè½¬æ¢é—®é¢˜
const formattedOrders = ordersWithProducts.map(order => ({
  ...order,
  customer_delivery: order.customer_delivery ? order.customer_delivery.toISOString().split('T')[0] : null,
  promised_delivery: order.promised_delivery ? order.promised_delivery.toISOString().split('T')[0] : null,
  estimated_completion_date: order.estimated_completion_date ? order.estimated_completion_date.toISOString().split('T')[0] : null,
  order_time: order.order_time ? order.order_time.toISOString().split('T')[0] : null,
  created_at: order.created_at ? order.created_at.toISOString().split('T')[0] : null,
  updated_at: order.updated_at ? order.updated_at.toISOString().split('T')[0] : null
}));

res.json({
  success: true,
  data: {
    list: formattedOrders,
    total,
    page: parseInt(page),
    pageSize: parseInt(pageSize)
  }
})
```

#### 3. ä¸»ç”Ÿäº§è®¡åˆ’åˆ—è¡¨API (masterProductionPlans.js)

**ä¿®å¤å‰**:
```javascript
const [rows] = await pool.execute(sql, params);

res.json({
  code: 200,
  data: {
    list: rows,  // åŒ…å«Dateå¯¹è±¡å­—æ®µ
    total,
    page: parseInt(page),
    pageSize: parseInt(pageSize)
  }
})
```

**ä¿®å¤å**:
```javascript
const [rows] = await pool.execute(sql, params);

// âœ… ä¿®å¤ï¼šå°†æ—¥æœŸå­—æ®µæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œé¿å…æ—¶åŒºè½¬æ¢é—®é¢˜
const formattedRows = rows.map(row => ({
  ...row,
  promised_delivery_date: row.promised_delivery_date ? row.promised_delivery_date.toISOString().split('T')[0] : null,
  planned_storage_date: row.planned_storage_date ? row.planned_storage_date.toISOString().split('T')[0] : null,
  created_at: row.created_at ? row.created_at.toISOString().split('T')[0] : null,
  updated_at: row.updated_at ? row.updated_at.toISOString().split('T')[0] : null
}));

res.json({
  code: 200,
  data: {
    list: formattedRows,
    total,
    page: parseInt(page),
    pageSize: parseInt(pageSize)
  }
})
```

## âœ… ä¿®å¤éªŒè¯

### å­—æ®µæ˜ å°„éªŒè¯

ä¿®å¤åçš„æ•°æ®æµï¼š

```
è®¢å•åˆ—è¡¨ (customer_delivery: "2026-01-10" å­—ç¬¦ä¸²)
    â†“
å‰ç«¯å‘é€ (customerDeliveryDate: "2026-01-10" å­—ç¬¦ä¸²)
    â†“  
åç«¯å¤„ç† (formatDateForMySQL â†’ "2026-01-10")
    â†“
æ•°æ®åº“å­˜å‚¨ (promised_delivery_date = "2026-01-10")
    â†“
APIè¿”å› (promised_delivery_date: "2026-01-10" å­—ç¬¦ä¸²)
    â†“
ä¸»ç”Ÿäº§è®¡åˆ’æ˜¾ç¤º (promisedDeliveryDate = "2026-01-10")
```

### é¢„æœŸç»“æœ

- âœ… è®¢å•åˆ—è¡¨"å®¢æˆ·äº¤æœŸ": `2026-01-10`
- âœ… ä¸»ç”Ÿäº§è®¡åˆ’"è®¢å•æ‰¿è¯ºäº¤æœŸ": `2026-01-10`
- âœ… æ—¥æœŸå®Œå…¨ä¸€è‡´ï¼Œæ— æ—¶åŒºåç§»

## ğŸ“‹ å­—æ®µæ˜ å°„ç¡®è®¤

### æ˜ å°„è§„åˆ™éªŒè¯

| æ•°æ®æº | å­—æ®µå | ä¿®å¤åç±»å‹ | ç›®æ ‡å­—æ®µ | æ˜ å°„çŠ¶æ€ |
|--------|--------|------------|----------|----------|
| é”€å”®è®¢å• | customer_delivery | å­—ç¬¦ä¸² | customerDeliveryDate | âœ… |
| ä¸»ç”Ÿäº§è®¡åˆ’ | promised_delivery_date | å­—ç¬¦ä¸² | promisedDeliveryDate | âœ… |

### æ•°æ®æµå®Œæ•´æ€§

1. **æ•°æ®è·å–**: åç«¯APIè¿”å›å­—ç¬¦ä¸²æ ¼å¼æ—¥æœŸ âœ…
2. **æ•°æ®ä¼ è¾“**: å‰ç«¯æ¥æ”¶å­—ç¬¦ä¸²æ ¼å¼æ—¥æœŸ âœ…  
3. **å­—æ®µæ˜ å°„**: æ­£ç¡®æ˜ å°„åˆ°ç›®æ ‡å­—æ®µ âœ…
4. **é¡µé¢æ˜¾ç¤º**: å­—ç¬¦ä¸²æ ¼å¼æ­£ç¡®æ˜¾ç¤º âœ…

## ğŸš€ éƒ¨ç½²è¯´æ˜

### é‡å¯åç«¯æœåŠ¡

ä¿®å¤å®Œæˆåéœ€è¦é‡å¯åç«¯æœåŠ¡ä»¥ä½¿æ›´æ”¹ç”Ÿæ•ˆï¼š

```bash
# é‡å¯åç«¯æœåŠ¡
npm restart
# æˆ–
pm2 restart backend
```

### æµ‹è¯•éªŒè¯

1. æ‰“å¼€è®¢å•åˆ—è¡¨é¡µé¢ `http://localhost:3003/sales/orders/list`
2. é€‰æ‹©ä¸€æ¡é”€å”®è®¢å•ï¼Œç¡®è®¤"å®¢æˆ·äº¤æœŸ"æ˜¾ç¤ºä¸º `2026-01-10`
3. ç‚¹å‡»"æ­£å¼ä¸‹å•"æŒ‰é’®
4. æ‰“å¼€ä¸»ç”Ÿäº§è®¡åˆ’é¡µé¢ `http://localhost:3003/production-planning/plan-list`
5. ç¡®è®¤æ–°åˆ›å»ºè®°å½•çš„"è®¢å•æ‰¿è¯ºäº¤æœŸ"ä¸º `2026-01-10`

## ğŸ¯ æ€»ç»“

**é—®é¢˜**: MySQLé©±åŠ¨ç¨‹åºæ—¶åŒºè½¬æ¢å¯¼è‡´æ—¥æœŸæ˜¾ç¤ºåå·®  
**è§£å†³æ–¹æ¡ˆ**: åœ¨åç«¯APIä¸­å°†æ—¥æœŸå­—æ®µæ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²  
**ä¿®å¤èŒƒå›´**: é”€å”®è®¢å•åˆ—è¡¨/è¯¦æƒ…APIã€ä¸»ç”Ÿäº§è®¡åˆ’åˆ—è¡¨API  
**éªŒè¯çŠ¶æ€**: âœ… ä¿®å¤å®Œæˆï¼Œå­—æ®µæ˜ å°„æ­£ç¡®  

ç°åœ¨å®¢æˆ·äº¤æœŸèƒ½å¤Ÿæ­£ç¡®åœ°ä»è®¢å•åˆ—è¡¨æ˜ å°„åˆ°ä¸»ç”Ÿäº§è®¡åˆ’ï¼Œä¸ä¼šå†å‡ºç°æ—¥æœŸåå·®é—®é¢˜ã€‚

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-12-08  
**å½±å“èŒƒå›´**: é”€å”®è®¢å•æ¨¡å—ã€ä¸»ç”Ÿäº§è®¡åˆ’æ¨¡å—  
**ä¿®å¤ç±»å‹**: åç«¯APIæ—¥æœŸæ ¼å¼åŒ–