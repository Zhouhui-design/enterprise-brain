# å¸¸è§é—®é¢˜ï¼šè®¡åˆ’æ—¥æœŸæœªæŒ‰è§„åˆ™ç”Ÿæˆ

## é—®é¢˜åˆ†ç±»

### é—®é¢˜1ï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸä¸ºnull

**ç—‡çŠ¶**ï¼š
```
é¢„æœŸï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸ = 2025-12-31
å®é™…ï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸ = null
```

**å¯èƒ½åŸå› **ï¼š

#### åŸå› 1ï¼šå·¥åºèƒ½åŠ›è´Ÿè·è¡¨æ•°æ®ä¸è¶³
```sql
-- æ£€æŸ¥SQL
SELECT process_name, date, remaining_hours
FROM process_capacity_load
WHERE process_name = 'ç„Šæ¥'
  AND date BETWEEN '2025-12-01' AND '2026-01-06'
  AND remaining_hours >= 0.5
ORDER BY date DESC;

-- å¦‚æœè¿”å›è®°å½• < 5æ¡ï¼Œå¯èƒ½æ•°æ®ä¸è¶³
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ‰“å¼€å·¥åºèƒ½åŠ›è´Ÿè·è¡¨é¡µé¢
2. ç‚¹å‡»"ä»å·¥åºåŠ è½½"æŒ‰é’®
3. é€‰æ‹©ç›¸åº”å·¥åº
4. ç”Ÿæˆè¶³å¤Ÿçš„æ—¥æœŸæ•°æ®

#### åŸå› 2ï¼šå‰©ä½™å·¥æ—¶é—¨æ§›å€¼è®¾ç½®è¿‡é«˜
```
å¦‚æœé—¨æ§›å€¼ = 5.0ï¼Œä½†å¤§éƒ¨åˆ†è®°å½•å‰©ä½™å·¥æ—¶ < 5.0
åˆ™æ— æ³•æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„è®°å½•
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ‰“å¼€çœŸå·¥åºè®¡åˆ’é¡µé¢è®¾ç½®
2. æŸ¥çœ‹"ä¸šåŠ¡å˜é‡" â†’ "å‰©ä½™å·¥æ—¶å°äº"
3. è°ƒæ•´ä¸ºåˆç†å€¼ï¼ˆå»ºè®®0.5-1.0ï¼‰

#### åŸå› 3ï¼šç´¯åŠ å·¥æ—¶ä¸è¶³
```
éœ€æ±‚å·¥æ—¶ = 20å°æ—¶
ä½†å·¥åºèƒ½åŠ›è´Ÿè·è¡¨ä¸­ç¬¦åˆæ¡ä»¶çš„å‰©ä½™å·¥æ—¶æ€»å’Œ < 20å°æ—¶
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```sql
-- è®¡ç®—æ€»å‰©ä½™å·¥æ—¶
SELECT 
  process_name,
  SUM(remaining_hours) as total_remaining
FROM process_capacity_load
WHERE process_name = 'ç„Šæ¥'
  AND date BETWEEN '2025-12-01' AND '2026-01-06'
  AND remaining_hours >= 0.5
GROUP BY process_name;
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å¢åŠ å¯ç”¨å·¥ä½æ•°é‡
2. æ‰©å¤§æ—¥æœŸèŒƒå›´
3. è°ƒæ•´éœ€æ±‚å·¥æ—¶è®¡ç®—å…¬å¼

#### åŸå› 4ï¼šå·¥åºåç§°ä¸åŒ¹é…
```
å‰ç«¯ï¼šprocessName = "ç„Šæ¥ "ï¼ˆæœ«å°¾æœ‰ç©ºæ ¼ï¼‰
æ•°æ®åº“ï¼šprocess_name = "ç„Šæ¥"
ç»“æœï¼šæ— æ³•åŒ¹é…
```

**æ’æŸ¥æ–¹æ³•**ï¼š
```javascript
// åœ¨æµè§ˆå™¨Consoleä¸­æ£€æŸ¥
console.log('å·¥åºåç§°:', JSON.stringify(formData.value.processName))
// å¦‚æœè¾“å‡ºï¼š"ç„Šæ¥ " è¯´æ˜æœ‰å¤šä½™ç©ºæ ¼
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
```javascript
// åœ¨æŸ¥è¯¢å‰trim
const trimmedProcessName = processName.trim()
```

### é—®é¢˜2ï¼šè®¡åˆ’ç»“æŸæ—¥æœŸä¸ºnull

**ç—‡çŠ¶**ï¼š
```
é¢„æœŸï¼šè®¡åˆ’ç»“æŸæ—¥æœŸ = 2026-01-06
å®é™…ï¼šè®¡åˆ’ç»“æŸæ—¥æœŸ = null
```

**å¯èƒ½åŸå› **ï¼š

#### åŸå› 1ï¼šéœ€æ±‚å·¥æ—¶ä¸º0
```javascript
éœ€æ±‚å·¥æ—¶ = éœ€è¡¥è´§æ•°é‡ / å®šæ—¶å·¥é¢
å¦‚æœ å®šæ—¶å·¥é¢ = 0ï¼Œåˆ™ éœ€æ±‚å·¥æ—¶ = Infinity
å¦‚æœ éœ€è¡¥è´§æ•°é‡ = 0ï¼Œåˆ™ éœ€æ±‚å·¥æ—¶ = 0
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥éœ€è¡¥è´§æ•°é‡ > 0
2. æ£€æŸ¥å®šæ—¶å·¥é¢ > 0
3. ç¡®è®¤è®¡ç®—å…¬å¼æ­£ç¡®

#### åŸå› 2ï¼šè®¡åˆ’å®Œå·¥æ—¥æœŸæ— æ•ˆ
```
è®¡åˆ’å®Œå·¥æ—¥æœŸ = null
æˆ–
è®¡åˆ’å®Œå·¥æ—¥æœŸ < ç³»ç»Ÿå½“å‰æ—¥æœŸï¼ˆå·²è¿‡æœŸï¼‰
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®è®¤è®¡åˆ’å®Œå·¥æ—¥æœŸå·²å¡«å†™
2. ç¡®è®¤æ—¥æœŸæ ¼å¼æ­£ç¡®ï¼ˆYYYY-MM-DDï¼‰
3. ç¡®è®¤æ—¥æœŸæœªè¿‡æœŸ

#### åŸå› 3ï¼šå·¥åºèƒ½åŠ›è´Ÿè·è¡¨æ— è¯¥å·¥åº
```sql
SELECT COUNT(*) as count
FROM process_capacity_load
WHERE process_name = 'ç„Šæ¥';
-- å¦‚æœ count = 0ï¼Œè¯´æ˜æœªåŠ è½½è¯¥å·¥åº
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
å‚è§é—®é¢˜1åŸå› 1çš„è§£å†³æ–¹æ¡ˆ

### é—®é¢˜3ï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸæ™šäºè®¡åˆ’ç»“æŸæ—¥æœŸ

**ç—‡çŠ¶**ï¼š
```
è®¡åˆ’å¼€å§‹æ—¥æœŸ = 2026-01-10
è®¡åˆ’ç»“æŸæ—¥æœŸ = 2026-01-06
é€»è¾‘é”™è¯¯ï¼šå¼€å§‹æ—¥æœŸåº”è¯¥ <= ç»“æŸæ—¥æœŸ
```

**å¯èƒ½åŸå› **ï¼š

#### åŸå› 1ï¼šç´¯åŠ é¡ºåºé”™è¯¯
```javascript
// é”™è¯¯ï¼šä»å°åˆ°å¤§ç´¯åŠ 
for (let i = 0; i < rows.length; i++) { ... }
ORDER BY date ASC  // âŒ å‡åº

// æ­£ç¡®ï¼šä»å¤§åˆ°å°ç´¯åŠ ï¼ˆå€’åºï¼‰
for (let i = 0; i < rows.length; i++) { ... }
ORDER BY date DESC  // âœ… é™åº
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥åç«¯SQLçš„ORDER BYå­å¥ï¼Œç¡®ä¿æ˜¯DESC

#### åŸå› 2ï¼šæ—¥æœŸèŒƒå›´é”™è¯¯
```javascript
// é”™è¯¯ï¼šæŸ¥è¯¢èŒƒå›´è¶…å‡ºè®¡åˆ’ç»“æŸæ—¥æœŸ
WHERE date BETWEEN '2025-12-01' AND '2026-02-01'
// åº”è¯¥é™åˆ¶åœ¨è®¡åˆ’ç»“æŸæ—¥æœŸä¹‹å‰
WHERE date BETWEEN '2025-12-01' AND planEndDate
```

**è§£å†³æ–¹æ¡ˆ**ï¼š
æ£€æŸ¥åç«¯WHEREæ¡ä»¶ï¼Œç¡®ä¿ `date <= planEndDate`

## è¯Šæ–­æµç¨‹å›¾

```mermaid
graph TD
    A[è®¡åˆ’æ—¥æœŸæœªç”Ÿæˆ] --> B{å“ªä¸ªå­—æ®µ?}
    B -->|è®¡åˆ’ç»“æŸæ—¥æœŸ| C{éœ€æ±‚å·¥æ—¶>0?}
    B -->|è®¡åˆ’å¼€å§‹æ—¥æœŸ| D{è®¡åˆ’ç»“æŸæ—¥æœŸæœ‰å€¼?}
    
    C -->|å¦| C1[æ£€æŸ¥éœ€è¡¥è´§æ•°é‡å’Œå®šæ—¶å·¥é¢]
    C -->|æ˜¯| C2{å·¥åºåç§°æ­£ç¡®?}
    C2 -->|å¦| C3[æ£€æŸ¥å·¥åºåç§°æ‹¼å†™]
    C2 -->|æ˜¯| C4{å·¥åºèƒ½åŠ›è´Ÿè·è¡¨æœ‰æ•°æ®?}
    C4 -->|å¦| C5[ä»å·¥åºåŠ è½½æ•°æ®]
    C4 -->|æ˜¯| C6[æ£€æŸ¥å‰©ä½™å·¥æ—¶é—¨æ§›å€¼]
    
    D -->|å¦| D1[å…ˆè§£å†³è®¡åˆ’ç»“æŸæ—¥æœŸé—®é¢˜]
    D -->|æ˜¯| D2{ç´¯åŠ å·¥æ—¶æ˜¯å¦è¶³å¤Ÿ?}
    D2 -->|å¦| D3[å¢åŠ å·¥ä½æˆ–æ‰©å¤§æ—¥æœŸèŒƒå›´]
    D2 -->|æ˜¯| D4{SQLæŸ¥è¯¢æœ‰ç»“æœ?}
    D4 -->|å¦| D5[æ£€æŸ¥åç«¯æ—¥å¿—]
    D4 -->|æ˜¯| D6[æ£€æŸ¥å‰ç«¯å“åº”å¤„ç†]
```

## å¿«é€Ÿæ£€æŸ¥æ¸…å•

åœ¨æäº¤BUGå‰ï¼Œè¯·å®Œæˆä»¥ä¸‹æ£€æŸ¥ï¼š

### å‰ç«¯æ£€æŸ¥
- [ ] æµè§ˆå™¨Consoleæ— JavaScripté”™è¯¯
- [ ] Networké¢æ¿æ˜¾ç¤ºAPIè°ƒç”¨æˆåŠŸï¼ˆ200 OKï¼‰
- [ ] éœ€æ±‚å·¥æ—¶ > 0
- [ ] å·¥åºåç§°ä¸ä¸ºç©º
- [ ] è®¡åˆ’å®Œå·¥æ—¥æœŸæœ‰æ•ˆ
- [ ] è®¡åˆ’ç»“æŸæ—¥æœŸå·²ç”Ÿæˆï¼ˆå¦‚æœæ’æŸ¥è®¡åˆ’å¼€å§‹æ—¥æœŸï¼‰

### åç«¯æ£€æŸ¥
- [ ] backend.logæ— ERRORæ—¥å¿—
- [ ] APIæ¥æ”¶åˆ°çš„å‚æ•°å®Œæ•´
- [ ] SQLæŸ¥è¯¢è¿”å›è®°å½• > 0
- [ ] ç´¯åŠ è®¡ç®—é€»è¾‘æ­£ç¡®
- [ ] å“åº”æ•°æ®æ ¼å¼æ­£ç¡®

### æ•°æ®æ£€æŸ¥
- [ ] å·¥åºèƒ½åŠ›è´Ÿè·è¡¨æœ‰è¯¥å·¥åºæ•°æ®
- [ ] æ—¥æœŸèŒƒå›´è¦†ç›–é¢„æœŸæ—¥æœŸ
- [ ] å‰©ä½™å·¥æ—¶ >= é—¨æ§›å€¼
- [ ] å‰©ä½™å·¥æ—¶æ€»å’Œ >= éœ€æ±‚å·¥æ—¶

## è‡ªåŠ©è¯Šæ–­è„šæœ¬

å°†ä»¥ä¸‹è„šæœ¬å¤åˆ¶åˆ°æµè§ˆå™¨Consoleè¿è¡Œï¼š

```javascript
// ============ è®¡åˆ’æ—¥æœŸè¯Šæ–­è„šæœ¬ ============
(async function diagnose() {
  console.log('ğŸ” å¼€å§‹è¯Šæ–­è®¡åˆ’æ—¥æœŸé—®é¢˜...\n')
  
  // æ£€æŸ¥1ï¼šè¡¨å•æ•°æ®
  console.log('ğŸ“‹ æ£€æŸ¥1ï¼šè¡¨å•æ•°æ®')
  const data = {
    processName: formData.value?.processName,
    completionDate: formData.value?.completionDate,
    requiredWorkHours: formData.value?.requiredWorkHours,
    planEndDate: formData.value?.planEndDate,
    planStartDate: formData.value?.planStartDate
  }
  console.table(data)
  
  if (!data.processName) {
    console.error('âŒ å·¥åºåç§°ä¸ºç©º')
    return
  }
  if (!data.completionDate) {
    console.error('âŒ è®¡åˆ’å®Œå·¥æ—¥æœŸä¸ºç©º')
    return
  }
  if (data.requiredWorkHours <= 0) {
    console.warn('âš ï¸ éœ€æ±‚å·¥æ—¶ä¸º0æˆ–è´Ÿæ•°')
  }
  
  // æ£€æŸ¥2ï¼šè®¡åˆ’ç»“æŸæ—¥æœŸ
  console.log('\nğŸ“‹ æ£€æŸ¥2ï¼šè®¡åˆ’ç»“æŸæ—¥æœŸ')
  try {
    const endDateResponse = await capacityLoadApi.queryPlanEndDate(
      data.processName,
      formatDateYMD(data.completionDate),
      0.5
    )
    console.log('âœ… APIå“åº”:', endDateResponse)
    if (!endDateResponse?.data?.planEndDate) {
      console.error('âŒ æœªæ‰¾åˆ°è®¡åˆ’ç»“æŸæ—¥æœŸ')
      console.log('ğŸ’¡ å»ºè®®ï¼šæ£€æŸ¥å·¥åºèƒ½åŠ›è´Ÿè·è¡¨æ˜¯å¦æœ‰æ•°æ®')
    }
  } catch (error) {
    console.error('âŒ APIè°ƒç”¨å¤±è´¥:', error)
  }
  
  // æ£€æŸ¥3ï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸ
  console.log('\nğŸ“‹ æ£€æŸ¥3ï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸ')
  if (!data.planEndDate) {
    console.error('âŒ è®¡åˆ’ç»“æŸæ—¥æœŸä¸ºç©ºï¼Œæ— æ³•æŸ¥è¯¢è®¡åˆ’å¼€å§‹æ—¥æœŸ')
    return
  }
  
  try {
    const startDateResponse = await capacityLoadApi.queryPlanStartDate(
      data.processName,
      formatDateYMD(data.planEndDate),
      data.requiredWorkHours,
      0.5
    )
    console.log('âœ… APIå“åº”:', startDateResponse)
    if (!startDateResponse?.planStartDate) {
      console.error('âŒ æœªæ‰¾åˆ°è®¡åˆ’å¼€å§‹æ—¥æœŸ')
      console.log('ğŸ’¡ å»ºè®®ï¼šæ£€æŸ¥ç´¯åŠ å·¥æ—¶æ˜¯å¦è¶³å¤Ÿ')
    } else {
      console.log(`âœ… è®¡åˆ’å¼€å§‹æ—¥æœŸ: ${startDateResponse.planStartDate}`)
      console.log(`âœ… ç´¯è®¡å·¥æ—¶: ${startDateResponse.accumulatedHours}`)
    }
  } catch (error) {
    console.error('âŒ APIè°ƒç”¨å¤±è´¥:', error)
  }
  
  console.log('\nğŸ‰ è¯Šæ–­å®Œæˆï¼')
})()
```

## å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 1. æ—¥æœŸè·¨å¹´é—®é¢˜
```
å¦‚æœè®¡åˆ’å®Œå·¥æ—¥æœŸæ˜¯ä¸‹ä¸€å¹´çš„1æœˆï¼Œ
è€Œå½“å‰æ˜¯12æœˆï¼Œ
å¯èƒ½å‡ºç°æ—¥æœŸèŒƒå›´è®¡ç®—é”™è¯¯
```

**çŠ¶æ€**ï¼šå·²ä¿®å¤ï¼ˆ2025-12-11ï¼‰

### 2. æ—¶åŒºé—®é¢˜
```
æœåŠ¡å™¨æ—¶åŒºä¸æµè§ˆå™¨æ—¶åŒºä¸ä¸€è‡´æ—¶ï¼Œ
æ—¥æœŸå¯èƒ½ç›¸å·®1å¤©
```

**è§£å†³æ–¹æ¡ˆ**ï¼šç»Ÿä¸€ä½¿ç”¨æœ¬åœ°æ—¶åŒºæ ¼å¼åŒ–ï¼ˆYYYY-MM-DDï¼‰

### 3. å¹¶å‘é—®é¢˜
```
å¤šä¸ªç”¨æˆ·åŒæ—¶ä¿®æ”¹å·¥åºèƒ½åŠ›è´Ÿè·è¡¨æ—¶ï¼Œ
å¯èƒ½å¯¼è‡´å‰©ä½™å·¥æ—¶è®¡ç®—ä¸å‡†ç¡®
```

**çŠ¶æ€**ï¼šå¾…ä¼˜åŒ–

## ç›¸å…³æ–‡æ¡£

- [çœŸå·¥åºè®¡åˆ’è®¡ç®—è§„åˆ™](../01-æ•°æ®æµè§„åˆ™/03-çœŸå·¥åºè®¡åˆ’è®¡ç®—è§„åˆ™.md)
- [çœŸå·¥åºè®¡åˆ’å­—æ®µæ˜ å°„](../02-å­—æ®µæ˜ å°„å…³ç³»/01-çœŸå·¥åºè®¡åˆ’å­—æ®µæ˜ å°„.md)
- [çœŸå·¥åºè®¡åˆ’è°ƒè¯•æŒ‡å—](../03-è°ƒè¯•æŒ‡å—/01-çœŸå·¥åºè®¡åˆ’è°ƒè¯•æŒ‡å—.md)

## æäº¤BUGæŠ¥å‘Šæ¨¡æ¿

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³ï¼Œè¯·æŒ‰ä»¥ä¸‹æ¨¡æ¿æäº¤BUGï¼š

```markdown
## BUGæ ‡é¢˜
çœŸå·¥åºè®¡åˆ’ - è®¡åˆ’å¼€å§‹æ—¥æœŸæœªæŒ‰è§„åˆ™ç”Ÿæˆ

## å¤ç°æ­¥éª¤
1. æ‰“å¼€çœŸå·¥åºè®¡åˆ’é¡µé¢
2. ç‚¹å‡»æ–°å¢æŒ‰é’®
3. å¡«å†™ä»¥ä¸‹æ•°æ®ï¼š
   - å·¥åºåç§°ï¼šç„Šæ¥
   - éœ€è¡¥è´§æ•°é‡ï¼š100
   - å®šæ—¶å·¥é¢ï¼š10
   - è®¡åˆ’å®Œå·¥æ—¥æœŸï¼š2026-01-06
4. è§‚å¯Ÿè®¡åˆ’å¼€å§‹æ—¥æœŸå­—æ®µ

## é¢„æœŸç»“æœ
è®¡åˆ’å¼€å§‹æ—¥æœŸ = 2025-12-31

## å®é™…ç»“æœ
è®¡åˆ’å¼€å§‹æ—¥æœŸ = null

## ç¯å¢ƒä¿¡æ¯
- é¡µé¢è·¯å¾„ï¼šhttp://localhost:3007/process-planning/real-process-plan
- æµè§ˆå™¨ï¼šChrome 120.0.0
- æ“ä½œç³»ç»Ÿï¼šWindows 11
- åç«¯ç‰ˆæœ¬ï¼š1.0.0

## è¯Šæ–­ä¿¡æ¯
- [ ] å·²è¿è¡Œè‡ªåŠ©è¯Šæ–­è„šæœ¬
- [ ] å·²æ£€æŸ¥æµè§ˆå™¨Console
- [ ] å·²æ£€æŸ¥åç«¯æ—¥å¿—
- [ ] å·²æ£€æŸ¥å·¥åºèƒ½åŠ›è´Ÿè·è¡¨æ•°æ®

## é™„åŠ ä¿¡æ¯
ï¼ˆç²˜è´´è¯Šæ–­è„šæœ¬è¾“å‡ºã€æˆªå›¾ç­‰ï¼‰
```

---

**æœ€åæ›´æ–°**ï¼š2025-12-11  
**ä¿®å¤è®°å½•**ï¼šæ—   
**å¾…ä¼˜åŒ–**ï¼šå¹¶å‘é—®é¢˜
