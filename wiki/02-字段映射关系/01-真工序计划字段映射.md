# çœŸå·¥åºè®¡åˆ’å­—æ®µæ˜ å°„

## é¡µé¢ä¿¡æ¯

- **é¡µé¢è·¯å¾„**ï¼š`http://localhost:3007/process-planning/real-process-plan`
- **å‰ç«¯æ–‡ä»¶**ï¼š`07-frontend/src/pages/production-planning/RealProcessPlanList.vue`
- **æ•°æ®åº“è¡¨**ï¼š`real_process_plans`

## å®Œæ•´å­—æ®µæ˜ å°„è¡¨

| é¡µé¢æ˜¾ç¤ºå­—æ®µ | å‰ç«¯å­—æ®µå | æ•°æ®åº“å­—æ®µå | æ•°æ®ç±»å‹ | æ˜¯å¦è®¡ç®—å­—æ®µ | è¯´æ˜ |
|--------------|------------|--------------|----------|--------------|------|
| è®¡åˆ’ç¼–å· | planNo | plan_no | VARCHAR(50) | å¦ | ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ |
| ä¸»ç”Ÿäº§è®¡åˆ’ç¼–å· | masterPlanNo | master_plan_no | VARCHAR(50) | å¦ | æ¥æºè¿½æº¯ |
| å·¥åºåç§° | processName | process_name | VARCHAR(100) | å¦ | æ‰‹åŠ¨é€‰æ‹©æˆ–è‡ªåŠ¨å¡«å…… |
| æ’ç¨‹æ—¥æœŸ | scheduleDate | schedule_date | DATE | å¦ | æ‰‹åŠ¨è¾“å…¥ |
| æ’ç¨‹æ•°é‡ | scheduleQuantity | schedule_quantity | DECIMAL(10,2) | å¦ | æ‰‹åŠ¨è¾“å…¥ |
| è®¡åˆ’å®Œå·¥æ—¥æœŸ | completionDate | completion_date | DATE | å¦ | æ‰‹åŠ¨è¾“å…¥ |
| äº§å“ç¼–å· | productCode | product_code | VARCHAR(50) | å¦ | æ¥æºè¿½æº¯ |
| äº§å“åç§° | productName | product_name | VARCHAR(200) | å¦ | æ¥æºè¿½æº¯ |
| éœ€è¡¥è´§æ•°é‡ | replenishmentQty | replenishment_qty | DECIMAL(10,2) | å¦ | æ¥æºè¿½æº¯ |
| å®šæ—¶å·¥é¢ | standardWorkQuota | standard_work_quota | DECIMAL(10,2) | å¦ | æ¥æºè¿½æº¯ |
| éœ€æ±‚å·¥æ—¶ | requiredWorkHours | required_work_hours | DECIMAL(10,2) | **æ˜¯** | éœ€è¡¥è´§æ•°é‡ / å®šæ—¶å·¥é¢ |
| **è®¡åˆ’ç»“æŸæ—¥æœŸ** | **planEndDate** | **plan_end_date** | DATE | **æ˜¯** | MAXIFS(å·¥åºèƒ½åŠ›è´Ÿè·è¡¨) |
| **è®¡åˆ’å¼€å§‹æ—¥æœŸ** | **planStartDate** | **plan_start_date** | DATE | **æ˜¯** | åå‘ç´¯åŠ è¿½æº¯ |
| å®¢æˆ·åç§° | customerName | customer_name | VARCHAR(200) | å¦ | æ¥æºè¿½æº¯ |
| æ¥æºç¼–å· | sourceNo | source_no | VARCHAR(50) | å¦ | æ¥æºè¿½æº¯ |
| æ¥æºå·¥åº | sourceProcess | source_process | VARCHAR(100) | å¦ | æ¥æºè¿½æº¯ |
| åˆ›å»ºæ—¶é—´ | createdAt | created_at | DATETIME | å¦ | ç³»ç»Ÿè‡ªåŠ¨ |

## å…³é”®è®¡ç®—å­—æ®µè¯¦è§£

### 1. éœ€æ±‚å·¥æ—¶ï¼ˆrequiredWorkHoursï¼‰

**è®¡ç®—è§„åˆ™**ï¼š
```javascript
éœ€æ±‚å·¥æ—¶ = éœ€è¡¥è´§æ•°é‡ / å®šæ—¶å·¥é¢
```

**å‰ç«¯å®ç°**ï¼ˆè‡ªåŠ¨è§¦å‘ï¼‰ï¼š
- ä½ç½®ï¼š`RealProcessPlanList.vue` ç¬¬533-544è¡Œ
- è§¦å‘æ¡ä»¶ï¼šreplenishmentQty æˆ– standardWorkQuota å˜åŒ–
- å®æ—¶è®¡ç®—å¹¶æ›´æ–°è¡¨å•

**ç¤ºä¾‹**ï¼š
```
éœ€è¡¥è´§æ•°é‡ = 100
å®šæ—¶å·¥é¢ = 10
éœ€æ±‚å·¥æ—¶ = 100 / 10 = 10.0
```

### 2. è®¡åˆ’ç»“æŸæ—¥æœŸï¼ˆplanEndDateï¼‰

**è®¡ç®—è§„åˆ™**ï¼šMAXIFSåå‘æŸ¥è¯¢
```javascript
è®¡åˆ’ç»“æŸæ—¥æœŸ = MAXIFS(
  å·¥åºèƒ½åŠ›è´Ÿè·è¡¨.æ—¥æœŸ,
  å·¥åºèƒ½åŠ›è´Ÿè·è¡¨.å·¥åºåç§° = æœ¬è¡Œå·¥åºåç§°,
  å·¥åºèƒ½åŠ›è´Ÿè·è¡¨.æ—¥æœŸ <= æœ¬è¡Œè®¡åˆ’å®Œå·¥æ—¥æœŸ,
  å·¥åºèƒ½åŠ›è´Ÿè·è¡¨.å‰©ä½™å·¥æ—¶ >= å‰©ä½™å·¥æ—¶é—¨æ§›å€¼
)
```

**å‰ç«¯å­—æ®µå**ï¼š`formData.value.planEndDate`

**æ•°æ®åº“å­—æ®µå**ï¼š`plan_end_date`

**è§¦å‘æ—¶æœº**ï¼š
1. å‰ç«¯ï¼šéœ€æ±‚å·¥æ—¶ã€å·¥åºåç§°ã€è®¡åˆ’å®Œå·¥æ—¥æœŸå˜åŒ–æ—¶ï¼ˆwatchç›‘å¬ï¼‰
2. åç«¯ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ›å»ºçœŸå·¥åºè®¡åˆ’æ—¶

**APIè°ƒç”¨**ï¼š
```javascript
const response = await capacityLoadApi.queryPlanEndDate(
  processName,        // å·¥åºåç§°
  completionDate,     // è®¡åˆ’å®Œå·¥æ—¥æœŸ
  minRemainingHours   // å‰©ä½™å·¥æ—¶é—¨æ§›å€¼ï¼ˆé»˜è®¤0.5ï¼‰
)
formData.value.planEndDate = response.data.planEndDate
```

**å…¸å‹é—®é¢˜**ï¼š
- é—®é¢˜ï¼šè®¡åˆ’ç»“æŸæ—¥æœŸä¸ºnull
- æ’æŸ¥ï¼šæ£€æŸ¥å·¥åºèƒ½åŠ›è´Ÿè·è¡¨ä¸­æ˜¯å¦æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
- è¯¦è§ï¼š[çœŸå·¥åºè®¡åˆ’è°ƒè¯•æŒ‡å—](../03-è°ƒè¯•æŒ‡å—/01-çœŸå·¥åºè®¡åˆ’è°ƒè¯•æŒ‡å—.md)

### 3. è®¡åˆ’å¼€å§‹æ—¥æœŸï¼ˆplanStartDateï¼‰

**è®¡ç®—è§„åˆ™**ï¼šåå‘ç´¯åŠ è¿½æº¯
```javascript
ä»è®¡åˆ’ç»“æŸæ—¥æœŸå‘å‰ç´¯åŠ å‰©ä½™å·¥æ—¶ï¼Œ
ç›´åˆ°ç´¯è®¡å·¥æ—¶ >= éœ€æ±‚å·¥æ—¶ï¼Œ
å½“å‰æ—¥æœŸå³ä¸ºè®¡åˆ’å¼€å§‹æ—¥æœŸ
```

**å‰ç«¯å­—æ®µå**ï¼š`formData.value.planStartDate`

**æ•°æ®åº“å­—æ®µå**ï¼š`plan_start_date`

**è§¦å‘æ—¶æœº**ï¼š
1. å‰ç«¯ï¼šè®¡åˆ’ç»“æŸæ—¥æœŸè®¡ç®—å®Œæˆåè‡ªåŠ¨è§¦å‘
2. åç«¯ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ›å»ºçœŸå·¥åºè®¡åˆ’æ—¶ï¼ˆéœ€è¡¥å……å®ç°ï¼‰

**APIè°ƒç”¨**ï¼š
```javascript
const response = await capacityLoadApi.queryPlanStartDate(
  processName,        // å·¥åºåç§°
  planEndDate,        // è®¡åˆ’ç»“æŸæ—¥æœŸ
  requiredWorkHours,  // éœ€æ±‚å·¥æ—¶
  minRemainingHours   // å‰©ä½™å·¥æ—¶é—¨æ§›å€¼ï¼ˆé»˜è®¤0.5ï¼‰
)
formData.value.planStartDate = response.planStartDate
```

**è®¡ç®—ç¤ºä¾‹**ï¼š
```
è®¡åˆ’ç»“æŸæ—¥æœŸ = 2026-01-06
éœ€æ±‚å·¥æ—¶ = 10.5

å·¥åºèƒ½åŠ›è´Ÿè·è¡¨ï¼š
  2026-01-06: å‰©ä½™å·¥æ—¶ 8.0   â†’ ç´¯è®¡ 8.0
  2026-01-05: å‰©ä½™å·¥æ—¶ 7.5   â†’ ç´¯è®¡ 15.5 (>= 10.5ï¼Œåœæ­¢)

è®¡åˆ’å¼€å§‹æ—¥æœŸ = 2026-01-05
```

**å…¸å‹é—®é¢˜**ï¼š
- é—®é¢˜ï¼šè®¡åˆ’å¼€å§‹æ—¥æœŸæœªæŒ‰è§„åˆ™ç”Ÿæˆ
- é¢„æœŸï¼š2025-12-31
- å®é™…ï¼šå¯èƒ½ä¸ºnullæˆ–å…¶ä»–æ—¥æœŸ
- æ’æŸ¥ï¼šä½¿ç”¨è°ƒè¯•æŒ‡å—é€æ­¥æ’æŸ¥

## æ•°æ®æ¥æºè¿½æº¯

### ä»å¤‡æ–™è®¡åˆ’æ¨é€çš„å­—æ®µ

| å­—æ®µ | æ¥æºè¡¨ | æ¥æºå­—æ®µ | è¯´æ˜ |
|------|--------|----------|------|
| masterPlanNo | material_preparation_plans | master_plan_no | ä¸»ç”Ÿäº§è®¡åˆ’ç¼–å· |
| productCode | material_preparation_plans | material_code | äº§å“ç¼–å· |
| productName | material_preparation_plans | material_name | äº§å“åç§° |
| processName | material_preparation_plans | source_process | å·¥åºåç§° |
| completionDate | material_preparation_plans | completion_date | è®¡åˆ’å®Œå·¥æ—¥æœŸ |
| replenishmentQty | material_preparation_plans | replenishment_qty | éœ€è¡¥è´§æ•°é‡ |
| standardWorkQuota | material_preparation_plans | standard_work_quota | å®šæ—¶å·¥é¢ |
| customerName | material_preparation_plans | customer_name | å®¢æˆ·åç§° |

## å­—æ®µçº¦æŸ

### å¿…å¡«å­—æ®µ
- planNoï¼ˆç³»ç»Ÿç”Ÿæˆï¼‰
- processNameï¼ˆæ‰‹åŠ¨æˆ–è‡ªåŠ¨ï¼‰
- scheduleDateï¼ˆæ‰‹åŠ¨è¾“å…¥ï¼‰
- completionDateï¼ˆæ‰‹åŠ¨æˆ–è‡ªåŠ¨ï¼‰

### è‡ªåŠ¨è®¡ç®—å­—æ®µï¼ˆç¦æ­¢æ‰‹åŠ¨ç¼–è¾‘ï¼‰
- requiredWorkHoursï¼ˆéœ€æ±‚å·¥æ—¶ï¼‰
- planEndDateï¼ˆè®¡åˆ’ç»“æŸæ—¥æœŸï¼‰
- planStartDateï¼ˆè®¡åˆ’å¼€å§‹æ—¥æœŸï¼‰

### å¯ä¸ºç©ºå­—æ®µ
- masterPlanNoï¼ˆå¯ä¸ºç©ºï¼Œè¡¨ç¤ºæ‰‹åŠ¨åˆ›å»ºï¼‰
- planEndDateï¼ˆå¯ä¸ºç©ºï¼Œè¡¨ç¤ºæ— ç¬¦åˆæ¡ä»¶çš„æ—¥æœŸï¼‰
- planStartDateï¼ˆå¯ä¸ºç©ºï¼Œè¡¨ç¤ºæ— ç¬¦åˆæ¡ä»¶çš„æ—¥æœŸï¼‰

## å‰ç«¯è¡¨å•é…ç½®

### æ—¥æœŸå­—æ®µæ ¼å¼åŒ–
```javascript
const formatDateYMD = (date) => {
  if (!date) return ''
  if (typeof date === 'string') return date
  const d = new Date(date)
  const year = d.getFullYear()
  const month = String(d.getMonth() + 1).padStart(2, '0')
  const day = String(d.getDate()).padStart(2, '0')
  return `${year}-${month}-${day}`
}
```

### è®¡ç®—å­—æ®µç¦ç”¨é…ç½®
```vue
<!-- éœ€æ±‚å·¥æ—¶ï¼šè‡ªåŠ¨è®¡ç®—ï¼Œç¦æ­¢ç¼–è¾‘ -->
<el-input-number 
  v-model="formData.requiredWorkHours" 
  :precision="2" 
  disabled 
/>

<!-- è®¡åˆ’ç»“æŸæ—¥æœŸï¼šè‡ªåŠ¨è®¡ç®—ï¼Œç¦æ­¢ç¼–è¾‘ -->
<el-date-picker 
  v-model="formData.planEndDate" 
  type="date" 
  disabled 
/>

<!-- è®¡åˆ’å¼€å§‹æ—¥æœŸï¼šè‡ªåŠ¨è®¡ç®—ï¼Œç¦æ­¢ç¼–è¾‘ -->
<el-date-picker 
  v-model="formData.planStartDate" 
  type="date" 
  disabled 
/>
```

## æ•°æ®åº“è¡¨ç»“æ„

```sql
CREATE TABLE real_process_plans (
  id INT AUTO_INCREMENT PRIMARY KEY,
  plan_no VARCHAR(50) UNIQUE NOT NULL,
  master_plan_no VARCHAR(50),
  process_name VARCHAR(100),
  schedule_date DATE,
  schedule_quantity DECIMAL(10,2),
  completion_date DATE,
  product_code VARCHAR(50),
  product_name VARCHAR(200),
  replenishment_qty DECIMAL(10,2),
  standard_work_quota DECIMAL(10,2),
  required_work_hours DECIMAL(10,2),
  plan_end_date DATE,              -- âœ… è®¡åˆ’ç»“æŸæ—¥æœŸï¼ˆMAXIFSï¼‰
  plan_start_date DATE,            -- âœ… è®¡åˆ’å¼€å§‹æ—¥æœŸï¼ˆåå‘ç´¯åŠ ï¼‰
  customer_name VARCHAR(200),
  source_no VARCHAR(50),
  source_process VARCHAR(100),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

## ç›¸å…³APIæ¥å£

### å‰ç«¯API
- `capacityLoadApi.queryPlanEndDate()` - æŸ¥è¯¢è®¡åˆ’ç»“æŸæ—¥æœŸ
- `capacityLoadApi.queryPlanStartDate()` - æŸ¥è¯¢è®¡åˆ’å¼€å§‹æ—¥æœŸ

### åç«¯è·¯ç”±
- `POST /capacity-load/query-plan-end-date` - è®¡åˆ’ç»“æŸæ—¥æœŸæŸ¥è¯¢
- `POST /capacity-load/query-plan-start-date` - è®¡åˆ’å¼€å§‹æ—¥æœŸæŸ¥è¯¢

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å‰ç«¯è®¡ç®—å€¼
```javascript
console.log('ğŸ” è¡¨å•æ•°æ®:', {
  processName: formData.value.processName,
  completionDate: formData.value.completionDate,
  requiredWorkHours: formData.value.requiredWorkHours,
  planEndDate: formData.value.planEndDate,
  planStartDate: formData.value.planStartDate
})
```

### 2. æŸ¥çœ‹APIå“åº”
```javascript
const response = await capacityLoadApi.queryPlanStartDate(...)
console.log('âœ… APIå“åº”:', response)
```

### 3. æŸ¥çœ‹æ•°æ®åº“å€¼
```sql
SELECT 
  plan_no,
  process_name,
  completion_date,
  required_work_hours,
  plan_end_date,
  plan_start_date
FROM real_process_plans
ORDER BY created_at DESC
LIMIT 10;
```

---

**æœ€åæ›´æ–°**ï¼š2025-12-11  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ  
**å…³è”æ–‡æ¡£**ï¼š
- [çœŸå·¥åºè®¡åˆ’è®¡ç®—è§„åˆ™](../01-æ•°æ®æµè§„åˆ™/03-çœŸå·¥åºè®¡åˆ’è®¡ç®—è§„åˆ™.md)
- [çœŸå·¥åºè®¡åˆ’è°ƒè¯•æŒ‡å—](../03-è°ƒè¯•æŒ‡å—/01-çœŸå·¥åºè®¡åˆ’è°ƒè¯•æŒ‡å—.md)
