# 销售订单模拟数据清除

**修复时间：** 2025-12-02  
**问题：** SalesOrderCreate.vue 包含硬编码的模拟数据

---

## 🐛 发现的硬编码数据

### 1. 销售员选项
**原代码：**
```vue
<el-select v-model="formData.salesperson" placeholder="请选择销售员">
  <el-option label="张三" value="张三" />
  <el-option label="李四" value="李四" />
</el-select>
```

### 2. 销售部门选项
**原代码：**
```vue
<el-select v-model="formData.salesDepartment" placeholder="请选择销售部门">
  <el-option label="华东区" value="华东区" />
  <el-option label="华南区" value="华南区" />
  <el-option label="华北区" value="华北区" />
</el-select>
```

### 3. 送货方式选项
**原代码：**
```vue
<el-select v-model="formData.deliveryMethod" placeholder="请选择送货方式">
  <el-option label="快递" value="快递" />
  <el-option label="物流" value="物流" />
  <el-option label="自提" value="自提" />
</el-select>
```

### 4. 配件选择选项
**原代码：**
```vue
<el-select v-model="row.accessories" multiple>
  <el-option label="配件A" value="配件A" />
  <el-option label="配件B" value="配件B" />
  <el-option label="配件C" value="配件C" />
</el-select>
```

---

## ✅ 修复方案

### 1. 销售员 - 从员工台账加载

**新代码：**
```vue
<el-select v-model="formData.salesperson" placeholder="请选择销售员" filterable>
  <el-option
    v-for="employee in employeeList"
    :key="employee.id"
    :label="employee.name"
    :value="employee.name"
  />
</el-select>
```

**数据来源：**
```javascript
// 从localStorage加载员工数据
const employeeData = localStorage.getItem('employeeData')
if (employeeData) {
  const allEmployees = JSON.parse(employeeData)
  // 只加载在职员工
  employeeList.value = allEmployees.filter(emp => 
    emp.status === 'active' || emp.status === 'probation'
  )
}
```

**数据源：** `localStorage.employeeData` (员工台账)  
**筛选条件：** 只显示在职和试用期员工  
**新增功能：** 支持搜索（filterable）

---

### 2. 销售部门 - 从部门数据加载

**新代码：**
```vue
<el-select v-model="formData.salesDepartment" placeholder="请选择销售部门">
  <el-option
    v-for="dept in departmentList"
    :key="dept.id"
    :label="dept.name"
    :value="dept.name"
  />
</el-select>
```

**数据来源：**
```javascript
// 从localStorage加载部门数据
const departmentData = localStorage.getItem('departmentData')
if (departmentData) {
  departmentList.value = JSON.parse(departmentData)
} else {
  // 默认部门列表
  departmentList.value = [
    { id: '1', name: '华东区' },
    { id: '2', name: '华南区' },
    { id: '3', name: '华北区' },
    { id: '4', name: '西南区' },
    { id: '5', name: '西北区' }
  ]
}
```

**数据源：** `localStorage.departmentData`  
**兜底方案：** 如果没有数据，使用5个默认区域

---

### 3. 送货方式 - 使用配置数据

**新代码：**
```vue
<el-select v-model="formData.deliveryMethod" placeholder="请选择送货方式">
  <el-option
    v-for="method in deliveryMethods"
    :key="method.value"
    :label="method.label"
    :value="method.value"
  />
</el-select>
```

**数据定义：**
```javascript
const deliveryMethods = ref([
  { label: '快递', value: '快递' },
  { label: '物流', value: '物流' },
  { label: '自提', value: '自提' },
  { label: '专车配送', value: '专车配送' }
])
```

**说明：** 
- 送货方式相对固定，使用配置数据
- 新增"专车配送"选项
- 后续可改为从系统配置加载

---

### 4. 配件选择 - 从物料库加载

**新代码：**
```vue
<el-select 
  v-model="row.accessories" 
  multiple 
  placeholder="选择配件"
  collapse-tags
  collapse-tags-tooltip
>
  <el-option
    v-for="accessory in accessoryList"
    :key="accessory.id"
    :label="accessory.name"
    :value="accessory.id"
  />
</el-select>
```

**数据来源：**
```javascript
// 从物料库筛选配件
const materialData = localStorage.getItem('materialListData')
if (materialData) {
  const allMaterials = JSON.parse(materialData)
  // 筛选配件类物料
  accessoryList.value = allMaterials.filter(m => 
    m.materialCategory === '配件' || 
    m.materialType === '配件' ||
    m.materialName?.includes('配件')
  )
}

// 如果没有配件数据，使用默认值
if (accessoryList.value.length === 0) {
  accessoryList.value = [
    { id: 'ACC001', name: '标准配件A' },
    { id: 'ACC002', name: '标准配件B' },
    { id: 'ACC003', name: '标准配件C' },
    { id: 'ACC004', name: '可选配件D' },
    { id: 'ACC005', name: '可选配件E' }
  ]
}
```

**数据源：** `localStorage.materialListData` (物料库)  
**筛选条件：** 
- 物料分类 = "配件"
- 物料类型 = "配件"
- 物料名称包含"配件"

**兜底方案：** 如果物料库没有配件，使用5个默认配件

---

## 📊 修改统计

**修改文件：** 1个
- `SalesOrderCreate.vue`

**代码变化：**
- +110 行新增
- -12 行删除

**新增数据引用：**
1. `employeeList` - 员工列表（ref）
2. `departmentList` - 部门列表（ref）
3. `accessoryList` - 配件列表（ref）
4. `deliveryMethods` - 送货方式（ref）

---

## 🎯 数据关联关系

```
销售订单创建页面
├── 客户列表 ← localStorage.customerListData
├── 销售员列表 ← localStorage.employeeData (在职员工)
├── 部门列表 ← localStorage.departmentData (默认5个区域)
├── 产品手册 ← localStorage.productManualData
├── 配件列表 ← localStorage.materialListData (筛选配件类)
└── 送货方式 ← 配置数据 (4个选项)
```

---

## 🧪 测试步骤

### 测试1：销售员下拉框
1. 打开新增销售订单页面
2. 点击"销售员"下拉框
3. ✅ 验证是否显示员工台账中的在职员工
4. ✅ 验证是否支持搜索（输入姓名）

### 测试2：销售部门下拉框
1. 点击"销售部门"下拉框
2. ✅ 验证是否显示部门列表
3. ✅ 验证至少有5个默认区域

### 测试3：送货方式下拉框
1. 点击"送货方式"下拉框
2. ✅ 验证是否有4个选项（快递、物流、自提、专车配送）

### 测试4：配件选择下拉框
1. 在产品信息表格添加产品
2. 点击"配件选择"下拉框
3. ✅ 验证是否显示物料库中的配件
4. ✅ 验证是否支持多选
5. ✅ 验证多选时是否折叠显示（collapse-tags）

### 测试5：数据联动
1. 在员工台账中添加新员工
2. 刷新销售订单页面
3. ✅ 验证新员工是否出现在销售员下拉框
4. 在物料库中添加配件
5. 刷新销售订单页面
6. ✅ 验证新配件是否出现在配件选择下拉框

---

## 💡 后续优化建议

### 1. 部门数据管理
**建议：** 创建部门管理模块
- 添加部门增删改查页面
- 保存到 `localStorage.departmentData`
- 销售订单自动加载最新部门数据

### 2. 送货方式配置化
**建议：** 将送货方式改为系统配置
```javascript
// 从系统配置加载
const deliveryConfig = localStorage.getItem('deliveryMethodConfig')
if (deliveryConfig) {
  deliveryMethods.value = JSON.parse(deliveryConfig)
}
```

### 3. 配件管理优化
**建议：** 在物料库中添加"配件"专用标签
- 物料库增加"是否配件"字段
- 筛选更精准
- 避免误筛选

### 4. 销售员权限控制
**建议：** 只显示当前用户所属部门的销售员
```javascript
// 根据当前用户部门筛选
employeeList.value = allEmployees.filter(emp => 
  (emp.status === 'active' || emp.status === 'probation') &&
  emp.department === currentUser.department
)
```

---

## ✅ 修复完成

**已清除的硬编码数据：**
1. ✅ 销售员（张三、李四）
2. ✅ 销售部门（华东区、华南区、华北区）
3. ✅ 送货方式（快递、物流、自提）
4. ✅ 配件选择（配件A、配件B、配件C）

**数据来源改为：**
- 员工台账（在职员工）
- 部门数据（可配置）
- 送货方式配置（可扩展）
- 物料库（配件类）

**优势：**
- 数据动态加载
- 支持实时更新
- 易于维护
- 可扩展性强

🎉 **所有模拟数据已清除，请测试！**
