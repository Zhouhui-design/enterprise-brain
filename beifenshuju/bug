http://localhost:3002/bom/production ç”Ÿäº§BOM é¡µé¢
è¿›å…¥æµè§ˆå™¨é¡µé¢ï¼Œé¡µé¢æç¤ºï¼š
åŠ è½½ç‰©æ–™æ•°æ®å¤±è´¥: Request failed with status code 500

æ§åˆ¶å°è¾“å‡ºç»“æœï¼š
APIè¯·æ±‚å¤±è´¥: 
Object { message: "Request failed with status code 500", name: "AxiosError", code: "ERR_BAD_RESPONSE", config: {â€¦}, request: XMLHttpRequest, response: {â€¦}, status: 500, stack: "", â€¦ }
material.js:37:13
    <anonymous> http://localhost:3002/src/api/material.js:37
è·å–ç‰©æ–™åˆ—è¡¨å¤±è´¥: 
Object { message: "Request failed with status code 500", name: "AxiosError", code: "ERR_BAD_RESPONSE", config: {â€¦}, request: XMLHttpRequest, response: {â€¦}, status: 500, stack: "", â€¦ }
materialApiService.js:24:15
    getAllMaterials http://localhost:3002/src/services/api/materialApiService.js:24
åŠ è½½ç‰©æ–™æ•°æ®å¤±è´¥: 
Object { message: "Request failed with status code 500", name: "AxiosError", code: "ERR_BAD_RESPONSE", config: {â€¦}, request: XMLHttpRequest, response: {â€¦}, status: 500, stack: "", â€¦ }
ProductionBom.vue:3047:13
    setup ProductionBom.vue:3047
è§£æ 'right' çš„å€¼æ—¶å‡ºé”™ã€‚  å£°æ˜è¢«ä¸¢å¼ƒã€‚ 3 production:1:1
è§£æ 'left' çš„å€¼æ—¶å‡ºé”™ã€‚  å£°æ˜è¢«ä¸¢å¼ƒã€‚ production:1:1
æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ DatabaseService.js:30:17
ç”Ÿäº§BOM APIè¯·æ±‚å¤±è´¥: 
Object { message: "Request failed with status code 500", name: "AxiosError", code: "ERR_BAD_RESPONSE", config: {â€¦}, request: XMLHttpRequest, response: {â€¦}, status: 500, stack: "", â€¦ }


åç«¯APIæ¥å£è¿”å›500æœåŠ¡å™¨å†…éƒ¨é”™è¯¯


é¡¹ç›®åªæœ‰å‰ç«¯ï¼Œæ²¡æœ‰åç«¯ç›®å½•ã€‚3005ç«¯å£è¿è¡Œçš„æ˜¯å¦ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡ã€‚


å½“å‰æƒ…å†µåˆ†æï¼š

    åªæœ‰å‰ç«¯ç›®å½•ï¼š/home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/

    åç«¯ç‹¬ç«‹è¿è¡Œï¼šåœ¨3005ç«¯å£ç›‘å¬

    å‰åç«¯åˆ†ç¦»ï¼šå‰ç«¯é€šè¿‡Viteä»£ç†åˆ°åç«¯

è§£å†³æ–¹æ¡ˆï¼š
æ­¥éª¤1ï¼šåˆ›å»ºåç«¯è·¯ç”±æ–‡ä»¶

åœ¨å‰ç«¯é¡¹ç›®ä¸­åˆ›å»ºåç«¯è·¯ç”±ï¼š/home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/src/server/index.js

# åˆ›å»ºåç«¯ç›®å½•
mkdir -p /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server
cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server

# åˆ›å»ºæœåŠ¡å™¨ä¸»æ–‡ä»¶
cat > server.js << 'EOF'
const express = require('express');
const cors = require('cors');
const mysql = require('mysql2/promise');

const app = express();

// ä¸­é—´ä»¶
app.use(cors());
app.use(express.json());

// æ•°æ®åº“é…ç½®
const dbConfig = {
  host: 'localhost',
  port: 3306,
  user: 'root',
  password: 'zH754277289hUi~197547',
  database: 'enterprise_brain',
  charset: 'utf8mb4',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
};

// åˆ›å»ºè¿æ¥æ± 
const pool = mysql.createPool(dbConfig);

// æµ‹è¯•æ•°æ®åº“è¿æ¥
pool.getConnection()
  .then(connection => {
    console.log('âœ… MySQLæ•°æ®åº“è¿æ¥æˆåŠŸ');
    connection.release();
  })
  .catch(err => {
    console.error('âŒ MySQLæ•°æ®åº“è¿æ¥å¤±è´¥:', err.message);
    process.exit(1);
  });

// ====================
// ç‰©æ–™APIè·¯ç”±
// ====================
app.get('/api/materials/list', async (req, res) => {
  try {
    const sql = 'SELECT * FROM materials ORDER BY created_at DESC';
    const results = await pool.query(sql);
    res.json({
      code: 200,
      data: results,
      message: 'è·å–æˆåŠŸ'
    });
  } catch (error) {
    console.error('è·å–ç‰©æ–™åˆ—è¡¨å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `è·å–å¤±è´¥: ${error.message}`
    });
  }
});

app.get('/api/materials/search', async (req, res) => {
  try {
    const { keyword } = req.query;
    let sql = 'SELECT * FROM materials WHERE 1=1';
    const params = [];
    
    if (keyword) {
      sql += ' AND (material_code LIKE ? OR material_name LIKE ?)';
      params.push(`%${keyword}%`, `%${keyword}%`);
    }
    
    sql += ' ORDER BY created_at DESC';
    const results = await pool.query(sql, params);
    
    res.json({
      code: 200,
      data: results,
      message: 'æœç´¢æˆåŠŸ'
    });
  } catch (error) {
    console.error('æœç´¢ç‰©æ–™å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `æœç´¢å¤±è´¥: ${error.message}`
    });
  }
});

// ====================
// ç”Ÿäº§BOM APIè·¯ç”±
// ====================
app.get('/api/production-boms/list', async (req, res) => {
  try {
    const sql = 'SELECT * FROM production_boms ORDER BY created_at DESC';
    const results = await pool.query(sql);
    res.json({
      code: 200,
      data: results,
      message: 'è·å–æˆåŠŸ'
    });
  } catch (error) {
    console.error('è·å–ç”Ÿäº§BOMåˆ—è¡¨å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `è·å–å¤±è´¥: ${error.message}`
    });
  }
});

app.get('/api/production-boms/detail/:id', async (req, res) => {
  try {
    const { id } = req.params;
    
    // è·å–BOMåŸºæœ¬ä¿¡æ¯
    const [bomResults] = await pool.query('SELECT * FROM production_boms WHERE id = ?', [id]);
    
    if (bomResults.length === 0) {
      return res.status(404).json({
        code: 404,
        message: 'BOMä¸å­˜åœ¨'
      });
    }
    
    // è·å–å­ä»¶ä¿¡æ¯
    const [childResults] = await pool.query(
      'SELECT * FROM bom_components WHERE bom_id = ? ORDER BY sequence',
      [id]
    );
    
    const bomDetail = {
      ...bomResults[0],
      childItems: childResults
    };
    
    res.json({
      code: 200,
      data: bomDetail,
      message: 'è·å–æˆåŠŸ'
    });
  } catch (error) {
    console.error('è·å–BOMè¯¦æƒ…å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `è·å–å¤±è´¥: ${error.message}`
    });
  }
});

app.post('/api/production-boms/create', async (req, res) => {
  try {
    const bomData = req.body;
    
    // æ’å…¥BOMåŸºæœ¬ä¿¡æ¯
    const [result] = await pool.query(
      `INSERT INTO production_boms 
      (bom_code, bom_name, product_code, product_name, version, status, 
       designer, material_count, remark, auditor, effective_date, 
       total_labor, total_material, product_image, is_pushed_to_manual)
      VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
      [
        bomData.bomCode,
        bomData.bomName,
        bomData.productCode,
        bomData.productName,
        bomData.version || 'V1.0',
        bomData.status || 'draft',
        bomData.designer || '',
        bomData.itemCount || 1,
        bomData.remark || '',
        bomData.reviewer || '',
        bomData.effectiveDate || null,
        bomData.totalLabor || 0,
        bomData.totalMaterial || 0,
        bomData.productImage || '',
        bomData.isPushedToManual || 0
      ]
    );
    
    const bomId = result.insertId;
    
    // æ’å…¥å­ä»¶ä¿¡æ¯
    if (bomData.childItems && bomData.childItems.length > 0) {
      for (const [index, child] of bomData.childItems.entries()) {
        await pool.query(
          `INSERT INTO bom_components 
          (bom_id, sequence, level, component_code, component_name, 
           standard_quantity, output_process, component_source,
           process_wage, material_loss, material_price, material_cost)
          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)`,
          [
            bomId,
            index + 1,
            child.level || 1,
            child.childCode,
            child.childName,
            child.standardQty || 1,
            child.outputProcess || '',
            child.source || '',
            child.processWage || 0,
            child.materialLoss || 0,
            child.materialPrice || 0,
            child.materialCost || 0
          ]
        );
      }
    }
    
    res.json({
      code: 200,
      data: { id: bomId },
      message: 'åˆ›å»ºæˆåŠŸ'
    });
  } catch (error) {
    console.error('åˆ›å»ºBOMå¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `åˆ›å»ºå¤±è´¥: ${error.message}`
    });
  }
});

// 404å¤„ç†
app.use('/api/*', (req, res) => {
  res.status(404).json({
    code: 404,
    message: 'Endpoint not found'
  });
});

// é”™è¯¯å¤„ç†
app.use((err, req, res, next) => {
  console.error('æœåŠ¡å™¨é”™è¯¯:', err);
  res.status(500).json({
    code: 500,
    message: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
  });
});

const PORT = 3005;
app.listen(PORT, () => {
  console.log(`ğŸš€ ä¼ä¸šå¤§è„‘åç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:${PORT}`);
  console.log(`ğŸ“¡ APIåœ°å€: http://localhost:${PORT}/api`);
});
EOF

# åˆ›å»ºpackage.json
cat > package.json << 'EOF'
{
  "name": "enterprise-brain-server",
  "version": "1.0.0",
  "description": "ä¼ä¸šå¤§è„‘åç«¯æœåŠ¡",
  "main": "server.js",
  "scripts": {
    "start": "node server.js",
    "dev": "nodemon server.js"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "mysql2": "^3.6.1"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  }
}
EOF


æ­¥éª¤2ï¼šå®‰è£…åç«¯ä¾èµ–å¹¶å¯åŠ¨


# è¿›å…¥åç«¯ç›®å½•
cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨åç«¯æœåŠ¡
npm start

æ­¥éª¤3ï¼šä¿®å¤å‰ç«¯Viteé…ç½®

cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend
cat > vite.config.js << 'EOF'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import path from 'path'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src'),
    },
  },
  server: {
    port: 3002, // å‰ç«¯ç«¯å£
    host: '0.0.0.0', // å…è®¸å±€åŸŸç½‘è®¿é—®
    proxy: {
      '/api': {
        target: 'http://localhost:3005', // åç«¯åœ°å€
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api/, '/api')
      }
    }
  }
})
EOF

æ­¥éª¤4ï¼šåˆ›å»ºå®Œæ•´çš„åç«¯APIæ–‡ä»¶

ä¸ºäº†ç¡®ä¿æ‰€æœ‰APIéƒ½å¯ç”¨ï¼Œåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„APIé›†åˆï¼š


# åˆ›å»ºAPIç›®å½•
mkdir -p /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server/routes

# åˆ›å»ºç‰©æ–™è·¯ç”±
cat > /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server/routes/material.js << 'EOF'
const express = require('express');
const router = express.Router();
const { pool } = require('../config/database');

// è·å–æ‰€æœ‰ç‰©æ–™
router.get('/list', async (req, res) => {
  try {
    const sql = 'SELECT * FROM materials ORDER BY created_at DESC';
    const [results] = await pool.execute(sql);
    res.json({
      code: 200,
      data: results,
      message: 'è·å–æˆåŠŸ'
    });
  } catch (error) {
    console.error('è·å–ç‰©æ–™åˆ—è¡¨å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `è·å–å¤±è´¥: ${error.message}`
    });
  }
});

// æœç´¢ç‰©æ–™
router.get('/search', async (req, res) => {
  try {
    const { keyword } = req.query;
    let sql = 'SELECT * FROM materials WHERE 1=1';
    const params = [];
    
    if (keyword) {
      sql += ' AND (material_code LIKE ? OR material_name LIKE ?)';
      params.push(`%${keyword}%`, `%${keyword}%`);
    }
    
    sql += ' ORDER BY created_at DESC';
    const [results] = await pool.execute(sql, params);
    
    res.json({
      code: 200,
      data: results,
      message: 'æœç´¢æˆåŠŸ'
    });
  } catch (error) {
    console.error('æœç´¢ç‰©æ–™å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `æœç´¢å¤±è´¥: ${error.message}`
    });
  }
});

// åˆ›å»ºç‰©æ–™
router.post('/create', async (req, res) => {
  try {
    const materialData = req.body;
    
    const sql = `
      INSERT INTO materials 
      (material_code, material_name, process_name, base_price, material_image)
      VALUES (?, ?, ?, ?, ?)
    `;
    
    const [result] = await pool.execute(sql, [
      materialData.materialCode,
      materialData.materialName,
      materialData.processName || '',
      materialData.basePrice || 0,
      materialData.materialImage || ''
    ]);
    
    res.json({
      code: 200,
      data: { id: result.insertId },
      message: 'åˆ›å»ºæˆåŠŸ'
    });
  } catch (error) {
    console.error('åˆ›å»ºç‰©æ–™å¤±è´¥:', error);
    res.status(500).json({
      code: 500,
      message: `åˆ›å»ºå¤±è´¥: ${error.message}`
    });
  }
});

module.exports = router;
EOF

# åˆ›å»ºæ•°æ®åº“é…ç½®
cat > /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server/config/database.js << 'EOF'
const mysql = require('mysql2/promise');

const dbConfig = {
  host: 'localhost',
  port: 3306,
  user: 'root',
  password: 'zH754277289hUi~197547',
  database: 'enterprise_brain',
  charset: 'utf8mb4',
  waitForConnections: true,
  connectionLimit: 10,
  queueLimit: 0
};

const pool = mysql.createPool(dbConfig);

// æµ‹è¯•è¿æ¥
pool.getConnection()
  .then(connection => {
    console.log('âœ… MySQLæ•°æ®åº“è¿æ¥æˆåŠŸ');
    connection.release();
  })
  .catch(err => {
    console.error('âŒ MySQLæ•°æ®åº“è¿æ¥å¤±è´¥:', err.message);
    process.exit(1);
  });

module.exports = { pool };
EOF

æ­¥éª¤5ï¼šå¯åŠ¨æœåŠ¡å¹¶æµ‹è¯•

# åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯å¯åŠ¨åç«¯
cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend/server
npm start

# åœ¨ç¬¬äºŒä¸ªç»ˆç«¯å¯åŠ¨å‰ç«¯
cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend
npm run dev