<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…é™¤å¤‡æ–™è®¡åˆ’localStorageé…ç½®</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        }
        h1 {
            color: #409EFF;
            margin-bottom: 20px;
        }
        .info {
            background-color: #ecf5ff;
            border-left: 4px solid #409EFF;
            padding: 15px;
            margin-bottom: 20px;
        }
        .warning {
            background-color: #fef0f0;
            border-left: 4px solid #F56C6C;
            padding: 15px;
            margin-bottom: 20px;
        }
        button {
            background-color: #409EFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
        }
        button:hover {
            background-color: #66b1ff;
        }
        button.danger {
            background-color: #F56C6C;
        }
        button.danger:hover {
            background-color: #f78989;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        #result.success {
            display: block;
            background-color: #f0f9ff;
            border-left: 4px solid #67C23A;
            color: #67C23A;
        }
        #result.error {
            display: block;
            background-color: #fef0f0;
            border-left: 4px solid #F56C6C;
            color: #F56C6C;
        }
        .key-list {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 4px;
            margin-top: 15px;
        }
        .key-item {
            padding: 8px;
            margin: 5px 0;
            background: white;
            border-radius: 4px;
        }
        .code {
            background-color: #f5f5f5;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§¹ æ¸…é™¤å¤‡æ–™è®¡åˆ’é¡µé¢localStorageé…ç½®</h1>
        
        <div class="info">
            <strong>é—®é¢˜è¯´æ˜ï¼š</strong><br>
            å¤‡æ–™è®¡åˆ’é¡µé¢çš„è¡¨æ ¼åˆ—é…ç½®è¢«localStorageä¸­çš„æ—§æ•°æ®è¦†ç›–ï¼Œå¯¼è‡´æ‰€æœ‰å­—æ®µçš„<span class="code">visible</span>å±æ€§ä¸º<span class="code">false</span>ï¼Œé¡µé¢ä¸­çœ‹ä¸åˆ°ä»»ä½•åˆ—ã€‚
        </div>

        <div class="warning">
            <strong>âš ï¸ æ³¨æ„ï¼š</strong><br>
            æ¸…é™¤é…ç½®åï¼Œé¡µé¢å°†ä½¿ç”¨ä»£ç ä¸­å®šä¹‰çš„é»˜è®¤é…ç½®ï¼ˆæ‰€æœ‰åˆ—å¯è§ï¼‰ã€‚ä½ ä¹‹å‰åœ¨é¡µé¢è®¾ç½®ä¸­çš„è‡ªå®šä¹‰é…ç½®å°†ä¼šä¸¢å¤±ã€‚
        </div>

        <h3>æ£€æµ‹åˆ°çš„localStorageé…ç½®ï¼š</h3>
        <div class="key-list" id="keyList">
            <div class="key-item" id="noKeys" style="color: #999;">æ­£åœ¨æ£€æµ‹...</div>
        </div>

        <div style="margin-top: 30px;">
            <button onclick="detectKeys()">ğŸ” æ£€æµ‹é…ç½®</button>
            <button class="danger" onclick="clearMaterialPreparationSettings()">ğŸ—‘ï¸ æ¸…é™¤å¤‡æ–™è®¡åˆ’é…ç½®</button>
            <button onclick="clearAllPageSettings()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰é¡µé¢é…ç½®</button>
        </div>

        <div id="result"></div>

        <div class="info" style="margin-top: 30px;">
            <strong>æ¸…é™¤åçš„æ“ä½œï¼š</strong><br>
            1. ç‚¹å‡»"æ¸…é™¤å¤‡æ–™è®¡åˆ’é…ç½®"æŒ‰é’®<br>
            2. åˆ·æ–°å¤‡æ–™è®¡åˆ’é¡µé¢ (<span class="code">Ctrl + Shift + R</span>)<br>
            3. æ£€æŸ¥è¡¨æ ¼åˆ—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º
        </div>
    </div>

    <script>
        // æ£€æµ‹localStorageä¸­çš„é…ç½®
        function detectKeys() {
            const keyList = document.getElementById('keyList');
            const materialPrepKeys = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('material-preparation') || key.includes('page_settings')) {
                    materialPrepKeys.push(key);
                }
            }
            
            if (materialPrepKeys.length === 0) {
                keyList.innerHTML = '<div class="key-item" style="color: #999;">æœªæ‰¾åˆ°å¤‡æ–™è®¡åˆ’ç›¸å…³çš„localStorageé…ç½®</div>';
            } else {
                keyList.innerHTML = materialPrepKeys.map(key => {
                    const value = localStorage.getItem(key);
                    let preview = '';
                    try {
                        const parsed = JSON.parse(value);
                        if (Array.isArray(parsed)) {
                            preview = `(${parsed.length}é¡¹)`;
                        } else {
                            preview = '(å¯¹è±¡)';
                        }
                    } catch {
                        preview = `(${value.length}å­—ç¬¦)`;
                    }
                    return `<div class="key-item"><strong>${key}</strong> ${preview}</div>`;
                }).join('');
            }
        }

        // æ¸…é™¤å¤‡æ–™è®¡åˆ’ç›¸å…³çš„localStorageé…ç½®
        function clearMaterialPreparationSettings() {
            const result = document.getElementById('result');
            const keysToRemove = [];
            
            // æŸ¥æ‰¾æ‰€æœ‰ç›¸å…³çš„key
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.includes('material-preparation') || key.includes('page_settings_material-preparation')) {
                    keysToRemove.push(key);
                }
            }
            
            if (keysToRemove.length === 0) {
                result.className = 'error';
                result.textContent = 'âŒ æœªæ‰¾åˆ°éœ€è¦æ¸…é™¤çš„é…ç½®';
                return;
            }
            
            // ç§»é™¤é…ç½®
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
                console.log('âœ… å·²æ¸…é™¤:', key);
            });
            
            result.className = 'success';
            result.innerHTML = `
                <strong>âœ… æˆåŠŸæ¸…é™¤ ${keysToRemove.length} é¡¹é…ç½®ï¼š</strong><br>
                ${keysToRemove.map(k => `â€¢ ${k}`).join('<br>')}
                <br><br>
                <strong>ä¸‹ä¸€æ­¥ï¼š</strong><br>
                1. åˆ·æ–°å¤‡æ–™è®¡åˆ’é¡µé¢ (Ctrl + Shift + R)<br>
                2. æ£€æŸ¥è¡¨æ ¼åˆ—æ˜¯å¦æ­£å¸¸æ˜¾ç¤º<br>
                3. å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æ”¯æŒ
            `;
            
            // é‡æ–°æ£€æµ‹
            detectKeys();
        }

        // æ¸…é™¤æ‰€æœ‰é¡µé¢è®¾ç½®
        function clearAllPageSettings() {
            const result = document.getElementById('result');
            if (!confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰é¡µé¢è®¾ç½®å—ï¼Ÿè¿™å°†å½±å“æ‰€æœ‰é¡µé¢çš„é…ç½®ã€‚')) {
                return;
            }
            
            const keysToRemove = [];
            
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('page_settings_')) {
                    keysToRemove.push(key);
                }
            }
            
            keysToRemove.forEach(key => {
                localStorage.removeItem(key);
                console.log('âœ… å·²æ¸…é™¤:', key);
            });
            
            result.className = 'success';
            result.innerHTML = `
                <strong>âœ… å·²æ¸…é™¤æ‰€æœ‰é¡µé¢è®¾ç½® (${keysToRemove.length}é¡¹)</strong><br><br>
                è¯·åˆ·æ–°ç›¸å…³é¡µé¢æŸ¥çœ‹æ•ˆæœ
            `;
            
            detectKeys();
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æµ‹
        window.onload = function() {
            detectKeys();
        };
    </script>
</body>
</html>
