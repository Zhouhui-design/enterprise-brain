# 字段命名统一规范

> **版本**: v1.0  
> **更新日期**: 2025-12-07  
> **目的**: 统一前后端、跨页面的字段命名，避免混乱和重复劳动

---

## 一、产出工序相关字段

### 1.1 标准字段名

| 标准字段名（前端） | 标准字段名（后端） | 中文名称 | 数据类型 | 说明 |
|-----------------|-----------------|---------|---------|------|
| `outputProcess` | `output_process` | 产出工序 | VARCHAR(100) | **推荐使用** - 销售订单、订单列表等业务表 |
| `outputProcessName` | `output_process_name` | 产出工序名称 | VARCHAR(100) | **推荐使用** - 产品手册、物料库等基础数据表 |
| `processName` | `process_name` | 工序名称 | VARCHAR(100) | 工序列表、工序计划等工序管理表 |

### 1.2 字段关系说明

```
产品手册.outputProcessName  ────lookup────> 销售订单.outputProcess
                                           │
物料库.outputProcessName    ────lookup────> 订单列表.outputProcess
                                           │
工序列表.processName        ────映射─────> 工序计划.processName
```

### 1.3 使用场景

#### ✅ 正确使用

**场景1：产品手册页面**
```javascript
// 前端字段名
formData.outputProcessName = '打包'

// 后端数据库字段
outputProcessName VARCHAR(100) COMMENT '产出工序名称'
```

**场景2：销售订单子表格**
```javascript
// 前端字段名
row.outputProcess = '打包'

// Lookup来源
const outputProcessName = matchedProduct.outputProcessName
row.outputProcess = outputProcessName
```

**场景3：订单列表页面**
```javascript
// 前端字段名
order.outputProcess = '打包'

// 后端数据库字段
output_process VARCHAR(100) COMMENT '产出工序'
```

#### ❌ 错误使用（需避免）

```javascript
// ❌ 错误：混用不同字段名
row.output_process_name = '打包'  // 后端格式在前端使用
row.process_name = '打包'         // 工序表字段用在产品表

// ✅ 正确：使用标准字段名
row.outputProcess = '打包'        // 销售订单使用
row.outputProcessName = '打包'    // 产品手册使用
```

---

## 二、产品相关字段

### 2.1 标准字段名

| 标准字段名（前端） | 标准字段名（后端） | 中文名称 | 数据类型 | 说明 |
|-----------------|-----------------|---------|---------|------|
| `productCode` | `product_code` | 产品编码 | VARCHAR(50) | 产品唯一标识 |
| `productName` | `product_name` | 产品名称 | VARCHAR(200) | 产品名称 |
| `productSpec` | `product_spec` | 产品规格 | VARCHAR(200) | 产品规格型号 |
| `productColor` | `product_color` | 产品颜色 | VARCHAR(50) | 产品颜色 |
| `productUnit` | `product_unit` | 产品单位 | VARCHAR(20) | 计量单位（个/套/台） |
| `productImage` | `product_image` | 产品图片 | VARCHAR(500) | 产品图片URL |

### 2.2 别名映射（兼容性）

在代码中可能遇到的其他字段名（需要兼容处理）：

```javascript
// 产品编码的多种可能字段名
const code = p.product_code || p.productCode || p.code

// 产出工序的多种可能字段名
const outputProcessName = p.output_process_name || 
                          p.outputProcessName || 
                          p.output_process || 
                          p.process_name || ''
```

---

## 三、物料相关字段

### 3.1 标准字段名

| 标准字段名（前端） | 标准字段名（后端） | 中文名称 | 数据类型 | 说明 |
|-----------------|-----------------|---------|---------|------|
| `materialCode` | `material_code` | 物料编码 | VARCHAR(50) | 物料唯一标识 |
| `materialName` | `material_name` | 物料名称 | VARCHAR(200) | 物料名称 |
| `materialType` | `material_type` | 物料类型 | VARCHAR(50) | 成品/半成品/原材料 |
| `materialCategory` | `material_category` | 物料分类 | VARCHAR(50) | 物料分类 |
| `materialUnit` | `material_unit` | 物料单位 | VARCHAR(20) | 计量单位 |

---

## 四、订单相关字段

### 4.1 订单主表字段

| 标准字段名（前端） | 标准字段名（后端） | 中文名称 | 数据类型 | 说明 |
|-----------------|-----------------|---------|---------|------|
| `internalOrderNo` | `internal_order_no` | 内部销售订单编号 | VARCHAR(50) | 系统自动生成 |
| `customerOrderNo` | `customer_order_no` | 客户订单编号 | VARCHAR(50) | 客户提供的订单号 |
| `customerName` | `customer_name` | 客户名称 | VARCHAR(200) | 客户名称 |
| `salesperson` | `salesperson` | 销售员 | VARCHAR(50) | 销售人员姓名 |
| `orderType` | `order_type` | 订单类型 | VARCHAR(50) | 标准/定制/样品等 |
| `orderStatus` | `order_status` | 订单状态 | VARCHAR(20) | draft/pending/confirmed |

### 4.2 订单产品子表字段

| 标准字段名（前端） | 标准字段名（后端） | 中文名称 | 数据类型 | 说明 |
|-----------------|-----------------|---------|---------|------|
| `productCode` | `product_code` | 产品编码 | VARCHAR(50) | 关联产品手册 |
| `productName` | `product_name` | 产品名称 | VARCHAR(200) | 产品名称 |
| `orderQuantity` | `order_quantity` | 订单数量 | DECIMAL(10,2) | 订购数量 |
| `unitPriceExcludingTax` | `unit_price_excluding_tax` | 单价（未税） | DECIMAL(10,2) | 不含税单价 |
| `outputProcess` | `output_process` | 产出工序 | VARCHAR(100) | **来自产品手册的产出工序名称** |

---

## 五、工序相关字段

### 5.1 标准字段名

| 标准字段名（前端） | 标准字段名（后端） | 中文名称 | 数据类型 | 说明 |
|-----------------|-----------------|---------|---------|------|
| `processCode` | `process_code` | 工序编号 | VARCHAR(50) | 格式：P{年份}{序号} |
| `processName` | `process_name` | 工序名称 | VARCHAR(100) | 工序名称 |
| `processWage` | `process_wage` | 工序工资 | DECIMAL(10,2) | 工序单价 |
| `workshopName` | `workshop_name` | 所属车间名称 | VARCHAR(100) | 车间名称 |

---

## 六、字段命名规则

### 6.1 前端命名规则（camelCase）

- ✅ 使用小驼峰命名法：`productCode`, `outputProcess`
- ✅ 首字母小写，后续单词首字母大写
- ✅ 避免缩写：`outputProcess` 而不是 `outProc`

### 6.2 后端命名规则（snake_case）

- ✅ 使用下划线分隔：`product_code`, `output_process`
- ✅ 全部小写字母
- ✅ 单词间用下划线连接

### 6.3 字段转换规则

**后端到前端转换示例：**

```javascript
// convertToCamelCase 函数
{
  product_code: 'P001',           // 后端
  output_process_name: '打包'      // 后端
}
↓ 转换
{
  productCode: 'P001',            // 前端
  outputProcessName: '打包'        // 前端
}
```

**前端到后端转换示例：**

```javascript
// convertToSnakeCase 函数
{
  productCode: 'P001',            // 前端
  outputProcess: '打包'            // 前端
}
↓ 转换
{
  product_code: 'P001',           // 后端
  output_process: '打包'           // 后端
}
```

---

## 七、Lookup规则统一

### 7.1 产出工序Lookup规则

#### 规则1：新增销售订单 → 产品手册

```javascript
// 来源表：产品手册（product_manual）
// 目标表：销售订单产品子表（sales_order_products）

// Lookup公式
销售订单.outputProcess = LOOKUP(
  产品手册.product_code = 销售订单.product_code,
  产品手册.outputProcessName
)
```

#### 规则2：订单列表显示（已废弃）

~~订单列表不再执行Lookup，直接读取订单主表的`output_process`字段~~

**新规则**：订单列表的产出工序来自于新增订单时保存的值，无需再次lookup

---

## 八、页面字段映射表

### 8.1 新增销售订单页面（SalesOrderCreate.vue）

| 字段显示名 | 前端字段名 | 后端字段名 | 数据来源 | Lookup规则 |
|----------|-----------|-----------|---------|-----------|
| 产品编码 | `productCode` | `product_code` | 用户选择 | - |
| 产品名称 | `productName` | `product_name` | 产品手册 | 产品编码匹配 |
| 产品规格 | `productSpec` | `product_spec` | 产品手册 | 产品编码匹配 |
| 产品单位 | `productUnit` | `product_unit` | 产品手册 | 产品编码匹配 |
| **产出工序** | `outputProcess` | `output_process` | 产品手册 | `outputProcessName`字段 |

### 8.2 订单列表页面（SalesOrderListNew.vue）

| 字段显示名 | 前端字段名 | 后端字段名 | 数据来源 | 说明 |
|----------|-----------|-----------|---------|------|
| 内部销售订单编号 | `internalOrderNo` | `internal_order_no` | 订单主表 | 合并显示 |
| 产品编号 | `productCode` | `product_code` | 订单产品子表 | 每个产品一行 |
| 产品名称 | `productName` | `product_name` | 订单产品子表 | 每个产品一行 |
| **产出工序** | `outputProcess` | `output_process` | 订单产品子表 | 每个产品一行 |

### 8.3 产品手册页面（ProductManual.vue）

| 字段显示名 | 前端字段名 | 后端字段名 | 数据来源 | 说明 |
|----------|-----------|-----------|---------|------|
| 产品编码 | `productCode` | `product_code` | 用户输入 | 唯一标识 |
| 产品名称 | `productName` | `product_name` | 用户输入 | - |
| **产出工序名称** | `outputProcessName` | `output_process_name` | 物料库Lookup | 匹配物料编码 |

---

## 九、开发规范

### 9.1 新增字段时的检查清单

- [ ] 确认字段中文名称（如：产出工序）
- [ ] 确定使用场景（基础数据表 vs 业务表）
- [ ] 选择标准字段名（`outputProcessName` vs `outputProcess`）
- [ ] 前端使用camelCase：`outputProcess`
- [ ] 后端使用snake_case：`output_process`
- [ ] 添加字段注释：`COMMENT '产出工序'`
- [ ] 更新本文档

### 9.2 Lookup功能开发规范

```javascript
// ✅ 标准Lookup模板
const lookupFieldName = async (row) => {
  if (!row.keyField) {
    row.targetField = ''
    return
  }
  
  try {
    // 1. 获取源数据
    const response = await sourceAPI.getAll()
    
    // 2. 处理响应格式
    let dataList = []
    if (response.success && response.data) {
      dataList = response.data
    } else if (Array.isArray(response)) {
      dataList = response
    }
    
    // 3. 查找匹配项（支持多种字段名）
    const matched = dataList.find(item => {
      const code = item.field_name || item.fieldName
      return code === row.keyField
    })
    
    // 4. 填充目标字段
    if (matched) {
      row.targetField = matched.source_field_name || 
                        matched.sourceFieldName || ''
    }
  } catch (error) {
    console.error('Lookup失败:', error)
    row.targetField = ''
  }
}
```

### 9.3 字段转换工具函数

```javascript
// camelCase to snake_case
const toSnakeCase = (str) => {
  return str.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`)
}

// snake_case to camelCase
const toCamelCase = (str) => {
  return str.replace(/_([a-z])/g, (_, letter) => letter.toUpperCase())
}

// 对象字段批量转换
const convertObjectKeys = (obj, converter) => {
  const result = {}
  Object.keys(obj).forEach(key => {
    result[converter(key)] = obj[key]
  })
  return result
}
```

---

## 十、常见问题FAQ

### Q1: 产出工序、产出工序名称、工序名称有什么区别？

**A1:**
- **产出工序**（`outputProcess`）：用于业务表（销售订单、订单列表），值来源于产品手册的产出工序名称
- **产出工序名称**（`outputProcessName`）：用于基础数据表（产品手册、物料库），是产出工序的原始数据
- **工序名称**（`processName`）：用于工序管理表（工序列表、工序计划），与产出工序名称是不同的概念

**关系图：**
```
产品手册.outputProcessName（源） → 销售订单.outputProcess（目标）
物料库.processName → 产品手册.outputProcessName → 销售订单.outputProcess
```

### Q2: 为什么需要同时支持多种字段名？

**A2:** 历史原因和兼容性考虑：
- 后端可能返回`output_process_name`（snake_case）
- 前端可能已使用`outputProcessName`（camelCase）
- 某些旧代码可能使用简写`output_process`

建议在Lookup时支持多种格式，确保兼容性：
```javascript
const value = obj.output_process_name || 
              obj.outputProcessName || 
              obj.output_process || ''
```

### Q3: 如何确保字段命名统一？

**A3:**
1. **开发前查阅本文档** - 确认标准字段名
2. **使用字段转换函数** - 自动转换前后端字段名
3. **代码审查** - 检查是否使用标准字段名
4. **更新文档** - 新增字段时及时更新本文档

### Q4: 发现字段不统一怎么办？

**A4:**
1. 优先使用本文档的标准字段名
2. 如果是旧代码，使用兼容性方案（支持多种字段名）
3. 逐步迁移到标准字段名
4. 更新本文档记录新的标准

---

## 十一、附录：字段速查表

### 快速查找：我应该使用哪个字段名？

| 我要表达的意思 | 使用场景 | 前端字段名 | 后端字段名 |
|-------------|---------|-----------|-----------|
| 产出工序 | 销售订单、订单列表 | `outputProcess` | `output_process` |
| 产出工序名称 | 产品手册、物料库 | `outputProcessName` | `output_process_name` |
| 工序名称 | 工序列表、工序计划 | `processName` | `process_name` |
| 产品编码 | 所有产品相关表 | `productCode` | `product_code` |
| 物料编码 | 所有物料相关表 | `materialCode` | `material_code` |
| 内部订单编号 | 销售订单 | `internalOrderNo` | `internal_order_no` |
| 客户订单编号 | 销售订单 | `customerOrderNo` | `customer_order_no` |

---

**文档维护者**: AI开发助手  
**最后更新**: 2025-12-07  
**版本历史**:
- v1.0 (2025-12-07): 初始版本，整理产出工序等核心字段规范
