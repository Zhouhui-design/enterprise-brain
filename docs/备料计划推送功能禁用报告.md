# å¤‡æ–™è®¡åˆ’æ¨é€åŠŸèƒ½ç¦ç”¨æŠ¥å‘Š

**æŠ¥å‘Šæ—¶é—´**: 2025-12-14 16:00  
**ä¿®å¤ç‰ˆæœ¬**: feature-3 (commit: 45bb6cf)  
**æ¶‰åŠæ–‡ä»¶**: 3ä¸ª  
**æ ¸å¿ƒæ”¹åŠ¨**: å½»åº•ç¦ç”¨å¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’,é˜²æ­¢å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯

---

## ğŸ“‹ é—®é¢˜æ¦‚è¿°

### ç”¨æˆ·åé¦ˆçš„é—®é¢˜

1. **å¤‡æ–™è®¡åˆ’ä»åœ¨æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’**
   - âŒ å¤‡æ–™è®¡åˆ’ä¸åº”è¯¥æ¨é€ä»»ä½•æ•°æ®åˆ°çœŸå·¥åºè®¡åˆ’
   - âš ï¸ æ¨é€ä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„"å·²å ç”¨å·¥æ—¶"é”™è¯¯

2. **ç»„è£…å·¥åºè®¡åˆ’ä¸­çš„æ•°æ®æ˜¯æ‰“åŒ…å·¥åºçš„æ•°æ®**
   - ç”¨æˆ·è®¤ä¸ºæ¨é€è§„åˆ™ä¸ç¬¦åˆé¢„æœŸ
   - æœŸæœ›æ¨é€è§„åˆ™ï¼šå¤‡æ–™è®¡åˆ’çš„"äº§å‡ºå·¥åº"=ç»„è£… ä¸” "éœ€è¡¥è´§æ•°é‡">0 æ—¶,æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’

---

## ğŸ” é—®é¢˜åˆ†æ

### é—®é¢˜1: å¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’çš„é—®é¢˜

**æ¨é€è§¦å‘ç‚¹**ï¼ˆå·²å…¨éƒ¨ç¦ç”¨ï¼‰:

1. **routes/materialPreparationPlans.js** (ç¬¬176è¡Œ)
   - åœºæ™¯ï¼šUPDATEå¤‡æ–™è®¡åˆ’åè§¦å‘æ¨é€
   - è°ƒç”¨ï¼š`MaterialPreparationPlanService.pushMaterialPlanToRealProcessPlan()`

2. **services/materialPreparationPlanService.js** (ç¬¬845è¡Œ)
   - åœºæ™¯ï¼šè‡ªåŠ¨è§¦å‘æ¨é€æ£€æŸ¥
   - è°ƒç”¨ï¼š`this.pushToRealProcessPlan()`

3. **services/realProcessPlanToMaterialService.js** (ç¬¬357è¡Œ)
   - åœºæ™¯ï¼šçœŸå·¥åºè®¡åˆ’æ¨é€åˆ°å¤‡æ–™è®¡åˆ’å,è§¦å‘æ•°æ®é—­ç¯æ¨é€
   - è°ƒç”¨ï¼š`MaterialPreparationPlanService.pushMaterialPlanToRealProcessPlan()`

**ä¸ºä»€ä¹ˆä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨"å·²å ç”¨å·¥æ—¶"é”™è¯¯ï¼Ÿ**

å½“å¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’æ—¶:
1. çœŸå·¥åºè®¡åˆ’åˆ›å»ºæˆåŠŸå,ä¼šè‡ªåŠ¨æ¨é€"è®¡åˆ’æ’ç¨‹å·¥æ—¶"åˆ°å·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„"å·²å ç”¨å·¥æ—¶"
2. ä½†å¤‡æ–™è®¡åˆ’ä¹Ÿå¯èƒ½ä»å…¶ä»–æ¥æºï¼ˆå¦‚ä¸»ç”Ÿäº§è®¡åˆ’ï¼‰æ¨é€åˆ°å·¥åºè®¡åˆ’
3. å¯¼è‡´åŒä¸€ä»½å·¥æ—¶è¢«é‡å¤è®¡å…¥å·¥åºèƒ½åŠ›è´Ÿè·è¡¨
4. é€ æˆ"å·²å ç”¨å·¥æ—¶"æ•°æ®ä¸å‡†ç¡®,å½±å“æ’ç¨‹é€»è¾‘

### é—®é¢˜2: ç»„è£…å·¥åºè®¡åˆ’æ•°æ®éªŒè¯

**ç”¨æˆ·æœŸæœ›çš„æ¨é€è§„åˆ™**:
```
å¤‡æ–™è®¡åˆ’.äº§å‡ºå·¥åº = "ç»„è£…" 
AND å¤‡æ–™è®¡åˆ’.éœ€è¡¥è´§æ•°é‡ > 0
â†’ æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’
```

**å®é™…æ•°æ®éªŒè¯ç»“æœ**:

```sql
SELECT 
  ap.id, ap.plan_no, ap.source_no, ap.product_code, ap.product_name, 
  ap.process_name,  -- ç»„è£…å·¥åºè®¡åˆ’ä¸­çš„å·¥åºåç§°
  m.process_name as material_process_name  -- äº§å“ç‰©æ–™åº“ä¸­çš„äº§å‡ºå·¥åº
FROM assembly_process_plans ap
LEFT JOIN materials m ON ap.product_code = m.material_code
ORDER BY ap.id DESC
LIMIT 10;
```

**ç»“æœ**:
| id | plan_no | product_code | process_name | material_process_name |
|----|---------|--------------|--------------|----------------------|
| 16 | RPP2025807338393 | 470002A | **ç»„è£…** | **ç»„è£…** âœ… |
| 15 | RPP2025807314611 | 470001A | **ç»„è£…** | **ç»„è£…** âœ… |
| 14 | RPP2025807250876 | 470002A | **ç»„è£…** | **ç»„è£…** âœ… |
| 13 | RPP2025807219762 | 470001A | **ç»„è£…** | **ç»„è£…** âœ… |

**ç»“è®º**: 
- âœ… **ç»„è£…å·¥åºè®¡åˆ’ä¸­çš„æ•°æ®å®Œå…¨æ­£ç¡®**
- âœ… product_code (470001A, 470002A) å¯¹åº”çš„äº§å‡ºå·¥åºéƒ½æ˜¯"ç»„è£…"
- âœ… process_nameéƒ½æ˜¯"ç»„è£…"
- âŒ **æ²¡æœ‰å‘ç°æ‰“åŒ…å·¥åºçš„æ•°æ®**

**å¯èƒ½çš„è¯¯è§£**:
ç”¨æˆ·å¯èƒ½çœ‹åˆ°çš„æ˜¯**äº§å“ç¼–å·**(å¦‚6001A0306,è¯¥äº§å“çš„äº§å‡ºå·¥åºæ˜¯æ‰“åŒ…),è¯¯ä»¥ä¸ºæ˜¯æ‰“åŒ…å·¥åºçš„æ•°æ®è¿›å…¥äº†ç»„è£…å·¥åºè®¡åˆ’ã€‚ä½†å®é™…ä¸Š:
- 6001A0306 çš„ process_name = "æ‰“åŒ…" â†’ åº”æ¨é€åˆ°æ‰“åŒ…å·¥åºè®¡åˆ’
- 470001A çš„ process_name = "ç»„è£…" â†’ åº”æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’ âœ…
- 470002A çš„ process_name = "ç»„è£…" â†’ åº”æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’ âœ…

---

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ: å½»åº•ç¦ç”¨å¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’

**ä¿®æ”¹çš„æ–‡ä»¶**:

#### 1. `/backend/routes/materialPreparationPlans.js`

**ä¿®æ”¹ä½ç½®**: ç¬¬174-181è¡Œ

```javascript
// âŒ ç¦ç”¨ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’ï¼ˆä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯ï¼‰
// è°ƒç”¨å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘
// try {
//   await MaterialPreparationPlanService.pushMaterialPlanToRealProcessPlan(planData);
//   console.log(`   âœ… å¤‡æ–™è®¡åˆ’ ${plan.plan_no} UPDATEåæ¨é€åˆ°çœŸå·¥åºè®¡åˆ’æˆåŠŸ`);
// } catch (pushError) {
//   console.error(`   âš ï¸ æ¨é€å¤±è´¥:`, pushError.message);
//   // ä¸é˜»å¡ä¸»æµç¨‹
// }
```

**ç¦ç”¨åŸå› **: UPDATEå¤‡æ–™è®¡åˆ’åä¸åº”è‡ªåŠ¨è§¦å‘æ¨é€

#### 2. `/backend/services/materialPreparationPlanService.js`

**ä¿®æ”¹ä½ç½®**: ç¬¬843-850è¡Œ

```javascript
// âŒ ç¦ç”¨ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’ï¼ˆä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯ï¼‰
// try {
//   // è°ƒç”¨æ¨é€é€»è¾‘
//   await this.pushToRealProcessPlan(planData);
//   pushCount++;
//   console.log(`âœ… æˆåŠŸæ¨é€: ${plan.planNo}`);
// } catch (pushError) {
//   console.error(`âŒ æ¨é€å¤±è´¥: ${plan.planNo}`, pushError.message);
// }
```

**ç¦ç”¨åŸå› **: è‡ªåŠ¨è§¦å‘æ¨é€æ£€æŸ¥ä¸åº”æ‰§è¡Œæ¨é€

#### 3. `/backend/services/realProcessPlanToMaterialService.js`

**ä¿®æ”¹ä½ç½®**: ç¬¬356-359è¡Œ

```javascript
// âŒ ç¦ç”¨ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’ï¼ˆä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯ï¼‰
// è°ƒç”¨å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘
// await MaterialPreparationPlanService.pushMaterialPlanToRealProcessPlan(planData);
// console.log(`   âœ… å¤‡æ–™è®¡åˆ’ ${materialPlanNo} æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’æˆåŠŸ`);
```

**ç¦ç”¨åŸå› **: æ•°æ®é—­ç¯æ¨é€ä¸åº”å†æ¨é€å›çœŸå·¥åºè®¡åˆ’

---

## âœ… ä¿®å¤æ•ˆæœ

### ç¦ç”¨åçš„æ•°æ®æµå‘

**ä¹‹å‰çš„æ•°æ®æµ**ï¼ˆå­˜åœ¨å¾ªç¯å’Œé‡å¤ï¼‰:
```
ä¸»ç”Ÿäº§è®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ â†’ çœŸå·¥åºè®¡åˆ’ âŒ
                â†“
         çœŸå·¥åºè®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ â†’ çœŸå·¥åºè®¡åˆ’ âŒ (å¾ªç¯)
                                    â†“
                            å·¥åºèƒ½åŠ›è´Ÿè·è¡¨(å·²å ç”¨å·¥æ—¶é‡å¤ç´¯åŠ  âŒ)
```

**ç¦ç”¨åçš„æ•°æ®æµ**ï¼ˆæ¸…æ™°å•å‘ï¼‰:
```
ä¸»ç”Ÿäº§è®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ âœ…
                â†“
         (ä¸å†æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’) âœ…
```

**å·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„æ›´æ–°æ¥æº**ï¼ˆä¿ç•™ï¼‰:
- æ‰“åŒ…å·¥åºè®¡åˆ’ â†’ å·¥åºèƒ½åŠ›è´Ÿè·è¡¨(å·²å ç”¨å·¥æ—¶) âœ…
- ç»„è£…å·¥åºè®¡åˆ’ â†’ å·¥åºèƒ½åŠ›è´Ÿè·è¡¨(å·²å ç”¨å·¥æ—¶) âœ…
- çœŸå·¥åºè®¡åˆ’ â†’ å·¥åºèƒ½åŠ›è´Ÿè·è¡¨(å·²å ç”¨å·¥æ—¶) âœ… (å¦‚æœçœŸå·¥åºè®¡åˆ’ä»å…¶ä»–æ¥æºåˆ›å»º)

### ä¿ç•™çš„æ¨é€åŠŸèƒ½

**âœ… ä¿ç•™pushToRealProcessPlan()æ–¹æ³•**:
è™½ç„¶æ‰€æœ‰è°ƒç”¨éƒ½è¢«ç¦ç”¨äº†,ä½†æ–¹æ³•æœ¬èº«ä¿ç•™,å› ä¸º:
1. ä»£ç ç»“æ„å®Œæ•´,ä¾¿äºç†è§£å†å²æ¼”å˜
2. å¦‚æœå°†æ¥éœ€è¦ä»å¤‡æ–™è®¡åˆ’æ‰‹åŠ¨è§¦å‘æ¨é€,å¯ä»¥å¿«é€Ÿæ¢å¤
3. æ–¹æ³•ä¸­çš„é€»è¾‘ï¼ˆå·¥åºè·¯ç”±ã€å­—æ®µæ˜ å°„ï¼‰ä»æœ‰å‚è€ƒä»·å€¼

**âœ… å·¥åºè®¡åˆ’çš„æ¨é€åŠŸèƒ½ä¸å—å½±å“**:
- æ‰“åŒ…å·¥åºè®¡åˆ’ â† å¤‡æ–™è®¡åˆ’(æ¥æºå·¥åº=æ‰“åŒ…) âœ… æ­£å¸¸å·¥ä½œ
- ç»„è£…å·¥åºè®¡åˆ’ â† å¤‡æ–™è®¡åˆ’(æ¥æºå·¥åº=ç»„è£…) âœ… æ­£å¸¸å·¥ä½œ

---

## ğŸ“Š æ¨é€è§„åˆ™è¯´æ˜

### å½“å‰æœ‰æ•ˆçš„æ¨é€è§„åˆ™

#### å¤‡æ–™è®¡åˆ’ â†’ å·¥åºè®¡åˆ’ï¼ˆåŸºäºæ¥æºå·¥åºï¼‰

**è§¦å‘æ¡ä»¶**:
1. `material_source` = 'è‡ªåˆ¶'ï¼ˆç‰©æ–™æ¥æºä¸ºè‡ªåˆ¶ï¼‰
2. `source_process` = 'æ‰“åŒ…' æˆ– 'ç»„è£…'ï¼ˆæ¥æºå·¥åºï¼‰
3. `demand_quantity - available_stock > 0`ï¼ˆéœ€è¡¥è´§æ•°é‡ > 0ï¼‰

**è·¯ç”±è§„åˆ™**:
- è‹¥`source_process` = 'æ‰“åŒ…' â†’ æ¨é€åˆ°æ‰“åŒ…å·¥åºè®¡åˆ’è¡¨(packing_process_plans)
- è‹¥`source_process` = 'ç»„è£…' â†’ æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’è¡¨(assembly_process_plans)
- è‹¥`source_process` = å…¶ä»– â†’ è¿”å›ä¸æ”¯æŒé”™è¯¯ï¼ˆä¸æ¨é€ï¼‰

**å…³é”®å­—æ®µæ˜ å°„**:
```javascript
ç»„è£…å·¥åºè®¡åˆ’.æ¥æºç¼–å· = å¤‡æ–™è®¡åˆ’.å¤‡æ–™è®¡åˆ’ç¼–å·
ç»„è£…å·¥åºè®¡åˆ’.äº§å“ç¼–å· = å¤‡æ–™è®¡åˆ’.ç‰©æ–™ç¼–å·
ç»„è£…å·¥åºè®¡åˆ’.äº§å“åç§° = å¤‡æ–™è®¡åˆ’.ç‰©æ–™åç§°
ç»„è£…å·¥åºè®¡åˆ’.éœ€è¡¥è´§æ•°é‡ = å¤‡æ–™è®¡åˆ’.éœ€è¡¥è´§æ•°é‡
ç»„è£…å·¥åºè®¡åˆ’.å·¥åºåç§° = å¤‡æ–™è®¡åˆ’.æ¥æºå·¥åº
```

**æ³¨æ„**: 
- æ¨é€åŸºäº**å¤‡æ–™è®¡åˆ’çš„source_process**(æ¥æºå·¥åº)
- è€Œä¸æ˜¯åŸºäº**äº§å“ç‰©æ–™åº“çš„process_name**(äº§å‡ºå·¥åº)
- è¿™ä¸¤ä¸ªå­—æ®µåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸€è‡´çš„,ä½†åœ¨å¤æ‚BOMç»“æ„ä¸­å¯èƒ½ä¸åŒ

### ç”¨æˆ·æœŸæœ›çš„æ¨é€è§„åˆ™åˆ†æ

**ç”¨æˆ·æœŸæœ›**:
```
å¤‡æ–™è®¡åˆ’.äº§å‡ºå·¥åº = "ç»„è£…" 
AND å¤‡æ–™è®¡åˆ’.éœ€è¡¥è´§æ•°é‡ > 0
â†’ æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’
```

**å½“å‰å®ç°**:
```
å¤‡æ–™è®¡åˆ’.æ¥æºå·¥åº(source_process) = "ç»„è£…"
AND å¤‡æ–™è®¡åˆ’.éœ€è¡¥è´§æ•°é‡ > 0
â†’ æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’
```

**å·®å¼‚åˆ†æ**:
- **äº§å‡ºå·¥åº**(output_process/process_name): äº§å“ç‰©æ–™åº“ä¸­çš„å­—æ®µ,è¡¨ç¤ºè¯¥ç‰©æ–™åœ¨å“ªä¸ªå·¥åºäº§å‡º
- **æ¥æºå·¥åº**(source_process): å¤‡æ–™è®¡åˆ’ä¸­çš„å­—æ®µ,è¡¨ç¤ºè¯¥ç‰©æ–™éœ€æ±‚æ¥è‡ªå“ªä¸ªå·¥åº

**æ¡ˆä¾‹è¯´æ˜**:
```
äº§å“: 6001A0306ï¼ˆé“è´¨æ–¹å‘ç›˜æ¬¾ï¼‰
â”œâ”€ äº§å“ç‰©æ–™åº“.process_name = "æ‰“åŒ…"ï¼ˆäº§å‡ºå·¥åºï¼‰
â””â”€ å¤‡æ–™è®¡åˆ’.source_process = "æ‰“åŒ…"ï¼ˆæ¥æºå·¥åºï¼‰
   
äº§å“: 470001Aï¼ˆ6001èƒŒå¤´å¥—è¢‹ä»¶ï¼‰
â”œâ”€ äº§å“ç‰©æ–™åº“.process_name = "ç»„è£…"ï¼ˆäº§å‡ºå·¥åºï¼‰
â””â”€ å¤‡æ–™è®¡åˆ’.source_process = "ç»„è£…"ï¼ˆæ¥æºå·¥åºï¼‰
```

åœ¨å½“å‰æ•°æ®ä¸­,**äº§å‡ºå·¥åº = æ¥æºå·¥åº**,æ‰€ä»¥æ¨é€ç»“æœç¬¦åˆé¢„æœŸã€‚

---

## ğŸ”„ Gitæäº¤è®°å½•

### Commit 1: ç§»é™¤æ’é˜Ÿæœºåˆ¶åçŠ¶æ€å¤‡ä»½
```bash
commit 3a2ff04
ğŸ’¾ å¤‡ä»½èŠ‚ç‚¹ï¼šç§»é™¤æ’é˜Ÿæœºåˆ¶åçŠ¶æ€
```

### Commit 2: ç¦ç”¨å¤‡æ–™è®¡åˆ’æ¨é€
```bash
commit 45bb6cf
ğŸš« å½»åº•ç¦ç”¨å¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’(é˜²æ­¢å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯)

å˜æ›´ç»Ÿè®¡:
- backend/routes/materialPreparationPlans.js: +8 -7
- backend/services/materialPreparationPlanService.js: +9 -8
- backend/services/realProcessPlanToMaterialService.js: +3 -3
```

---

## ğŸ“Œ åç»­å»ºè®®

### 1. éªŒè¯å·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„å·²å ç”¨å·¥æ—¶

**å»ºè®®SQL**:
```sql
SELECT 
  process_name, 
  DATE_FORMAT(date, '%Y-%m-%d') as date,
  work_shift,
  available_workstations,
  (work_shift * available_workstations) as total_hours,
  scheduled_work_hours as used_hours,
  remaining_hours
FROM process_capacity_load
WHERE process_name IN ('æ‰“åŒ…', 'ç»„è£…')
  AND date >= CURDATE()
ORDER BY process_name, date
LIMIT 20;
```

**æ£€æŸ¥ç‚¹**:
- `used_hours` æ˜¯å¦åˆç†ï¼ˆä¸åº”è¶…è¿‡ total_hoursï¼‰
- `remaining_hours` = `total_hours` - `used_hours`
- æ˜¯å¦å­˜åœ¨é‡å¤ç´¯åŠ çš„æƒ…å†µ

### 2. é‡å»ºå·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„å·²å ç”¨å·¥æ—¶

å¦‚æœå‘ç°å·²å ç”¨å·¥æ—¶æ•°æ®ä¸å‡†ç¡®,å¯ä»¥æ‰§è¡Œé‡ç½®:

```sql
-- 1. é‡ç½®æ‰€æœ‰å·²å ç”¨å·¥æ—¶ä¸º0
UPDATE process_capacity_load 
SET scheduled_work_hours = 0,
    remaining_hours = work_shift * available_workstations
WHERE process_name IN ('æ‰“åŒ…', 'ç»„è£…');

-- 2. ä»æ‰“åŒ…å·¥åºè®¡åˆ’é‡æ–°è®¡ç®—
UPDATE process_capacity_load pcl
SET scheduled_work_hours = (
  SELECT COALESCE(SUM(scheduled_work_hours), 0)
  FROM packing_process_plans
  WHERE process_name = pcl.process_name
    AND DATE_FORMAT(schedule_date, '%Y-%m-%d') = DATE_FORMAT(pcl.date, '%Y-%m-%d')
),
remaining_hours = (work_shift * available_workstations) - scheduled_work_hours
WHERE process_name = 'æ‰“åŒ…';

-- 3. ä»ç»„è£…å·¥åºè®¡åˆ’é‡æ–°è®¡ç®—
UPDATE process_capacity_load pcl
SET scheduled_work_hours = (
  SELECT COALESCE(SUM(scheduled_work_hours), 0)
  FROM assembly_process_plans
  WHERE process_name = pcl.process_name
    AND DATE_FORMAT(schedule_date, '%Y-%m-%d') = DATE_FORMAT(pcl.date, '%Y-%m-%d')
),
remaining_hours = (work_shift * available_workstations) - scheduled_work_hours
WHERE process_name = 'ç»„è£…';
```

### 3. å¦‚éœ€å¯ç”¨å¤‡æ–™è®¡åˆ’åˆ°å·¥åºè®¡åˆ’çš„æ¨é€

å¦‚æœå°†æ¥ç¡®è®¤éœ€è¦ä»å¤‡æ–™è®¡åˆ’æ¨é€åˆ°å·¥åºè®¡åˆ’ï¼ˆè€ŒéçœŸå·¥åºè®¡åˆ’ï¼‰,éœ€è¦:

1. **ä¿®æ”¹æ¨é€ç›®æ ‡**: å°† `pushToRealProcessPlan()` æ”¹ä¸ºæ¨é€åˆ°å¯¹åº”å·¥åºè®¡åˆ’è¡¨
2. **å»æ‰æ³¨é‡Š**: æ¢å¤3å¤„è¢«æ³¨é‡Šçš„è°ƒç”¨ä»£ç 
3. **æµ‹è¯•éªŒè¯**: ç¡®ä¿ä¸ä¼šå¯¼è‡´å·²å ç”¨å·¥æ—¶é‡å¤ç´¯åŠ 
4. **æ›´æ–°æ–‡æ¡£**: è¯´æ˜æ–°çš„æ¨é€è§„åˆ™å’Œæ•°æ®æµå‘

---

## ğŸ“ è”ç³»æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. å·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„æŸ¥è¯¢ç»“æœï¼ˆSQLè§"åç»­å»ºè®®"ï¼‰
2. æ˜¯å¦è¿˜å‘ç°å¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’çš„æƒ…å†µ
3. ç»„è£…å·¥åºè®¡åˆ’ä¸­æ˜¯å¦ç¡®å®æœ‰æ‰“åŒ…å·¥åºçš„æ•°æ®ï¼ˆæä¾›å…·ä½“è®°å½•IDï¼‰

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-14 16:00  
**æŠ¥å‘Šç”Ÿæˆå·¥å…·**: Qoder AI Assistant  
**ç‰ˆæœ¬æ§åˆ¶**: Git (feature-3åˆ†æ”¯)
