/**
 * å¤‡æ–™è®¡åˆ’åˆ°å·¥åºè®¡åˆ’é€’å½’æ•°æ®æµåŠŸèƒ½å®æ–½å®Œæ•´ä¿®å¤æŠ¥å‘Š
 * 
 * ä¿®å¤æ—¶é—´: 2025-12-15
 * ä¿®å¤èŒƒå›´: å¯ç”¨å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘ï¼Œå®Œå–„è·¯ç”±æ”¯æŒï¼Œå®ç°å®Œæ•´é€’å½’æ•°æ®æµ
 */

# å¤‡æ–™è®¡åˆ’åˆ°å·¥åºè®¡åˆ’é€’å½’æ•°æ®æµåŠŸèƒ½å®æ–½æŠ¥å‘Š

## ä¸€ã€ä¿®å¤ç›®æ ‡

æ ¹æ®ç”¨æˆ·æä¾›çš„æ•°æ®æµè§„åˆ™è¯´æ˜ï¼Œå®ç°å®Œæ•´çš„å¤‡æ–™è®¡åˆ’åˆ°å·¥åºè®¡åˆ’çš„é€’å½’æ•°æ®æµ:

```
é”€å”®è®¢å• â†’ ä¸»ç”Ÿäº§è®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ â†’ å·¥åºè®¡åˆ’(æ‰“åŒ…/ç»„è£…) â†’ å¤‡æ–™è®¡åˆ’(BOMå­ä»¶) â†’ å·¥åºè®¡åˆ’ â†’ ...
```

**IFSè§¦å‘æ¡ä»¶**:
```javascript
IFS(
  AND(
    å¤‡æ–™è®¡åˆ’ç¼–å· != null,
    éœ€è¡¥è´§æ•°é‡ > 0,
    ç‰©æ–™æ¥æº = "è‡ªåˆ¶",
    æ¥æºå·¥åº = "æ‰“åŒ…"
  ) â†’ æ¨é€åˆ° "æ‰“åŒ…å·¥åºè®¡åˆ’",
  
  AND(
    å¤‡æ–™è®¡åˆ’ç¼–å· != null,
    éœ€è¡¥è´§æ•°é‡ > 0,
    ç‰©æ–™æ¥æº = "è‡ªåˆ¶",
    æ¥æºå·¥åº = "ç»„è£…"
  ) â†’ æ¨é€åˆ° "ç»„è£…å·¥åºè®¡åˆ’"
)
```

## äºŒã€ä¿®å¤å‰ä»£ç çŠ¶æ€åˆ†æ

### 2.1 å·²å®ç°ä½†è¢«ç¦ç”¨çš„åŠŸèƒ½

**æ–‡ä»¶**: `backend/services/materialPreparationPlanService.js`

**ä½ç½®**: ç¬¬843-851è¡Œ

**é—®é¢˜**: å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘è¢«æ³¨é‡Šç¦ç”¨

```javascript
// âŒ ç¦ç”¨ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’ï¼ˆä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯ï¼‰
// try {
//   // è°ƒç”¨æ¨é€é€»è¾‘
//   await this.pushToRealProcessPlan(planData);
//   pushCount++;
//   console.log(`âœ… æˆåŠŸæ¨é€: ${plan.planNo}`);
// } catch (pushError) {
//   console.error(`âŒ æ¨é€å¤±è´¥: ${plan.planNo}`, pushError.message);
// }
```

**ç¦ç”¨åŸå› **: æ³¨é‡Šè¯´æ˜"ä¼šå¯¼è‡´å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯"

### 2.2 å·²å®ç°çš„åŠŸèƒ½

1. **æ‰“åŒ…å·¥åºè®¡åˆ’å’Œç»„è£…å·¥åºè®¡åˆ’çš„pushToMaterialPlan**
   - **ç»„è£…å·¥åºè®¡åˆ’**: `backend/services/assemblyProcessPlanService.js` ç¬¬266-350è¡Œ
   - **æ‰“åŒ…å·¥åºè®¡åˆ’**: `backend/services/packingProcessPlanService.js` ç¬¬266-350è¡Œ
   - ä¸¤è€…éƒ½è°ƒç”¨`realProcessPlanToMaterialService.pushToMaterialPreparation`æ¨é€BOMå­ä»¶å›å¤‡æ–™è®¡åˆ’

2. **å¤‡æ–™è®¡åˆ’çš„pushToRealProcessPlanè·¯ç”±é€»è¾‘**
   - **æ–‡ä»¶**: `backend/services/materialPreparationPlanService.js` ç¬¬870-1173è¡Œ
   - å·²å®ç°æ ¹æ®`sourceProcess`å­—æ®µè·¯ç”±åˆ°ä¸åŒå·¥åºè®¡åˆ’çš„é€»è¾‘
   - æ”¯æŒæ‰“åŒ…å·¥åºè®¡åˆ’(packing_process_plans)å’Œç»„è£…å·¥åºè®¡åˆ’(assembly_process_plans)
   - é˜²é‡å¤æ¨é€æœºåˆ¶å·²å®ç°

### 2.3 ç¼ºå¤±çš„åŠŸèƒ½

1. **æ’ç¨‹æ•°é‡è®¡ç®—**: `pushToRealProcessPlan`æ–¹æ³•ç¼ºå°‘`scheduleQuantity`å­—æ®µè®¡ç®—
2. **å½“å¤©å¯ç”¨å·¥æ—¶è®¡ç®—**: ç¼ºå°‘`dailyAvailableHours`è®¡ç®—
3. **è®¡åˆ’æ’ç¨‹å·¥æ—¶è®¡ç®—**: ç¼ºå°‘`scheduledWorkHours`è®¡ç®—

## ä¸‰ã€å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ

### 3.1 å¯ç”¨å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘

**æ–‡ä»¶**: `backend/services/materialPreparationPlanService.js`

**ä¿®æ”¹ä½ç½®**: ç¬¬843-856è¡Œ

**ä¿®æ”¹å†…å®¹**:

```javascript
// âœ… å¯ç”¨ï¼šå¤‡æ–™è®¡åˆ’æ¨é€åˆ°å·¥åºè®¡åˆ’ï¼ˆæ”¯æŒæ‰“åŒ…/ç»„è£…å·¥åºè®¡åˆ’ï¼‰
try {
  // è°ƒç”¨æ¨é€é€»è¾‘ï¼ˆè‡ªåŠ¨è·¯ç”±åˆ°æ‰“åŒ…/ç»„è£…å·¥åºè®¡åˆ’ï¼‰
  const pushResult = await this.pushToRealProcessPlan(planData);
  if (pushResult.success) {
    pushCount++;
    console.log(`âœ… æˆåŠŸæ¨é€: ${plan.planNo} â†’ ${pushResult.serviceName} (${pushResult.planNo})`);
  } else {
    console.log(`â­ï¸ è·³è¿‡æ¨é€: ${plan.planNo} - åŸå› : ${pushResult.reason}`);
  }
} catch (pushError) {
  console.error(`âŒ æ¨é€å¤±è´¥: ${plan.planNo}`, pushError.message);
}
```

**å…³é”®ç‚¹**:
- å¯ç”¨äº†è¢«æ³¨é‡Šçš„æ¨é€é€»è¾‘
- æ·»åŠ äº†`pushResult.success`åˆ¤æ–­
- è¾“å‡ºäº†æ›´è¯¦ç»†çš„æ—¥å¿—ï¼ˆåŒ…å«ç›®æ ‡Serviceåç§°ï¼‰

### 3.2 å®Œå–„æ’ç¨‹æ•°é‡è®¡ç®—é€»è¾‘

**æ–‡ä»¶**: `backend/services/materialPreparationPlanService.js`

**ä¿®æ”¹ä½ç½®**: ç¬¬1090-1143è¡Œï¼ˆæ’å…¥æ–°ä»£ç ï¼‰

**æ–°å¢è®¡ç®—é€»è¾‘**:

```javascript
// âœ… è®¡ç®—å½“å¤©å¯ç”¨å·¥æ—¶ = å½“å¤©æ€»å·¥æ—¶ - å½“å¤©å·²æ’ç¨‹å·¥æ—¶
let dailyAvailableHours = 0;
if (dailyTotalHours > 0) {
  dailyAvailableHours = parseFloat((dailyTotalHours - dailyScheduledHours).toFixed(2));
  if (dailyAvailableHours < 0) dailyAvailableHours = 0;
  console.log(`ğŸ§  è®¡ç®—å½“å¤©å¯ç”¨å·¥æ—¶: ${dailyTotalHours} - ${dailyScheduledHours} = ${dailyAvailableHours}`);
}

// âœ… è®¡ç®—è®¡åˆ’æ’ç¨‹å·¥æ—¶ = min(éœ€æ±‚å·¥æ—¶, å½“å¤©å¯ç”¨å·¥æ—¶)
let scheduledWorkHours = 0;
if (requiredWorkHours > 0 && dailyAvailableHours >= 0) {
  scheduledWorkHours = parseFloat(Math.min(requiredWorkHours, dailyAvailableHours).toFixed(2));
  console.log(`âŒ› è®¡ç®—è®¡åˆ’æ’ç¨‹å·¥æ—¶: min(${requiredWorkHours}, ${dailyAvailableHours}) = ${scheduledWorkHours}`);
}

// âœ… è®¡ç®—è®¡åˆ’æ’ç¨‹æ•°é‡ = è®¡åˆ’æ’ç¨‹å·¥æ—¶ * å®šæ—¶å·¥é¢
let scheduleQuantity = 0;
if (scheduledWorkHours > 0 && standardWorkQuota > 0) {
  scheduleQuantity = parseFloat((scheduledWorkHours * standardWorkQuota).toFixed(4));
  console.log(`ğŸ“Š è®¡ç®—è®¡åˆ’æ’ç¨‹æ•°é‡: ${scheduledWorkHours} * ${standardWorkQuota} = ${scheduleQuantity}`);
}
```

**è®¡ç®—å…¬å¼**:
1. `dailyAvailableHours = dailyTotalHours - dailyScheduledHours`
2. `scheduledWorkHours = min(requiredWorkHours, dailyAvailableHours)`
3. `scheduleQuantity = scheduledWorkHours * standardWorkQuota`

### 3.3 æ·»åŠ å­—æ®µåˆ°realProcessPlanData

**ä¿®æ”¹ä½ç½®**: ç¬¬1115-1143è¡Œ

**æ–°å¢å­—æ®µ**:

```javascript
const realProcessPlanData = {
  // ... å·²æœ‰å­—æ®µ ...
  dailyAvailableHours: dailyAvailableHours,  // âœ… æ–°å¢ï¼šå½“å¤©å¯ç”¨å·¥æ—¶
  scheduledWorkHours: scheduledWorkHours,  // âœ… æ–°å¢ï¼šè®¡åˆ’æ’ç¨‹å·¥æ—¶
  scheduleQuantity: scheduleQuantity,  // âœ… æ–°å¢ï¼šè®¡åˆ’æ’ç¨‹æ•°é‡
  // ... å…¶ä»–å­—æ®µ ...
};
```

### 3.4 éªŒè¯è·¯ç”±é€»è¾‘å®Œæ•´æ€§

**è·¯ç”±é€»è¾‘å·²å®ç°** (ç¬¬1127-1141è¡Œ):

```javascript
if (data.sourceProcess === 'æ‰“åŒ…') {
  ProcessPlanService = require('./packingProcessPlanService');
  planNoPrefix = 'PKPP';
  serviceName = 'æ‰“åŒ…å·¥åºè®¡åˆ’';
} else if (data.sourceProcess === 'ç»„è£…') {
  ProcessPlanService = require('./assemblyProcessPlanService');
  planNoPrefix = 'ASPP';
  serviceName = 'ç»„è£…å·¥åºè®¡åˆ’';
} else {
  // âš ï¸ ç¦æ­¢æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’ï¼Œä»…æ”¯æŒæ‰“åŒ…å’Œç»„è£…
  console.warn(`âš ï¸ [æ•°æ®è·¯ç”±] ä¸æ”¯æŒçš„å·¥åºç±»å‹: ${data.sourceProcess}ï¼Œå·²è·³è¿‡æ¨é€`);
  return { success: false, reason: 'unsupported_process', processName: data.sourceProcess };
}
```

## å››ã€æµ‹è¯•éªŒè¯

### 4.1 æµ‹è¯•è„šæœ¬

åˆ›å»ºæµ‹è¯•è„šæœ¬: `backend/test-recursive-dataflow-6001A0306.js`

**æµ‹è¯•åœºæ™¯**:
1. ä¸»ç”Ÿäº§è®¡åˆ’æ‰§è¡Œæ’ç¨‹ â†’ ç”Ÿæˆå¤‡æ–™è®¡åˆ’ï¼ˆ6001A0306ï¼‰
2. å¤‡æ–™è®¡åˆ’æ¨é€åˆ°æ‰“åŒ…å·¥åºè®¡åˆ’ï¼ˆæ¥æºå·¥åº=æ‰“åŒ…ï¼‰
3. æ‰“åŒ…å·¥åºè®¡åˆ’æ¨é€BOMå­ä»¶å›å¤‡æ–™è®¡åˆ’ï¼ˆ470001Aã€470002Aã€511442Bï¼‰
4. å¤‡æ–™è®¡åˆ’å†æ¬¡æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’ï¼ˆ470001Aã€470002Açš„æ¥æºå·¥åº=ç»„è£…ï¼‰

### 4.2 æµ‹è¯•ç»“æœ

**ç¬¬1è½®: ä¸»ç”Ÿäº§è®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ (6001A0306)**
- âœ… å¤‡æ–™è®¡åˆ’æ•°é‡: 1 æ¡

**ç¬¬2è½®: å¤‡æ–™è®¡åˆ’ â†’ æ‰“åŒ…å·¥åºè®¡åˆ’**
- âœ… æ‰“åŒ…å·¥åºè®¡åˆ’æ•°é‡: 1 æ¡
- âœ… è·¯ç”±æ­£ç¡®: æ¥æºå·¥åº=æ‰“åŒ… â†’ packing_process_plans

**ç¬¬3è½®: æ‰“åŒ…å·¥åºè®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ (BOMå­ä»¶)**
- âœ… å¤‡æ–™è®¡åˆ’æ•°é‡: 6 æ¡
- âœ… é¢„æœŸå­ä»¶: 470001A, 470002A, 511442B
- âœ… å®é™…æ‰¾åˆ°: 470001A, 470002A, 511442B (3/3)

**ç¬¬4è½®: å¤‡æ–™è®¡åˆ’ â†’ ç»„è£…å·¥åºè®¡åˆ’**
- âœ… ç»„è£…å·¥åºè®¡åˆ’æ•°é‡: 4 æ¡
- âœ… è·¯ç”±æ­£ç¡®: æ¥æºå·¥åº=ç»„è£… â†’ assembly_process_plans

### 4.3 å·²çŸ¥é—®é¢˜

**é—®é¢˜**: æ’ç¨‹æ•°é‡ = 0

**åŸå› **: å½“å¤©å¯ç”¨å·¥æ—¶è®¡ç®—ç»“æœä¸º0ï¼Œå¯¼è‡´æ’ç¨‹æ•°é‡ä¹Ÿä¸º0

**å½±å“èŒƒå›´**: å·¥åºè®¡åˆ’æ— æ³•ç»§ç»­æ¨é€BOMå­ä»¶ï¼ˆå› ä¸ºæ¨é€æ¡ä»¶æ˜¯scheduleQuantity > 0ï¼‰

**ä¸‹ä¸€æ­¥**: éœ€è¦æ’æŸ¥å½“å¤©å¯ç”¨å·¥æ—¶è®¡ç®—é€»è¾‘çš„é—®é¢˜

## äº”ã€å®Œæ•´æ•°æ®æµå›¾

```
é”€å”®è®¢å•åˆ›å»º
    â†“
ä¸»ç”Ÿäº§è®¡åˆ’ç”Ÿæˆ
    â†“
ã€æ‰§è¡Œæ’ç¨‹ã€‘è§¦å‘
    â†“
å¤‡æ–™è®¡åˆ’è‡ªåŠ¨ç”Ÿæˆ (6001A0306)
â”œâ”€ ç‰©æ–™æ¥æº: è‡ªåˆ¶
â”œâ”€ æ¥æºå·¥åº: æ‰“åŒ…
â”œâ”€ éœ€è¡¥è´§æ•°é‡: 100
â””â”€ IFSæ¡ä»¶æ£€æŸ¥ âœ…
    â†“
æ¨é€åˆ°æ‰“åŒ…å·¥åºè®¡åˆ’
â”œâ”€ æ¥æºç¼–å·: MPP2025636877933
â”œâ”€ æ’ç¨‹æ•°é‡: 0 (âš ï¸ é—®é¢˜)
â””â”€ æ¨é€æ¡ä»¶æ£€æŸ¥ âŒ (scheduleQuantity = 0)
    â†“ (åº”è¯¥è§¦å‘ä½†æœªè§¦å‘)
æŸ¥è¯¢BOMå­ä»¶æ¨é€å›å¤‡æ–™è®¡åˆ’
â”œâ”€ 470001A (æ¥æºå·¥åº=ç»„è£…)
â”œâ”€ 470002A (æ¥æºå·¥åº=ç»„è£…)
â””â”€ 511442B (æ¥æºå·¥åº=é‡‡è´­)
    â†“
å¤‡æ–™è®¡åˆ’å†æ¬¡æ¨é€åˆ°ç»„è£…å·¥åºè®¡åˆ’
â””â”€ 4æ¡ç»„è£…å·¥åºè®¡åˆ’ç”Ÿæˆ
```

## å…­ã€ä¿®æ”¹æ–‡ä»¶æ¸…å•

### 6.1 ä»£ç ä¿®æ”¹

| æ–‡ä»¶è·¯å¾„ | ä¿®æ”¹å†…å®¹ | ä¿®æ”¹è¡Œæ•° |
|---------|---------|---------|
| `backend/services/materialPreparationPlanService.js` | å¯ç”¨å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘ | 843-856è¡Œ (+13/-9) |
| `backend/services/materialPreparationPlanService.js` | æ–°å¢æ’ç¨‹æ•°é‡è®¡ç®—é€»è¾‘ | 1090-1143è¡Œ (+25) |

### 6.2 æµ‹è¯•è„šæœ¬

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” |
|---------|------|
| `backend/test-recursive-dataflow-6001A0306.js` | é€’å½’æ•°æ®æµå®Œæ•´æ€§éªŒè¯ |
| `backend/check-packing-data.js` | æ‰“åŒ…å·¥åºè®¡åˆ’æ•°æ®æ£€æŸ¥ |

### 6.3 æ–‡æ¡£

| æ–‡ä»¶è·¯å¾„ | ç”¨é€” |
|---------|------|
| `docs/å¤‡æ–™è®¡åˆ’åˆ°ç»„è£…å·¥åºè®¡åˆ’æ•°æ®æµè§„åˆ™è¯´æ˜.md` | ä¸šåŠ¡è§„åˆ™è¯¦ç»†è¯´æ˜ (431è¡Œ) |
| `docs/æ•°æ®æµè§„åˆ™æŠ€æœ¯å®ç°æ€»ç»“.md` | æŠ€æœ¯å®ç°æŒ‡å— (321è¡Œ) |
| `docs/å¤‡æ–™è®¡åˆ’åˆ°å·¥åºè®¡åˆ’é€’å½’æ•°æ®æµåŠŸèƒ½å®æ–½æŠ¥å‘Š.md` | æœ¬æŠ¥å‘Š |

## ä¸ƒã€æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ€»ç»“

### 7.1 è§¦å‘æ¡ä»¶ï¼ˆIFSï¼‰

å¤‡æ–™è®¡åˆ’æ»¡è¶³ä»¥ä¸‹**æ‰€æœ‰**æ¡ä»¶æ—¶è§¦å‘æ¨é€:

1. `å¤‡æ–™è®¡åˆ’ç¼–å· != null` (æ•°æ®å·²ç”Ÿæˆ)
2. `éœ€è¡¥è´§æ•°é‡ > 0` (æœ‰å®é™…éœ€æ±‚)
3. `ç‰©æ–™æ¥æº = è‡ªåˆ¶` (è‡ªåˆ¶ä»¶æ‰æ¨é€åˆ°å·¥åºè®¡åˆ’)
4. `æ¥æºå·¥åº = æ‰“åŒ… æˆ– ç»„è£…` (ç›®å‰ä»…æ”¯æŒè¿™ä¸¤ç§å·¥åº)

### 7.2 æ¨é€è·¯ç”±è§„åˆ™

æ ¹æ®`sourceProcess`å­—æ®µè·¯ç”±åˆ°ä¸åŒçš„å·¥åºè®¡åˆ’è¡¨:

| æ¥æºå·¥åº | ç›®æ ‡è¡¨ | Service |
|---------|--------|---------|
| æ‰“åŒ… | packing_process_plans | PackingProcessPlanService |
| ç»„è£… | assembly_process_plans | AssemblyProcessPlanService |
| å…¶ä»– | ä¸æ¨é€ | - |

**ä¸¥ç¦æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’è¡¨**(real_process_plans)ï¼Œé¿å…å·¥åºèƒ½åŠ›è´Ÿè·è¡¨å·²å ç”¨å·¥æ—¶é”™è¯¯ã€‚

### 7.3 å­—æ®µæ˜ å°„å…³ç³»

**å¤‡æ–™è®¡åˆ’ â†’ å·¥åºè®¡åˆ’**:

| å¤‡æ–™è®¡åˆ’å­—æ®µ | å·¥åºè®¡åˆ’å­—æ®µ | è¯´æ˜ |
|------------|------------|------|
| planNo | sourceNo | æ¥æºç¼–å·ï¼Œç”¨äºè¿½æº¯å’Œé˜²é‡å¤ |
| materialCode | productCode | äº§å“ç¼–å· |
| materialName | productName | äº§å“åç§° |
| sourceProcess | processName | å·¥åºåç§° |
| replenishmentQuantity | replenishmentQty | éœ€è¡¥è´§æ•°é‡ |
| sourcePlanNo | masterPlanNo | ä¸»ç”Ÿäº§è®¡åˆ’ç¼–å· |
| mainPlanProductCode | masterPlanProductCode | ä¸»è®¡åˆ’äº§å“ç¼–å· |
| mainPlanProductName | masterPlanProductName | ä¸»è®¡åˆ’äº§å“åç§° |
| customerOrderNo | customerOrderNo | å®¢æˆ·è®¢å•ç¼–å· |
| promiseDeliveryDate | promiseDeliveryDate | è®¢å•æ‰¿è¯ºäº¤æœŸ |

### 7.4 é€’å½’ç»ˆæ­¢æ¡ä»¶

æ•°æ®æµé€’å½’å¾ªç¯ç›´åˆ°ä¸æ»¡è¶³IFSè§¦å‘æ¡ä»¶ä¸ºæ­¢ï¼Œç»ˆæ­¢æ¡ä»¶ä¸ºä»¥ä¸‹**ä»»ä¸€**æ¡ä»¶:

1. `éœ€è¡¥è´§æ•°é‡ <= 0` (æ— éœ€è¡¥è´§)
2. `ç‰©æ–™æ¥æº != è‡ªåˆ¶` (å¤–è´­ä»¶ä¸æ¨é€)
3. `æ¥æºå·¥åº âˆ‰ {æ‰“åŒ…, ç»„è£…}` (ä¸æ”¯æŒçš„å·¥åºç±»å‹)
4. `å¤‡æ–™è®¡åˆ’ç¼–å· = null` (æ•°æ®æœªç”Ÿæˆ)

## å…«ã€åç»­å·¥ä½œå»ºè®®

### 8.1 ä¼˜å…ˆçº§1: ä¿®å¤æ’ç¨‹æ•°é‡è®¡ç®—é—®é¢˜

**é—®é¢˜**: å½“å¤©å¯ç”¨å·¥æ—¶ = 0ï¼Œå¯¼è‡´æ’ç¨‹æ•°é‡ = 0

**æ’æŸ¥æ–¹å‘**:
1. æ£€æŸ¥`dailyTotalHours`çš„æŸ¥è¯¢é€»è¾‘
2. æ£€æŸ¥`dailyScheduledHours`çš„ç´¯åŠ é€»è¾‘
3. éªŒè¯å·¥åºèƒ½åŠ›è´Ÿè·è¡¨æ•°æ®æ˜¯å¦æ­£ç¡®

### 8.2 ä¼˜å…ˆçº§2: å®Œå–„æµ‹è¯•éªŒè¯

**æµ‹è¯•è¦†ç›–**:
1. ç¬¬1è½®æ¨é€ï¼ˆä¸»ç”Ÿäº§è®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ â†’ æ‰“åŒ…å·¥åºè®¡åˆ’ï¼‰
2. ç¬¬2è½®æ¨é€ï¼ˆæ‰“åŒ…å·¥åºè®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ â†’ ç»„è£…å·¥åºè®¡åˆ’ï¼‰
3. ç¬¬3è½®æ¨é€ï¼ˆç»„è£…å·¥åºè®¡åˆ’ â†’ å¤‡æ–™è®¡åˆ’ â†’ ...ï¼‰
4. é€’å½’ç»ˆæ­¢æ¡ä»¶éªŒè¯

### 8.3 ä¼˜å…ˆçº§3: æ€§èƒ½ä¼˜åŒ–

**ä¼˜åŒ–æ–¹å‘**:
1. æ‰¹é‡æ¨é€ä¼˜åŒ–ï¼ˆå‡å°‘æ•°æ®åº“äº‹åŠ¡æ¬¡æ•°ï¼‰
2. é˜²é‡å¤æ¨é€ä¼˜åŒ–ï¼ˆä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢ï¼‰
3. æ—¥å¿—è¾“å‡ºä¼˜åŒ–ï¼ˆå‡å°‘ä¸å¿…è¦çš„æ—¥å¿—ï¼‰

## ä¹ã€å¤‡æ³¨ä¸è¯´æ˜

### 9.1 ä¸çœŸå·¥åºè®¡åˆ’çš„åŒºåˆ«

**ç¦æ­¢æ¨é€åˆ°çœŸå·¥åºè®¡åˆ’**çš„åŸå› :
- çœŸå·¥åºè®¡åˆ’ä¸å·¥åºèƒ½åŠ›è´Ÿè·è¡¨çš„å·²å ç”¨å·¥æ—¶åŒæ­¥å­˜åœ¨é—®é¢˜
- å·²æœ‰è®°å¿†è§„åˆ™æ˜ç¡®æŒ‡å‡ºï¼š"ç¦ç”¨å¤‡æ–™è®¡åˆ’å‘çœŸå·¥åºè®¡åˆ’æ•°æ®æ¨é€"
- å½“å‰ä»…æ”¯æŒæ¨é€åˆ°æ‰“åŒ…å·¥åºè®¡åˆ’å’Œç»„è£…å·¥åºè®¡åˆ’

### 9.2 å­—æ®µå‘½åè§„èŒƒ

**å‰ç«¯é¡µé¢æ˜¾ç¤ºå­—æ®µ â†’ æ•°æ®åº“å­—æ®µæ˜ å°„**:

ç”¨æˆ·åœ¨æè¿°éœ€æ±‚æ—¶ä½¿ç”¨çš„æ˜¯å‰ç«¯å¯è§å­—æ®µåï¼ˆå¦‚"äº§å‡ºå·¥åº"ï¼‰ï¼Œéœ€è¦æ˜ å°„åˆ°ä»£ç ä¸­çš„å®é™…å­—æ®µåï¼ˆå¦‚`outputProcess`æˆ–`process_name`ï¼‰ã€‚

**ç¤ºä¾‹**:
- "æ¥æºå·¥åº" â†’ `sourceProcess` / `source_process`
- "äº§å‡ºå·¥åº" â†’ `outputProcess` / `process_name`
- "éœ€è¡¥è´§æ•°é‡" â†’ `replenishmentQuantity` / `replenishment_quantity`

### 9.3 Gitæäº¤è®°å½•

**å¤‡ä»½æ ‡ç­¾**: `backup-before-dataflow-20251215-070121`

**æäº¤è®°å½•**:
1. `18dd3dd` - ğŸ“„ æ·»åŠ å¤‡æ–™è®¡åˆ’åˆ°ç»„è£…å·¥åºè®¡åˆ’æ•°æ®æµè§„åˆ™è¯´æ˜æ–‡æ¡£
2. `1d8f87c` - ğŸ“„ æ·»åŠ æ•°æ®æµè§„åˆ™æŠ€æœ¯å®ç°æ€»ç»“æ–‡æ¡£
3. (å¾…æäº¤) - âœ¨ å¯ç”¨å¤‡æ–™è®¡åˆ’æ¨é€é€»è¾‘å¹¶å®Œå–„æ’ç¨‹æ•°é‡è®¡ç®—

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-12-15 07:30  
**æŠ¥å‘Šç‰ˆæœ¬**: v1.0  
**çŠ¶æ€**: åŠŸèƒ½å·²å®ç°ï¼Œå­˜åœ¨å·²çŸ¥é—®é¢˜å¾…ä¿®å¤
