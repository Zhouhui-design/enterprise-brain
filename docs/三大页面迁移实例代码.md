# ä¸‰å¤§é¡µé¢è¿ç§»å®ä¾‹ä»£ç 

> ğŸ“Œ è¿™æ˜¯è®¢å•åˆ—è¡¨ã€ä¸»ç”Ÿäº§è®¡åˆ’ã€å¤‡æ–™è®¡åˆ’ä¸‰ä¸ªé¡µé¢ä½¿ç”¨ `StandardTablePage` çš„å®Œæ•´å®ä¾‹ä»£ç 

---

## 1ï¸âƒ£ è®¢å•åˆ—è¡¨ï¼ˆSalesOrderListNew.vueï¼‰

### å®Œæ•´ä»£ç 

```vue
<template>
  <StandardTablePage
    page-title="é”€å”®è®¢å•åˆ—è¡¨"
    settings-key="sales-order-list"
    :table-data="orderList"
    :columns="orderColumns"
    :loading="loading"
    :total="total"
    :current-page="currentPage"
    :page-size="pageSize"
    :show-business-vars="false"
    :show-encoding-settings="false"
    @page-change="handlePageChange"
    @size-change="handleSizeChange"
    @refresh="loadOrders"
    @batch-delete="handleBatchDelete"
    @export="handleExport"
    @settings-save="handleSettingsSave"
  >
    <!-- æœç´¢è¡¨å• -->
    <template #search-form>
      <el-form :model="searchForm" :inline="true">
        <el-form-item label="å†…éƒ¨è®¢å•ç¼–å·">
          <el-input 
            v-model="searchForm.internalOrderNo" 
            placeholder="è¾“å…¥å†…éƒ¨è®¢å•ç¼–å·" 
            clearable 
            style="width: 180px;"
          />
        </el-form-item>
        <el-form-item label="å®¢æˆ·è®¢å•ç¼–å·">
          <el-input 
            v-model="searchForm.customerOrderNo" 
            placeholder="è¾“å…¥å®¢æˆ·è®¢å•ç¼–å·" 
            clearable 
            style="width: 180px;"
          />
        </el-form-item>
        <el-form-item label="å®¢æˆ·åç§°">
          <el-input 
            v-model="searchForm.customerName" 
            placeholder="è¾“å…¥å®¢æˆ·åç§°" 
            clearable 
            style="width: 160px;"
          />
        </el-form-item>
        <el-form-item label="ä¸‹å•æ—¥æœŸ">
          <el-date-picker
            v-model="searchForm.dateRange"
            type="daterange"
            range-separator="è‡³"
            start-placeholder="å¼€å§‹æ—¥æœŸ"
            end-placeholder="ç»“æŸæ—¥æœŸ"
            style="width: 280px;"
          />
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">
            <el-icon><Search /></el-icon>
            æœç´¢
          </el-button>
          <el-button @click="handleReset">
            <el-icon><RefreshLeft /></el-icon>
            é‡ç½®
          </el-button>
        </el-form-item>
      </el-form>
    </template>

    <!-- è‡ªå®šä¹‰å·¥å…·æ  -->
    <template #toolbar-left>
      <el-button type="primary" @click="handleAddOrder">
        <el-icon><Plus /></el-icon>
        æ–°å¢è®¢å•
      </el-button>
    </template>

    <!-- è‡ªå®šä¹‰åˆ—æ˜¾ç¤º -->
    <template #column-orderTime="{ row }">
      <span>{{ formatDateYMD(row.orderTime) }}</span>
    </template>
    
    <template #column-customerDelivery="{ row }">
      <span>{{ formatDateYMD(row.customerDelivery) }}</span>
    </template>

    <template #column-productImage="{ row }">
      <el-image
        v-if="row.productImage"
        :src="row.productImage"
        :preview-src-list="[row.productImage]"
        fit="cover"
        style="width: 50px; height: 50px; border-radius: 4px;"
      />
      <span v-else style="color: #ccc;">æ— å›¾ç‰‡</span>
    </template>

    <template #column-orderStatus="{ row }">
      <el-tag :type="getStatusType(row.orderStatus)">
        {{ getStatusText(row.orderStatus) }}
      </el-tag>
    </template>

    <!-- æ“ä½œåˆ— -->
    <template #operation="{ row }">
      <el-button size="small" @click="handleEdit(row)">
        <el-icon><Edit /></el-icon>
        ç¼–è¾‘
      </el-button>
      <el-button 
        size="small" 
        type="primary" 
        @click="handleFormalOrder(row)"
        :disabled="row.orderStatus === '2'"
      >
        <el-icon><CircleCheck /></el-icon>
        æ­£å¼ä¸‹å•
      </el-button>
      <el-button 
        size="small" 
        type="danger" 
        @click="handleDelete(row)"
      >
        <el-icon><Delete /></el-icon>
        åˆ é™¤
      </el-button>
    </template>
  </StandardTablePage>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Search, RefreshLeft, Plus, Edit, CircleCheck, Delete } from '@element-plus/icons-vue'
import StandardTablePage from '@/components/common/layout/StandardTablePage.vue'
import axios from 'axios'

// ========== åˆ—å®šä¹‰ ==========
const orderColumns = [
  { 
    prop: 'internalOrderNo', 
    label: 'å†…éƒ¨è®¢å•ç¼–å·', 
    width: 180, 
    filterable: true,
    fixed: 'left'
  },
  { 
    prop: 'customerOrderNo', 
    label: 'å®¢æˆ·è®¢å•ç¼–å·', 
    width: 160, 
    filterable: true 
  },
  { 
    prop: 'customerName', 
    label: 'å®¢æˆ·åç§°', 
    width: 180, 
    filterable: true 
  },
  { 
    prop: 'productImage', 
    label: 'äº§å“å›¾ç‰‡', 
    width: 100 
  },
  { 
    prop: 'productCode', 
    label: 'äº§å“ç¼–å·', 
    width: 140 
  },
  { 
    prop: 'productName', 
    label: 'äº§å“åç§°', 
    width: 200 
  },
  { 
    prop: 'orderQuantity', 
    label: 'è®¢å•æ•°é‡', 
    width: 100, 
    align: 'right' 
  },
  { 
    prop: 'orderTime', 
    label: 'ä¸‹å•æ—¶é—´', 
    width: 140, 
    filterable: true, 
    filterType: 'date' 
  },
  { 
    prop: 'customerDelivery', 
    label: 'å®¢æˆ·äº¤æœŸ', 
    width: 140, 
    filterable: true, 
    filterType: 'date' 
  },
  { 
    prop: 'outputProcess', 
    label: 'äº§å‡ºå·¥åº', 
    width: 140 
  },
  { 
    prop: 'orderStatus', 
    label: 'è®¢å•çŠ¶æ€', 
    width: 100, 
    filterable: true,
    filterType: 'select'
  }
]

// ========== æ•°æ®çŠ¶æ€ ==========
const orderList = ref([])
const loading = ref(false)
const total = ref(0)
const currentPage = ref(1)
const pageSize = ref(20)
const searchForm = ref({
  internalOrderNo: '',
  customerOrderNo: '',
  customerName: '',
  dateRange: []
})

// ========== åŠ è½½è®¢å•æ•°æ® ==========
const loadOrders = async () => {
  loading.value = true
  try {
    const params = {
      page: currentPage.value,
      pageSize: pageSize.value,
      internalOrderNo: searchForm.value.internalOrderNo,
      customerOrderNo: searchForm.value.customerOrderNo,
      customerName: searchForm.value.customerName
    }
    
    if (searchForm.value.dateRange && searchForm.value.dateRange.length === 2) {
      params.startDate = formatDateYMD(searchForm.value.dateRange[0])
      params.endDate = formatDateYMD(searchForm.value.dateRange[1])
    }
    
    const { data } = await axios.get('/api/sales/orders', { params })
    orderList.value = data.list || []
    total.value = data.total || 0
    
    console.log('âœ… è®¢å•æ•°æ®åŠ è½½æˆåŠŸ:', orderList.value.length, 'æ¡')
  } catch (error) {
    console.error('âŒ åŠ è½½è®¢å•å¤±è´¥:', error)
    ElMessage.error('åŠ è½½è®¢å•å¤±è´¥')
  } finally {
    loading.value = false
  }
}

// ========== æ—¥æœŸæ ¼å¼åŒ– ==========
const formatDateYMD = (dateStr) => {
  if (!dateStr) return '-'
  try {
    const date = new Date(dateStr)
    if (isNaN(date.getTime())) return '-'
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    return `${year}-${month}-${day}`
  } catch (e) {
    return '-'
  }
}

// ========== è®¢å•çŠ¶æ€ ==========
const getStatusType = (status) => {
  const statusMap = {
    '1': '',           // å¾…ä¸‹å•
    '2': 'success',    // å·²ä¸‹å•
    '3': 'warning',    // è¿›è¡Œä¸­
    '4': 'info'        // å·²å®Œæˆ
  }
  return statusMap[status] || ''
}

const getStatusText = (status) => {
  const statusMap = {
    '1': 'å¾…ä¸‹å•',
    '2': 'å·²ä¸‹å•',
    '3': 'è¿›è¡Œä¸­',
    '4': 'å·²å®Œæˆ'
  }
  return statusMap[status] || 'æœªçŸ¥'
}

// ========== äº‹ä»¶å¤„ç† ==========
const handlePageChange = (page) => {
  currentPage.value = page
  loadOrders()
}

const handleSizeChange = (size) => {
  pageSize.value = size
  currentPage.value = 1
  loadOrders()
}

const handleSearch = () => {
  currentPage.value = 1
  loadOrders()
}

const handleReset = () => {
  searchForm.value = {
    internalOrderNo: '',
    customerOrderNo: '',
    customerName: '',
    dateRange: []
  }
  handleSearch()
}

const handleSettingsSave = (settings) => {
  console.log('âœ… è®¢å•åˆ—è¡¨è®¾ç½®å·²ä¿å­˜:', settings)
  ElMessage.success('è®¾ç½®å·²ä¿å­˜')
}

const handleAddOrder = () => {
  console.log('æ–°å¢è®¢å•')
  // TODO: è·³è½¬åˆ°æ–°å¢è®¢å•é¡µé¢
}

const handleEdit = (row) => {
  console.log('ç¼–è¾‘è®¢å•:', row)
  // TODO: è·³è½¬åˆ°ç¼–è¾‘é¡µé¢
}

const handleFormalOrder = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®è®¤æ­£å¼ä¸‹å•å—ï¼Ÿ', 'æç¤º', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    await axios.post('/api/sales/orders/formal', { id: row.id })
    ElMessage.success('è®¢å•å·²æ­£å¼ä¸‹å•')
    loadOrders()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('æ­£å¼ä¸‹å•å¤±è´¥:', error)
      ElMessage.error('æ­£å¼ä¸‹å•å¤±è´¥')
    }
  }
}

const handleDelete = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®è®¤åˆ é™¤æ­¤è®¢å•å—ï¼Ÿ', 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    await axios.delete(`/api/sales/orders/${row.id}`)
    ElMessage.success('è®¢å•å·²åˆ é™¤')
    loadOrders()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('åˆ é™¤è®¢å•å¤±è´¥:', error)
      ElMessage.error('åˆ é™¤è®¢å•å¤±è´¥')
    }
  }
}

const handleBatchDelete = async (rows) => {
  try {
    await ElMessageBox.confirm(`ç¡®è®¤åˆ é™¤é€‰ä¸­çš„ ${rows.length} æ¡è®¢å•å—ï¼Ÿ`, 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    const ids = rows.map(row => row.id)
    await axios.post('/api/sales/orders/batch-delete', { ids })
    ElMessage.success('æ‰¹é‡åˆ é™¤æˆåŠŸ')
    loadOrders()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('æ‰¹é‡åˆ é™¤å¤±è´¥:', error)
      ElMessage.error('æ‰¹é‡åˆ é™¤å¤±è´¥')
    }
  }
}

const handleExport = () => {
  console.log('å¯¼å‡ºè®¢å•æ•°æ®')
  // TODO: å®ç°å¯¼å‡ºåŠŸèƒ½
  ElMessage.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­')
}

// ========== åˆå§‹åŒ– ==========
onMounted(() => {
  loadOrders()
})
</script>

<style scoped>
/* è‡ªå®šä¹‰æ ·å¼ï¼ˆå¦‚éœ€è¦ï¼‰ */
</style>
```

---

## 2ï¸âƒ£ ä¸»ç”Ÿäº§è®¡åˆ’ï¼ˆProductionPlanList.vueï¼‰

### å®Œæ•´ä»£ç 

```vue
<template>
  <StandardTablePage
    page-title="ä¸»ç”Ÿäº§è®¡åˆ’"
    settings-key="production-plan-list"
    :table-data="planList"
    :columns="planColumns"
    :loading="loading"
    :total="total"
    :current-page="currentPage"
    :page-size="pageSize"
    :show-business-vars="true"
    :default-settings="defaultSettings"
    :show-toolbar="true"
    @page-change="handlePageChange"
    @size-change="handleSizeChange"
    @refresh="loadPlans"
    @batch-delete="handleBatchDelete"
    @export="handleExport"
    @settings-save="handleSettingsSave"
  >
    <!-- è‡ªå®šä¹‰å·¥å…·æ  -->
    <template #toolbar-left>
      <el-button
        type="primary"
        :disabled="selectedRows.length !== 1"
        @click="handleExecuteSchedule"
      >
        <el-icon><Timer /></el-icon>
        æ‰§è¡Œæ’ç¨‹
      </el-button>
      <el-tooltip content="è¯·é€‰æ‹©ä¸”ä»…é€‰æ‹©ä¸€æ¡ä¸»è®¡åˆ’" placement="top" v-if="selectedRows.length !== 1">
        <el-icon style="margin-left: 8px; color: #909399;"><QuestionFilled /></el-icon>
      </el-tooltip>
    </template>

    <!-- æœç´¢è¡¨å• -->
    <template #search-form>
      <el-form :model="searchForm" :inline="true">
        <el-form-item label="ä¸»è®¡åˆ’ç¼–å·">
          <el-input 
            v-model="searchForm.planCode" 
            placeholder="è¾“å…¥ä¸»è®¡åˆ’ç¼–å·" 
            clearable 
            style="width: 180px;"
          />
        </el-form-item>
        <el-form-item label="è®¢å•ç¼–å·">
          <el-input 
            v-model="searchForm.orderNo" 
            placeholder="è¾“å…¥è®¢å•ç¼–å·" 
            clearable 
            style="width: 180px;"
          />
        </el-form-item>
        <el-form-item label="äº§å“åç§°">
          <el-input 
            v-model="searchForm.productName" 
            placeholder="è¾“å…¥äº§å“åç§°" 
            clearable 
            style="width: 160px;"
          />
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">
            <el-icon><Search /></el-icon>
            æœç´¢
          </el-button>
          <el-button @click="handleReset">
            <el-icon><RefreshLeft /></el-icon>
            é‡ç½®
          </el-button>
        </el-form-item>
      </el-form>
    </template>

    <!-- è‡ªå®šä¹‰åˆ—æ˜¾ç¤º -->
    <template #column-productImage="{ row }">
      <el-image
        v-if="row.productImage"
        :src="row.productImage"
        :preview-src-list="[row.productImage]"
        fit="cover"
        style="width: 50px; height: 50px; border-radius: 4px;"
      />
      <span v-else style="color: #ccc;">æ— å›¾ç‰‡</span>
    </template>

    <template #column-promisedDeliveryDate="{ row }">
      <span>{{ formatDateYMD(row.promisedDeliveryDate) }}</span>
    </template>
    
    <template #column-plannedStorageDate="{ row }">
      <span>{{ formatDateYMD(row.plannedStorageDate) }}</span>
    </template>

    <!-- æ“ä½œåˆ— -->
    <template #operation="{ row }">
      <el-button size="small" @click="handleEdit(row)">
        <el-icon><Edit /></el-icon>
        ç¼–è¾‘
      </el-button>
      <el-button size="small" type="danger" @click="handleDelete(row)">
        <el-icon><Delete /></el-icon>
        åˆ é™¤
      </el-button>
    </template>
  </StandardTablePage>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Search, RefreshLeft, Timer, QuestionFilled, Edit, Delete } from '@element-plus/icons-vue'
import StandardTablePage from '@/components/common/layout/StandardTablePage.vue'
import axios from 'axios'

// ========== åˆ—å®šä¹‰ ==========
const planColumns = [
  { 
    prop: 'planCode', 
    label: 'ä¸»ç”Ÿäº§è®¡åˆ’ç¼–å·', 
    width: 200, 
    filterable: true,
    fixed: 'left'
  },
  { 
    prop: 'productCode', 
    label: 'äº§å“ç¼–å·', 
    width: 140, 
    filterable: true 
  },
  { 
    prop: 'productImage', 
    label: 'äº§å“å›¾ç‰‡', 
    width: 100 
  },
  { 
    prop: 'productName', 
    label: 'äº§å“åç§°', 
    width: 200, 
    filterable: true 
  },
  { 
    prop: 'outputProcess', 
    label: 'äº§å‡ºå·¥åº', 
    width: 140 
  },
  { 
    prop: 'planQuantity', 
    label: 'è®¡åˆ’æ•°é‡', 
    width: 100, 
    align: 'right' 
  },
  { 
    prop: 'promisedDeliveryDate', 
    label: 'è®¢å•æ‰¿è¯ºäº¤æœŸ', 
    width: 140, 
    filterable: true, 
    filterType: 'date' 
  },
  { 
    prop: 'plannedStorageDate', 
    label: 'è®¡åˆ’å…¥åº“æ—¥æœŸ', 
    width: 140, 
    filterable: true, 
    filterType: 'date' 
  },
  { 
    prop: 'internalOrderNo', 
    label: 'å†…éƒ¨é”€å”®è®¢å•ç¼–å·', 
    width: 180 
  },
  { 
    prop: 'customerOrderNo', 
    label: 'å®¢æˆ·è®¢å•ç¼–å·', 
    width: 160 
  }
]

// ========== é»˜è®¤è®¾ç½®ï¼ˆå«ä¸šåŠ¡å˜é‡ï¼‰ ==========
const defaultSettings = {
  businessVars: {
    advanceStorageDays: 7  // æå‰å…¥åº“æœŸé»˜è®¤å€¼
  }
}

// ========== æ•°æ®çŠ¶æ€ ==========
const planList = ref([])
const loading = ref(false)
const total = ref(0)
const currentPage = ref(1)
const pageSize = ref(20)
const selectedRows = ref([])
const searchForm = ref({
  planCode: '',
  orderNo: '',
  productName: ''
})

// ========== åŠ è½½æ•°æ® ==========
const loadPlans = async () => {
  loading.value = true
  try {
    const params = {
      page: currentPage.value,
      pageSize: pageSize.value,
      ...searchForm.value
    }
    
    const { data } = await axios.get('/api/production/plans', { params })
    planList.value = data.list || []
    total.value = data.total || 0
    
    console.log('âœ… ä¸»ç”Ÿäº§è®¡åˆ’æ•°æ®åŠ è½½æˆåŠŸ:', planList.value.length, 'æ¡')
  } catch (error) {
    console.error('âŒ åŠ è½½ä¸»ç”Ÿäº§è®¡åˆ’å¤±è´¥:', error)
    ElMessage.error('åŠ è½½ä¸»ç”Ÿäº§è®¡åˆ’å¤±è´¥')
  } finally {
    loading.value = false
  }
}

// ========== æ—¥æœŸæ ¼å¼åŒ– ==========
const formatDateYMD = (dateStr) => {
  if (!dateStr) return '-'
  try {
    const date = new Date(dateStr)
    if (isNaN(date.getTime())) return '-'
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    return `${year}-${month}-${day}`
  } catch (e) {
    return '-'
  }
}

// ========== äº‹ä»¶å¤„ç† ==========
const handlePageChange = (page) => {
  currentPage.value = page
  loadPlans()
}

const handleSizeChange = (size) => {
  pageSize.value = size
  currentPage.value = 1
  loadPlans()
}

const handleSearch = () => {
  currentPage.value = 1
  loadPlans()
}

const handleReset = () => {
  searchForm.value = {
    planCode: '',
    orderNo: '',
    productName: ''
  }
  handleSearch()
}

const handleSettingsSave = (settings) => {
  console.log('âœ… ä¸»ç”Ÿäº§è®¡åˆ’è®¾ç½®å·²ä¿å­˜:', settings)
  
  // è·å–ä¸šåŠ¡å˜é‡
  const advanceStorageDays = settings.businessVars?.advanceStorageDays
  if (advanceStorageDays !== undefined) {
    console.log('âœ… æå‰å…¥åº“æœŸ:', advanceStorageDays, 'å¤©')
    // å¯ä»¥å°†æå‰å…¥åº“æœŸä¿å­˜åˆ°åç«¯æˆ–å…¨å±€çŠ¶æ€
  }
  
  ElMessage.success('è®¾ç½®å·²ä¿å­˜')
}

const handleExecuteSchedule = async () => {
  if (selectedRows.value.length !== 1) {
    ElMessage.warning('è¯·é€‰æ‹©ä¸”ä»…é€‰æ‹©ä¸€æ¡ä¸»è®¡åˆ’')
    return
  }
  
  const plan = selectedRows.value[0]
  
  try {
    await ElMessageBox.confirm('ç¡®è®¤æ‰§è¡Œæ’ç¨‹å—ï¼Ÿå°†ç”Ÿæˆå¤‡æ–™è®¡åˆ’', 'æç¤º', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    await axios.post('/api/production/execute-schedule', { planCode: plan.planCode })
    ElMessage.success('æ’ç¨‹å·²æ‰§è¡Œï¼Œå¤‡æ–™è®¡åˆ’å·²ç”Ÿæˆ')
    loadPlans()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('æ‰§è¡Œæ’ç¨‹å¤±è´¥:', error)
      ElMessage.error('æ‰§è¡Œæ’ç¨‹å¤±è´¥')
    }
  }
}

const handleEdit = (row) => {
  console.log('ç¼–è¾‘ä¸»ç”Ÿäº§è®¡åˆ’:', row)
  // TODO: è·³è½¬åˆ°ç¼–è¾‘é¡µé¢
}

const handleDelete = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®è®¤åˆ é™¤æ­¤ä¸»ç”Ÿäº§è®¡åˆ’å—ï¼Ÿ', 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    await axios.delete(`/api/production/plans/${row.id}`)
    ElMessage.success('ä¸»ç”Ÿäº§è®¡åˆ’å·²åˆ é™¤')
    loadPlans()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('åˆ é™¤å¤±è´¥:', error)
      ElMessage.error('åˆ é™¤å¤±è´¥')
    }
  }
}

const handleBatchDelete = async (rows) => {
  try {
    await ElMessageBox.confirm(`ç¡®è®¤åˆ é™¤é€‰ä¸­çš„ ${rows.length} æ¡ä¸»ç”Ÿäº§è®¡åˆ’å—ï¼Ÿ`, 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    const ids = rows.map(row => row.id)
    await axios.post('/api/production/plans/batch-delete', { ids })
    ElMessage.success('æ‰¹é‡åˆ é™¤æˆåŠŸ')
    loadPlans()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('æ‰¹é‡åˆ é™¤å¤±è´¥:', error)
      ElMessage.error('æ‰¹é‡åˆ é™¤å¤±è´¥')
    }
  }
}

const handleExport = () => {
  console.log('å¯¼å‡ºä¸»ç”Ÿäº§è®¡åˆ’æ•°æ®')
  // TODO: å®ç°å¯¼å‡ºåŠŸèƒ½
  ElMessage.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­')
}

// ========== åˆå§‹åŒ– ==========
onMounted(() => {
  loadPlans()
})
</script>

<style scoped>
/* è‡ªå®šä¹‰æ ·å¼ï¼ˆå¦‚éœ€è¦ï¼‰ */
</style>
```

---

## 3ï¸âƒ£ å¤‡æ–™è®¡åˆ’ï¼ˆMaterialPreparationPlan.vueï¼‰

### å®Œæ•´ä»£ç 

```vue
<template>
  <StandardTablePage
    page-title="å¤‡æ–™è®¡åˆ’"
    settings-key="material-preparation-plan"
    :table-data="materialList"
    :columns="materialColumns"
    :loading="loading"
    :total="total"
    :current-page="currentPage"
    :page-size="pageSize"
    :show-business-vars="false"
    @page-change="handlePageChange"
    @size-change="handleSizeChange"
    @refresh="loadMaterials"
    @batch-delete="handleBatchDelete"
    @export="handleExport"
    @settings-save="handleSettingsSave"
  >
    <!-- æœç´¢è¡¨å• -->
    <template #search-form>
      <el-form :model="searchForm" :inline="true">
        <el-form-item label="å¤‡æ–™è®¡åˆ’ç¼–å·">
          <el-input 
            v-model="searchForm.planCode" 
            placeholder="è¾“å…¥å¤‡æ–™è®¡åˆ’ç¼–å·" 
            clearable 
            style="width: 180px;"
          />
        </el-form-item>
        <el-form-item label="æ¥æºä¸»è®¡åˆ’ç¼–å·">
          <el-input 
            v-model="searchForm.sourcePlanCode" 
            placeholder="è¾“å…¥æ¥æºä¸»è®¡åˆ’ç¼–å·" 
            clearable 
            style="width: 180px;"
          />
        </el-form-item>
        <el-form-item label="ç‰©æ–™åç§°">
          <el-input 
            v-model="searchForm.materialName" 
            placeholder="è¾“å…¥ç‰©æ–™åç§°" 
            clearable 
            style="width: 160px;"
          />
        </el-form-item>
        <el-form-item>
          <el-button type="primary" @click="handleSearch">
            <el-icon><Search /></el-icon>
            æœç´¢
          </el-button>
          <el-button @click="handleReset">
            <el-icon><RefreshLeft /></el-icon>
            é‡ç½®
          </el-button>
        </el-form-item>
      </el-form>
    </template>

    <!-- è‡ªå®šä¹‰åˆ—æ˜¾ç¤º -->
    <template #column-demandDate="{ row }">
      <span>{{ formatDateYMD(row.demandDate) }}</span>
    </template>
    
    <template #column-promiseDeliveryDate="{ row }">
      <span>{{ formatDateYMD(row.promiseDeliveryDate) }}</span>
    </template>

    <!-- æ“ä½œåˆ— -->
    <template #operation="{ row }">
      <el-button size="small" @click="handleEdit(row)">
        <el-icon><Edit /></el-icon>
        ç¼–è¾‘
      </el-button>
      <el-button size="small" type="danger" @click="handleDelete(row)">
        <el-icon><Delete /></el-icon>
        åˆ é™¤
      </el-button>
    </template>
  </StandardTablePage>
</template>

<script setup>
import { ref, onMounted } from 'vue'
import { ElMessage, ElMessageBox } from 'element-plus'
import { Search, RefreshLeft, Edit, Delete } from '@element-plus/icons-vue'
import StandardTablePage from '@/components/common/layout/StandardTablePage.vue'
import axios from 'axios'

// ========== åˆ—å®šä¹‰ ==========
const materialColumns = [
  { 
    prop: 'planCode', 
    label: 'å¤‡æ–™è®¡åˆ’ç¼–å·', 
    width: 200, 
    filterable: true,
    fixed: 'left'
  },
  { 
    prop: 'sourcePlanCode', 
    label: 'æ¥æºä¸»è®¡åˆ’ç¼–å·', 
    width: 200, 
    filterable: true 
  },
  { 
    prop: 'sourceProcessPlanCode', 
    label: 'æ¥æºå·¥åºè®¡åˆ’ç¼–å·', 
    width: 200 
  },
  { 
    prop: 'materialCode', 
    label: 'è®¡åˆ’ç‰©æ–™ç¼–å·', 
    width: 140 
  },
  { 
    prop: 'materialName', 
    label: 'è®¡åˆ’ç‰©æ–™åç§°', 
    width: 200, 
    filterable: true 
  },
  { 
    prop: 'materialSource', 
    label: 'ç‰©æ–™æ¥æº', 
    width: 120 
  },
  { 
    prop: 'materialUnit', 
    label: 'ç‰©æ–™å•ä½', 
    width: 100 
  },
  { 
    prop: 'demandQuantity', 
    label: 'éœ€æ±‚æ•°é‡', 
    width: 100, 
    align: 'right' 
  },
  { 
    prop: 'demandDate', 
    label: 'éœ€æ±‚æ—¥æœŸ', 
    width: 140, 
    filterable: true, 
    filterType: 'date' 
  },
  { 
    prop: 'internalOrderNo', 
    label: 'é”€å”®è®¢å•ç¼–å·', 
    width: 180 
  },
  { 
    prop: 'customerOrderNo', 
    label: 'å®¢æˆ·è®¢å•ç¼–å·', 
    width: 160 
  },
  { 
    prop: 'sourceProcess', 
    label: 'æ¥æºå·¥åº', 
    width: 140 
  }
]

// ========== æ•°æ®çŠ¶æ€ ==========
const materialList = ref([])
const loading = ref(false)
const total = ref(0)
const currentPage = ref(1)
const pageSize = ref(20)
const searchForm = ref({
  planCode: '',
  sourcePlanCode: '',
  materialName: ''
})

// ========== åŠ è½½æ•°æ® ==========
const loadMaterials = async () => {
  loading.value = true
  try {
    const params = {
      page: currentPage.value,
      pageSize: pageSize.value,
      ...searchForm.value
    }
    
    const { data } = await axios.get('/api/material/preparation', { params })
    materialList.value = data.list || []
    total.value = data.total || 0
    
    console.log('âœ… å¤‡æ–™è®¡åˆ’æ•°æ®åŠ è½½æˆåŠŸ:', materialList.value.length, 'æ¡')
  } catch (error) {
    console.error('âŒ åŠ è½½å¤‡æ–™è®¡åˆ’å¤±è´¥:', error)
    ElMessage.error('åŠ è½½å¤‡æ–™è®¡åˆ’å¤±è´¥')
  } finally {
    loading.value = false
  }
}

// ========== æ—¥æœŸæ ¼å¼åŒ– ==========
const formatDateYMD = (dateStr) => {
  if (!dateStr) return '-'
  try {
    const date = new Date(dateStr)
    if (isNaN(date.getTime())) return '-'
    const year = date.getFullYear()
    const month = String(date.getMonth() + 1).padStart(2, '0')
    const day = String(date.getDate()).padStart(2, '0')
    return `${year}-${month}-${day}`
  } catch (e) {
    return '-'
  }
}

// ========== äº‹ä»¶å¤„ç† ==========
const handlePageChange = (page) => {
  currentPage.value = page
  loadMaterials()
}

const handleSizeChange = (size) => {
  pageSize.value = size
  currentPage.value = 1
  loadMaterials()
}

const handleSearch = () => {
  currentPage.value = 1
  loadMaterials()
}

const handleReset = () => {
  searchForm.value = {
    planCode: '',
    sourcePlanCode: '',
    materialName: ''
  }
  handleSearch()
}

const handleSettingsSave = (settings) => {
  console.log('âœ… å¤‡æ–™è®¡åˆ’è®¾ç½®å·²ä¿å­˜:', settings)
  ElMessage.success('è®¾ç½®å·²ä¿å­˜')
}

const handleEdit = (row) => {
  console.log('ç¼–è¾‘å¤‡æ–™è®¡åˆ’:', row)
  // TODO: è·³è½¬åˆ°ç¼–è¾‘é¡µé¢
}

const handleDelete = async (row) => {
  try {
    await ElMessageBox.confirm('ç¡®è®¤åˆ é™¤æ­¤å¤‡æ–™è®¡åˆ’å—ï¼Ÿ', 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    await axios.delete(`/api/material/preparation/${row.id}`)
    ElMessage.success('å¤‡æ–™è®¡åˆ’å·²åˆ é™¤')
    loadMaterials()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('åˆ é™¤å¤±è´¥:', error)
      ElMessage.error('åˆ é™¤å¤±è´¥')
    }
  }
}

const handleBatchDelete = async (rows) => {
  try {
    await ElMessageBox.confirm(`ç¡®è®¤åˆ é™¤é€‰ä¸­çš„ ${rows.length} æ¡å¤‡æ–™è®¡åˆ’å—ï¼Ÿ`, 'è­¦å‘Š', {
      confirmButtonText: 'ç¡®å®š',
      cancelButtonText: 'å–æ¶ˆ',
      type: 'warning'
    })
    
    const ids = rows.map(row => row.id)
    await axios.post('/api/material/preparation/batch-delete', { ids })
    ElMessage.success('æ‰¹é‡åˆ é™¤æˆåŠŸ')
    loadMaterials()
  } catch (error) {
    if (error !== 'cancel') {
      console.error('æ‰¹é‡åˆ é™¤å¤±è´¥:', error)
      ElMessage.error('æ‰¹é‡åˆ é™¤å¤±è´¥')
    }
  }
}

const handleExport = () => {
  console.log('å¯¼å‡ºå¤‡æ–™è®¡åˆ’æ•°æ®')
  // TODO: å®ç°å¯¼å‡ºåŠŸèƒ½
  ElMessage.info('å¯¼å‡ºåŠŸèƒ½å¼€å‘ä¸­')
}

// ========== åˆå§‹åŒ– ==========
onMounted(() => {
  loadMaterials()
})
</script>

<style scoped>
/* è‡ªå®šä¹‰æ ·å¼ï¼ˆå¦‚éœ€è¦ï¼‰ */
</style>
```

---

## ğŸ“Š ä¸‰ä¸ªé¡µé¢å¯¹æ¯”æ€»ç»“

| é¡µé¢ | settingsKey | ä¸šåŠ¡å˜é‡ | è‡ªå®šä¹‰å·¥å…·æ  | ç‰¹æ®ŠåŠŸèƒ½ |
|------|-------------|---------|-------------|---------|
| è®¢å•åˆ—è¡¨ | `sales-order-list` | âŒ å¦ | âœ… æ–°å¢è®¢å•æŒ‰é’® | æ­£å¼ä¸‹å•ã€è®¢å•çŠ¶æ€æ˜¾ç¤º |
| ä¸»ç”Ÿäº§è®¡åˆ’ | `production-plan-list` | âœ… æ˜¯ï¼ˆæå‰å…¥åº“æœŸï¼‰ | âœ… æ‰§è¡Œæ’ç¨‹æŒ‰é’® | ç”Ÿæˆå¤‡æ–™è®¡åˆ’ |
| å¤‡æ–™è®¡åˆ’ | `material-preparation-plan` | âŒ å¦ | âŒ æ—  | æ¥æºå·¥åºæ˜¾ç¤º |

---

## âœ¨ å…³é”®ç‰¹æ€§è¯´æ˜

### 1. åˆ—æ‹–æ‹½åŠŸèƒ½
æ‰€æœ‰ä¸‰ä¸ªé¡µé¢éƒ½è‡ªåŠ¨è·å¾—åˆ—æ‹–æ‹½åŠŸèƒ½ï¼š
- ç‚¹å‡»å³ä¸Šè§’"è®¾ç½®"å›¾æ ‡
- è¿›å…¥"å­—æ®µç®¡ç†"Tab
- æ‹–åŠ¨å­—æ®µè°ƒæ•´é¡ºåº
- å‹¾é€‰/å–æ¶ˆå‹¾é€‰æ§åˆ¶æ˜¾ç¤º/éšè—

### 2. ä¸šåŠ¡å˜é‡ï¼ˆä¸»ç”Ÿäº§è®¡åˆ’ä¸“å±ï¼‰
```javascript
const defaultSettings = {
  businessVars: {
    advanceStorageDays: 7  // æå‰å…¥åº“æœŸ
  }
}

const handleSettingsSave = (settings) => {
  const advanceStorageDays = settings.businessVars?.advanceStorageDays
  console.log('æå‰å…¥åº“æœŸ:', advanceStorageDays, 'å¤©')
}
```

### 3. æ—¥æœŸæ ¼å¼ç»Ÿä¸€
æ‰€æœ‰æ—¥æœŸå­—æ®µä½¿ç”¨ç»Ÿä¸€çš„æ ¼å¼åŒ–å‡½æ•°ï¼š
```javascript
const formatDateYMD = (dateStr) => {
  if (!dateStr) return '-'
  const date = new Date(dateStr)
  return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`
}
```

### 4. è‡ªå®šä¹‰å·¥å…·æ 
- **è®¢å•åˆ—è¡¨**ï¼šæ–°å¢è®¢å•æŒ‰é’®
- **ä¸»ç”Ÿäº§è®¡åˆ’**ï¼šæ‰§è¡Œæ’ç¨‹æŒ‰é’®ï¼ˆéœ€é€‰æ‹©ä¸€æ¡è®°å½•ï¼‰
- **å¤‡æ–™è®¡åˆ’**ï¼šæ— è‡ªå®šä¹‰å·¥å…·æ 

---

ğŸ“… **æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
ğŸ“ **æœ€åæ›´æ–°**: 2025-12-08  
ğŸ¯ **ç”¨é€”**: ä¸‰å¤§é¡µé¢è¿ç§»å®Œæ•´å®ä¾‹ä»£ç 
