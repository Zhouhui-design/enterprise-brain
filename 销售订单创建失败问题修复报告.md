# 销售订单创建失败问题修复报告

## 问题描述
在销售订单管理页面点击"新增"按钮，输入产品信息后点击提交，页面提示"保存订单失败: 创建订单失败"，控制台输出500错误。

## 错误原因
通过API测试发现错误信息：
```json
{
  "success": false,
  "message": "创建订单失败",
  "error": "Unknown column 'submitter' in 'field list'"
}
```

数据库表结构中缺少必要的字段：
1. `sales_orders`表缺少`submitter`字段
2. `sales_order_products`表缺少`output_process`字段

## 修复方案

### 1. 添加submitter字段到sales_orders表
```sql
ALTER TABLE sales_orders ADD COLUMN submitter VARCHAR(100) DEFAULT 'admin' COMMENT '提交人' AFTER salesperson;
```

### 2. 添加output_process字段到sales_order_products表
```sql
ALTER TABLE sales_order_products ADD COLUMN output_process VARCHAR(100) COMMENT '产出工序' AFTER accessories;
```

## 测试验证

修复后的测试请求：
```bash
curl -X POST http://localhost:3003/api/sales-orders \
  -H "Content-Type: application/json" \
  -d '{
    "customerName": "测试客户",
    "customerOrderNo": "TEST001",
    "salesperson": "销售员",
    "products": [
      {
        "productCode": "6001A0306",
        "productName": "测试产品",
        "productSpec": "规格",
        "orderQuantity": 100,
        "unitPriceExcludingTax": 10,
        "totalPrice": 1000,
        "outputProcess": "打包"
      }
    ]
  }'
```

测试结果：
```json
{
  "success": true,
  "message": "创建订单成功",
  "data": {
    "id": "c95cc4a0-54ad-4f86-8caf-0347f69a9314",
    "internal_order_no": "SO2025000001",
    "customer_name": "测试客户",
    "status": "draft",
    ...
  }
}
```

## 修复结果
✅ 销售订单创建功能已修复
✅ API测试通过
✅ 前端页面应该可以正常创建订单

## 影响范围
- 数据库表结构变更
- 销售订单创建API
- 前端销售订单新增页面

## 备份信息
- 已在分支feature-3进行修复
- 数据库变更已记录
- 修复前代码已备份