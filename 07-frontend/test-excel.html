<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOMå¯¼å‡ºåŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #409EFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #337ecc;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        .success {
            background: #f0f9ff;
            border: 1px solid #409EFF;
            color: #409EFF;
        }
        .error {
            background: #fef0f0;
            border: 1px solid #F56C6C;
            color: #F56C6C;
        }
    </style>
</head>
<body>
    <h1>BOMå¯¼å‡ºåŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•æ•°æ®</h3>
        <p>ä»¥ä¸‹æ˜¯è¦å¯¼å‡ºçš„BOMæµ‹è¯•æ•°æ®ï¼š</p>
        <pre id="testData"></pre>
    </div>

    <div class="test-section">
        <h3>æµ‹è¯•æ“ä½œ</h3>
        <button class="test-button" onclick="testExport()">æµ‹è¯•å¯¼å‡ºåŠŸèƒ½</button>
        <button class="test-button" onclick="testImport()">æµ‹è¯•å¯¼å…¥åŠŸèƒ½</button>
        <button class="test-button" onclick="testTemplate()">æµ‹è¯•æ¨¡æ¿åŠŸèƒ½</button>
    </div>

    <div id="result" class="result" style="display: none;">
        <h3>æµ‹è¯•ç»“æœ</h3>
        <div id="resultContent"></div>
    </div>

    <script type="module">
        // æµ‹è¯•æ•°æ®
        const testData = [
            {
                bomCode: 'TEST-BOM-001',
                bomName: 'æµ‹è¯•BOMäº§å“',
                productCode: 'P-TEST-001',
                productName: 'æµ‹è¯•äº§å“A',
                version: 'V1.0',
                status: 'draft',
                designer: 'æµ‹è¯•è®¾è®¡å¸ˆ',
                reviewer: 'æµ‹è¯•å®¡æ ¸å‘˜',
                itemCount: 2,
                effectiveDate: '2024-01-01',
                totalLabor: 100,
                totalMaterial: 500,
                isPushedToManual: false,
                createTime: '2024-01-01 10:00:00',
                updateTime: '2024-01-01 10:00:00',
                remark: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•BOM',
                childItems: [
                    {
                        sequence: 1,
                        level: 1,
                        levelPath: '1',
                        childCode: 'C-001',
                        childName: 'æµ‹è¯•å­ä»¶A',
                        standardQty: 2,
                        level0Qty: 2,
                        outputProcess: 'ç»„è£…',
                        source: 'è‡ªåˆ¶',
                        processWage: 20,
                        materialLoss: 5,
                        materialPrice: 100,
                        materialCost: 210,
                        level0Labor: 40,
                        nextProductSource: '',
                        nextProcessName: '',
                        nextProductCode: '',
                        nextProductName: '',
                        nextStandardQty: 1,
                        nextLevelAddress: ''
                    },
                    {
                        sequence: 2,
                        level: 1,
                        levelPath: '2',
                        childCode: 'C-002',
                        childName: 'æµ‹è¯•å­ä»¶B',
                        standardQty: 1,
                        level0Qty: 1,
                        outputProcess: 'åŒ…è£…',
                        source: 'å¤–è´­',
                        processWage: 10,
                        materialLoss: 2,
                        materialPrice: 200,
                        materialCost: 204,
                        level0Labor: 20,
                        nextProductSource: '',
                        nextProcessName: '',
                        nextProductCode: '',
                        nextProductName: '',
                        nextStandardQty: 1,
                        nextLevelAddress: ''
                    }
                ]
            }
        ];

        // æ˜¾ç¤ºæµ‹è¯•æ•°æ®
        document.getElementById('testData').textContent = JSON.stringify(testData, null, 2);

        // æ˜¾ç¤ºç»“æœå‡½æ•°
        function showResult(success, message) {
            const resultDiv = document.getElementById('result');
            const resultContent = document.getElementById('resultContent');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + (success ? 'success' : 'error');
            resultContent.textContent = message;
        }

        // æµ‹è¯•å¯¼å‡ºåŠŸèƒ½
        window.testExport = async function() {
            try {
                console.log('ğŸ§ª å¼€å§‹æµ‹è¯•å¯¼å‡ºåŠŸèƒ½...');
                
                // åŠ¨æ€å¯¼å…¥Excelå·¥å…·
                const { exportBOMToExcel } = await import('./src/utils/excelUtils.js');
                
                const filename = await exportBOMToExcel(testData, {
                    includeChildren: true,
                    includeTemplate: true
                });
                
                showResult(true, `âœ… å¯¼å‡ºæµ‹è¯•æˆåŠŸï¼æ–‡ä»¶å: ${filename}`);
                console.log('âœ… å¯¼å‡ºæµ‹è¯•æˆåŠŸ:', filename);
                
            } catch (error) {
                console.error('âŒ å¯¼å‡ºæµ‹è¯•å¤±è´¥:', error);
                showResult(false, `âŒ å¯¼å‡ºæµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };

        // æµ‹è¯•å¯¼å…¥åŠŸèƒ½
        window.testImport = async function() {
            try {
                console.log('ğŸ§ª å¼€å§‹æµ‹è¯•å¯¼å…¥åŠŸèƒ½...');
                
                // åŠ¨æ€å¯¼å…¥Excelå·¥å…·
                const { importBOMFromExcel } = await import('./src/utils/excelUtils.js');
                
                showResult(true, 'âœ… å¯¼å…¥å·¥å…·åŠ è½½æˆåŠŸï¼è¯·é€‰æ‹©Excelæ–‡ä»¶è¿›è¡Œæµ‹è¯•');
                console.log('âœ… å¯¼å…¥å·¥å…·åŠ è½½æˆåŠŸ');
                
            } catch (error) {
                console.error('âŒ å¯¼å…¥æµ‹è¯•å¤±è´¥:', error);
                showResult(false, `âŒ å¯¼å…¥æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };

        // æµ‹è¯•æ¨¡æ¿åŠŸèƒ½
        window.testTemplate = async function() {
            try {
                console.log('ğŸ§ª å¼€å§‹æµ‹è¯•æ¨¡æ¿åŠŸèƒ½...');
                
                // åŠ¨æ€å¯¼å…¥Excelå·¥å…·
                const { createBOMTemplate } = await import('./src/utils/excelUtils.js');
                
                const template = createBOMTemplate();
                
                showResult(true, `âœ… æ¨¡æ¿ç”Ÿæˆæµ‹è¯•æˆåŠŸï¼ç”Ÿæˆäº† ${template.length} ä¸ªæ¨¡æ¿é¡¹`);
                console.log('âœ… æ¨¡æ¿ç”Ÿæˆæµ‹è¯•æˆåŠŸ:', template);
                
            } catch (error) {
                console.error('âŒ æ¨¡æ¿æµ‹è¯•å¤±è´¥:', error);
                showResult(false, `âŒ æ¨¡æ¿æµ‹è¯•å¤±è´¥: ${error.message}`);
            }
        };
    </script>
</body>
</html>