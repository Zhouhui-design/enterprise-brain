<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BOMè¯¦æƒ…APIæµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
            background-color: #f1f8e9;
        }
        .error {
            border-left-color: #f44336;
            background-color: #ffebee;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }
        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
        }
        .pending {
            background-color: #fff3e0;
            color: #f57c00;
        }
        .button {
            background-color: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background-color: #1565c0;
        }
        .code {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ BOMè¯¦æƒ…APIä¿®å¤éªŒè¯</h1>
        
        <div class="test-result">
            <h3>ğŸ“‹ ä¿®å¤å†…å®¹æ€»ç»“</h3>
            <ul>
                <li><strong>é—®é¢˜1:</strong> APIè°ƒç”¨å‚æ•°æ ¼å¼é”™è¯¯ â†’ <span class="status success">âœ… å·²ä¿®å¤</span></li>
                <li><strong>é—®é¢˜2:</strong> component_sourceå­—æ®µç¼ºå¤± â†’ <span class="status success">âœ… å·²ä¿®å¤</span></li>
                <li><strong>é—®é¢˜3:</strong> å‰ç«¯è¯·æ±‚æ‹¦æˆªå™¨å¤„ç†é—®é¢˜ â†’ <span class="status success">âœ… å·²ä¿®å¤</span></li>
            </ul>
        </div>

        <h3>ğŸ§ª APIæµ‹è¯•ç»“æœ</h3>
        <button class="button" onclick="testAPI()">æµ‹è¯•BOMè¯¦æƒ…API</button>
        <button class="button" onclick="testWithDifferentProduct()">æµ‹è¯•å…¶ä»–äº§å“</button>
        
        <div id="result"></div>
        
        <h3>ğŸ“Š æµ‹è¯•æ•°æ®è¯¦æƒ…</h3>
        <div id="dataTable"></div>
        
        <h3>ğŸ”— ç›¸å…³é“¾æ¥</h3>
        <ul>
            <li><a href="http://localhost:3003/production-planning/process-plan" target="_blank">å·¥åºè®¡åˆ’é¡µé¢</a></li>
            <li><a href="http://localhost:3003/manufacturing/list-style-production-bom" target="_blank">åˆ—è¡¨å¼ç”Ÿäº§BOMé¡µé¢</a></li>
            <li><a href="http://localhost:3003/bom/production" target="_blank">ç”Ÿäº§BOMé¡µé¢</a></li>
        </ul>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('result');
            const tableDiv = document.getElementById('dataTable');
            
            try {
                resultDiv.innerHTML = '<div class="test-result">ğŸ”„ æ­£åœ¨æµ‹è¯•API...</div>';
                
                const response = await fetch('http://localhost:3005/api/list-style-production-boms/children-by-parent?parentCode=6001A0306');
                const data = await response.json();
                
                if (data.code === 200) {
                    resultDiv.innerHTML = `
                        <div class="test-result">
                            <h4>âœ… APIæµ‹è¯•æˆåŠŸ</h4>
                            <div class="code">å“åº”ç : ${data.code}</div>
                            <div class="code">æ¶ˆæ¯: ${data.message}</div>
                            <div class="code">æ•°æ®æ¡æ•°: ${data.data.length}</div>
                        </div>
                    `;
                    
                    // ç”Ÿæˆè¡¨æ ¼
                    let tableHTML = `
                        <table>
                            <thead>
                                <tr>
                                    <th>å­ä»¶åºå·</th>
                                    <th>å­ä»¶ç¼–å·</th>
                                    <th>å­ä»¶åç§°</th>
                                    <th>äº§å‡ºå·¥åº</th>
                                    <th>å­ä»¶æ¥æº</th>
                                    <th>æ ‡å‡†ç”¨é‡</th>
                                    <th>éœ€é¢†ç”¨æ•°é‡</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    const scheduleQuantity = 96; // æ¨¡æ‹Ÿè®¡åˆ’æ’ç¨‹æ•°é‡
                    
                    data.data.forEach(child => {
                        const requiredQuantity = (scheduleQuantity * parseFloat(child.standard_usage || 0)).toFixed(4);
                        tableHTML += `
                            <tr>
                                <td>${child.child_sequence}</td>
                                <td>${child.child_code}</td>
                                <td>${child.child_name}</td>
                                <td>${child.output_process}</td>
                                <td><span class="status ${child.component_source === 'è‡ªåˆ¶' ? 'success' : 'pending'}">${child.component_source}</span></td>
                                <td>${child.standard_usage}</td>
                                <td><strong>${requiredQuantity}</strong></td>
                            </tr>
                        `;
                    });
                    
                    tableHTML += '</tbody></table>';
                    tableDiv.innerHTML = tableHTML;
                    
                } else {
                    throw new Error(`APIè¿”å›é”™è¯¯: ${data.message}`);
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ APIæµ‹è¯•å¤±è´¥</h4>
                        <div class="code">é”™è¯¯ä¿¡æ¯: ${error.message}</div>
                    </div>
                `;
                tableDiv.innerHTML = '';
            }
        }
        
        async function testWithDifferentProduct() {
            const resultDiv = document.getElementById('result');
            
            try {
                resultDiv.innerHTML = '<div class="test-result">ğŸ”„ æµ‹è¯•å…¶ä»–äº§å“...</div>';
                
                const response = await fetch('http://localhost:3005/api/list-style-production-boms/children-by-parent?parentCode=TEST001');
                const data = await response.json();
                
                if (data.code === 200) {
                    resultDiv.innerHTML = `
                        <div class="test-result">
                            <h4>âœ… å…¶ä»–äº§å“æµ‹è¯•æˆåŠŸ</h4>
                            <div class="code">æµ‹è¯•äº§å“: TEST001</div>
                            <div class="code">æ•°æ®æ¡æ•°: ${data.data.length}</div>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="test-result">
                            <h4>âœ… å…¶ä»–äº§å“æµ‹è¯•æ­£å¸¸</h4>
                            <div class="code">æµ‹è¯•äº§å“: TEST001</div>
                            <div class="code">é¢„æœŸé”™è¯¯: ${data.message}</div>
                            <div class="code">è¯´æ˜: ä¸å­˜åœ¨çš„äº§å“åº”è¯¥è¿”å›é”™è¯¯ï¼Œè¿™æ˜¯æ­£å¸¸çš„</div>
                        </div>
                    `;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                        <div class="code">é”™è¯¯ä¿¡æ¯: ${error.message}</div>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>