
========================================
🧪 测试6001A0306递归数据流
========================================

📋 步骤1: 检查备料计划数据...

✅ MySQL数据库连接成功
📊 数据库: enterprise_brain
🔗 主机: localhost:3306
🔧 开始初始化数据库表结构...
✅ 找到备料计划:
   编号: MPP2025636877933
   物料: 6001A0306 - 6001A0306，铁质方向盘款，嘉博
   来源工序: 打包
   物料来源: 自制
   需补货数量: 100.0000
   需求数量: 100.0000
   可用库存: 0.0000

📤 步骤2: 触发备料计划推送到工序计划...

✅ 满足推送条件，开始推送...

🔄 开始自动触发推送检查...
📊 找到 5 条满足条件的备料计划

📤 开始推送备料计划: MPP2025636877933 (6001A0306, 自制, 100.0000)
⏭️ 检测到重复推送，跳过: MPP2025636877933 → RPP2025796579330 (表: packing_process_plans)
⏭️ 跳过推送: undefined - 原因: duplicate

📤 开始推送备料计划: MPP202512151765751636915127 (470001A, 自制, 96.0000)
⏭️ 检测到重复推送，跳过: MPP202512151765751636915127 → RPP2025796617617 (表: assembly_process_plans)
⏭️ 跳过推送: undefined - 原因: duplicate

📤 开始推送备料计划: MPP202512151765751636916848 (470002A, 自制, 96.0000)
⏭️ 检测到重复推送，跳过: MPP202512151765751636916848 → RPP2025796634461 (表: assembly_process_plans)
⏭️ 跳过推送: undefined - 原因: duplicate

📤 开始推送备料计划: MPP202512151765751636970501 (470001A, 自制, 4.0200)
⏭️ 检测到重复推送，跳过: MPP202512151765751636970501 → RPP2025796645302 (表: assembly_process_plans)
⏭️ 跳过推送: undefined - 原因: duplicate

📤 开始推送备料计划: MPP202512151765751636972202 (470002A, 自制, 4.0200)
⏭️ 检测到重复推送，跳过: MPP202512151765751636972202 → RPP2025796659784 (表: assembly_process_plans)
⏭️ 跳过推送: undefined - 原因: duplicate

📊 自动触发推送完成: 成功推送0条, 总计5条满足条件的备料计划

✅ 推送执行完成:
   满足条件的备料计划总数: 5
   成功推送数量: 0

🔍 步骤3: 检查打包工序计划是否生成...

✅ 找到 1 条打包工序计划:

   【1】打包工序计划:
   编号: RPP2025796579330
   产品: 6001A0306 - 6001A0306，铁质方向盘款，嘉博
   工序: 打包
   排程数量: 0.00
   排程日期: 2026-01-03
   来源编号: MPP2025636877933
   主计划产品: null


🔍 步骤4: 检查第2轮备料计划（BOM子件）...

✅ 找到 6 条第2轮备料计划（BOM子件）:

   【1】备料计划:
   编号: MPP202512151765751636915127
   物料: 470001A - 6001背头套袋件
   来源工序: 组装
   物料来源: 自制
   需补货数量: 96.0000
   父件: 6001A0306 - 6001A0306，铁质方向盘款，嘉博

   【2】备料计划:
   编号: MPP202512151765751636916848
   物料: 470002A - 6001主架套袋件
   来源工序: 组装
   物料来源: 自制
   需补货数量: 96.0000
   父件: 6001A0306 - 6001A0306，铁质方向盘款，嘉博

   【3】备料计划:
   编号: MPP202512151765751636916150
   物料: 511442B - 外箱
   来源工序: 采购
   物料来源: 外购
   需补货数量: 96.0000
   父件: 6001A0306 - 6001A0306，铁质方向盘款，嘉博

   【4】备料计划:
   编号: MPP202512151765751636970501
   物料: 470001A - 6001背头套袋件
   来源工序: 组装
   物料来源: 自制
   需补货数量: 4.0200
   父件: 6001A0306 - 6001A0306，铁质方向盘款，嘉博

   【5】备料计划:
   编号: MPP202512151765751636972202
   物料: 470002A - 6001主架套袋件
   来源工序: 组装
   物料来源: 自制
   需补货数量: 4.0200
   父件: 6001A0306 - 6001A0306，铁质方向盘款，嘉博

   【6】备料计划:
   编号: MPP202512151765751636973337
   物料: 511442B - 外箱
   来源工序: 采购
   物料来源: 外购
   需补货数量: 4.0200
   父件: 6001A0306 - 6001A0306，铁质方向盘款，嘉博


🔍 步骤5: 检查组装工序计划（第2轮推送）...

✅ 找到 4 条组装工序计划:

   【1】组装工序计划:
   编号: RPP2025796617617
   产品: 470001A - 6001背头套袋件
   工序: 组装
   排程数量: 0.00
   排程日期: 2026-01-03
   来源编号: MPP202512151765751636915127
   主计划产品: null

   【2】组装工序计划:
   编号: RPP2025796634461
   产品: 470002A - 6001主架套袋件
   工序: 组装
   排程数量: 0.00
   排程日期: 2026-01-03
   来源编号: MPP202512151765751636916848
   主计划产品: null

   【3】组装工序计划:
   编号: RPP2025796645302
   产品: 470001A - 6001背头套袋件
   工序: 组装
   排程数量: 0.00
   排程日期: 2026-01-05
   来源编号: MPP202512151765751636970501
   主计划产品: null

   【4】组装工序计划:
   编号: RPP2025796659784
   产品: 470002A - 6001主架套袋件
   工序: 组装
   排程数量: 0.00
   排程日期: 2026-01-05
   来源编号: MPP202512151765751636972202
   主计划产品: null


📊 步骤6: 数据流完整性统计...

========================================
第1轮: 主生产计划 → 备料计划 (6001A0306)
   备料计划数量: 1 条 ✅

第2轮: 备料计划 → 打包工序计划
   打包工序计划数量: 1 条 ✅

第3轮: 打包工序计划 → 备料计划 (BOM子件)
   备料计划数量: 6 条 ✅
   预期子件: 470001A, 470002A, 511442B
   实际找到: 470001A, 470002A, 511442B (3/3)

第4轮: 备料计划 → 组装工序计划
   组装工序计划数量: 4 条 ✅

========================================
✅ 递归数据流测试完成！
========================================

