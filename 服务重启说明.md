# 企业大脑项目服务重启说明

## 📋 脚本功能

一键重启脚本 `restart-services.sh` 提供以下功能：

- **停止所有服务** - 停止前端和后端的Node.js进程
- **清理缓存** - 清理Vite缓存和构建目录
- **重启服务** - 重新启动后端API服务和前端开发服务器
- **状态检查** - 检查服务运行状态

## 🚀 使用方法

### 基本使用
```bash
# 进入项目根目录
cd /home/sardensy/enterprise-brain/enterpise-brain

# 执行重启脚本（默认重启所有服务）
./restart-services.sh
```

### 具体命令
```bash
# 重启所有服务（默认）
./restart-services.sh restart

# 仅停止所有服务
./restart-services.sh stop

# 仅清理前端缓存
./restart-services.sh clean

# 仅启动所有服务
./restart-services.sh start

# 检查服务状态
./restart-services.sh status

# 显示帮助信息
./restart-services.sh -h
```

## 🌐 服务信息

- **后端服务**：端口 3005，日志文件 `backend/backend.log`
- **前端服务**：端口 5173，日志文件 `07-frontend/frontend.log`
- **PID文件**：服务进程ID保存在 `07-frontend/logs/` 目录

## 📁 项目结构

```
/home/sardensy/enterprise-brain/enterpise-brain/
├── restart-services.sh          # 一键重启脚本
├── 服务重启说明.md              # 使用说明文档
├── backend/                     # 后端代码
│   └── server.js               # 后端主文件
└── 07-frontend/                # 前端代码
    ├── logs/                   # 日志目录
    │   ├── backend.pid         # 后端进程ID
    │   └── frontend.pid        # 前端进程ID
    └── frontend.log            # 前端日志
```

## ⚠️ 注意事项

1. **权限问题**：确保脚本有执行权限，如无权限可运行 `chmod +x restart-services.sh`
2. **依赖检查**：脚本会自动检查并安装缺失的依赖包
3. **日志查看**：如服务启动失败，请查看对应的日志文件
4. **端口占用**：确保3005和5173端口未被其他程序占用

## 🆘 故障排除

### 常见问题

1. **服务启动失败**
   - 检查端口是否被占用：`netstat -tulpn | grep :3005` 或 `netstat -tulpn | grep :5173`
   - 查看日志文件获取详细错误信息

2. **权限不足**
   - 给脚本添加执行权限：`chmod +x restart-services.sh`

3. **依赖安装失败**
   - 手动安装依赖：`cd 07-frontend && npm install` 或 `cd 07-backend && npm install`

### 手动重启步骤

如果脚本无法正常工作，可以手动执行以下步骤：

```bash
# 1. 停止服务
pkill -f "node.*server.js"
pkill -f "npm run dev"

# 2. 清理缓存
cd 07-frontend
rm -rf node_modules/.vite dist

# 3. 启动后端
cd ../07-backend
nohup node --max-old-space-size=512 server.js > backend.log 2>&1 &

# 4. 启动前端
cd ../07-frontend
nohup npm run dev > frontend.log 2>&1 &
```

## 📞 技术支持

如遇到问题无法解决，请检查：
- 系统日志文件
- 项目依赖是否完整
- 网络连接是否正常
- 系统资源是否充足