# Implementation Plan

- [ ] 1. 修复备料计划推送路由逻辑
  - 修改MaterialPreparationPlanService.pushToRealProcessPlan方法，使用source_process字段进行路由决策
  - 移除对产品物料库process_name字段的依赖（仅保留用于获取定时工额等信息）
  - 实现清晰的路由映射表和决策逻辑
  - _Requirements: 1.1, 1.2, 1.3, 1.5_

- [ ] 1.1 编写路由正确性属性测试
  - **Property 1: 来源工序路由正确性**
  - **Validates: Requirements 1.1, 1.2, 1.3**

- [ ] 1.2 编写路由字段使用正确性属性测试  
  - **Property 2: 路由字段使用正确性**
  - **Validates: Requirements 1.5**

- [ ] 2. 完善推送条件验证逻辑
  - 重构推送条件检查，确保逻辑清晰和日志完整
  - 优化不支持工序的处理流程
  - 统一返回值结构，包含详细的状态信息
  - _Requirements: 2.1, 2.2, 2.4, 2.5_

- [ ] 2.1 编写推送条件验证属性测试
  - **Property 3: 推送条件验证**
  - **Validates: Requirements 2.1, 2.4**

- [ ] 2.2 编写不支持工序处理属性测试
  - **Property 4: 不支持工序处理**  
  - **Validates: Requirements 1.4, 2.2**

- [ ] 3. 优化防重复推送机制
  - 修复防重复检查，确保在正确的目标表中查询
  - 根据路由结果动态选择检查表
  - 完善重复检查的返回信息
  - _Requirements: 3.1, 3.2, 3.4, 3.5_

- [ ] 3.1 编写防重复推送机制属性测试
  - **Property 5: 防重复推送机制**
  - **Validates: Requirements 3.1, 3.2, 3.4**

- [ ] 4. 统一错误处理和返回值
  - 标准化所有错误场景的返回值结构
  - 完善错误分类和错误码定义
  - 确保错误信息的一致性和可追踪性
  - _Requirements: 2.5, 3.5_

- [ ] 4.1 编写错误处理一致性属性测试
  - **Property 6: 错误处理一致性**
  - **Validates: Requirements 2.5, 3.5**

- [ ] 5. 更新相关服务和配置
  - 检查并更新所有调用pushToRealProcessPlan的地方
  - 确保路由映射配置的完整性
  - 验证各个工序计划服务的兼容性
  - _Requirements: 1.1, 1.2, 1.3_

- [ ] 6. 第一次检查点 - 确保所有测试通过，询问用户是否有问题
  - 确保所有测试通过，询问用户是否有问题

- [ ] 7. 集成测试和验证
  - 创建端到端测试场景，验证完整的数据流
  - 测试各种边界条件和异常场景
  - 验证与现有系统的兼容性
  - _Requirements: 1.1, 1.2, 1.3, 2.1, 3.1_

- [ ] 7.1 编写集成测试用例
  - 测试完整的备料计划推送流程
  - 验证不同来源工序的路由行为
  - 测试防重复和错误处理机制

- [ ] 8. 性能优化和日志完善
  - 优化路由决策的性能
  - 完善推送过程的日志记录
  - 添加监控和统计信息
  - _Requirements: 4.1, 4.3, 4.5_

- [ ] 9. 最终检查点 - 确保所有测试通过，询问用户是否有问题
  - 确保所有测试通过，询问用户是否有问题