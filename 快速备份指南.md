# 🚨 快速备份指南 - 重装IDE前必读

## ⚡ 3分钟快速备份流程

### 第1步：运行自动备份脚本 ✅ (已完成)

```bash
cd /home/sardenesy/ai_workspaces/ai_desktop_3
./backup-all-data.sh
```

**备份位置**: `/home/sardenesy/enterprise-brain-backup/backup_20251204_152312.tar.gz`

### 第2步：手动备份LocalStorage数据 ⚠️ (必须做！)

**这是最重要的一步！所有业务数据都在这里！**

#### 操作步骤：

1. **打开浏览器，访问**: http://localhost:3001

2. **登录系统**（如果还没登录）

3. **按 F12 键** 打开开发者工具

4. **切换到 Console（控制台）标签**

5. **复制以下代码，粘贴到控制台，按回车**：

```javascript
(function() {
    console.log('🔄 开始导出LocalStorage数据...\n');
    
    const allData = {};
    for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        allData[key] = localStorage.getItem(key);
    }
    
    const exportData = {
        exportTime: new Date().toISOString(),
        totalKeys: Object.keys(allData).length,
        data: allData
    };
    
    console.log('✅ 数据导出完成！');
    console.log(`📊 共 ${exportData.totalKeys} 个数据项`);
    
    // 自动下载备份文件
    const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `localStorage_backup_${new Date().getTime()}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    console.log('✅ 备份文件已自动下载！');
    console.log('📁 文件名: localStorage_backup_*.json');
    console.log('💾 请妥善保存此文件！');
})();
```

6. **保存下载的JSON文件**
   - 文件会自动下载到"下载"文件夹
   - 文件名类似: `localStorage_backup_1733295792000.json`
   - **⚠️ 请复制到安全位置保存！**

---

## 📦 备份文件清单

### ✅ 已自动备份的文件

1. **配置文件**:
   - `.env.development`
   - `.env.production`
   - `database.js`

2. **文档文件**:
   - 所有 `.md` 文档

3. **备份包位置**:
   - `/home/sardenesy/enterprise-brain-backup/backup_20251204_152312.tar.gz`

### ⚠️ 需要手动备份的文件

1. **LocalStorage数据** (最重要！)
   - 按照上面第2步操作
   - 保存下载的 `localStorage_backup_*.json` 文件

2. **数据库文件** (如果存在):
   - 路径: `/home/sardenesy/ai_workspaces/ai_desktop_3/backend/enterprise_brain.db`
   - 如果存在，手动复制保存

---

## 🔄 重装IDE后如何恢复

### 恢复步骤：

1. **安装新IDE，克隆项目代码**

2. **恢复配置文件**:
```bash
# 解压备份包
tar -xzf backup_20251204_152312.tar.gz

# 复制配置文件
cp backup_20251204_152312/configs/.env.* 新项目路径/07-frontend/
cp backup_20251204_152312/configs/database.js 新项目路径/backend/config/
```

3. **启动项目**:
```bash
# 启动前端
cd 新项目路径/07-frontend
npm install
npm run dev

# 启动后端
cd 新项目路径/backend
npm install
npm start
```

4. **恢复LocalStorage数据**:
   - 访问 http://localhost:3001
   - 按 F12 打开控制台
   - 复制以下代码（修改备份数据）：

```javascript
(function() {
    // ⚠️ 将你的备份JSON文件内容粘贴到这里
    const backupData = {
        // 粘贴你保存的localStorage_backup_*.json文件内容
    };
    
    if (!backupData.data) {
        console.error('❌ 请粘贴完整的备份数据！');
        return;
    }
    
    Object.keys(backupData.data).forEach(key => {
        localStorage.setItem(key, backupData.data[key]);
    });
    
    console.log('✅ 数据恢复完成！');
    location.reload();
})();
```

5. **验证数据**:
   - 检查工序列表: http://localhost:3001/manufacturing/process
   - 检查客户台账: http://localhost:3001/sales/orders/customers
   - 检查其他页面数据是否完整

---

## 📋 重要数据项清单

确保这些数据都已备份：

- [ ] `processListData` - 工序列表
- [ ] `processNextId` - 工序ID计数器
- [ ] `capacityLoadData` - 工序能力负荷表
- [ ] `capacityLoadSettings` - 负荷表设置
- [ ] `customerListData` - 客户台账
- [ ] `salesOrderData` - 销售订单
- [ ] `productListData` - 产品手册
- [ ] `materialListData` - 物料库
- [ ] `bomData` - BOM数据
- [ ] `employeeListData` - 员工台账
- [ ] 配置文件（已自动备份）
- [ ] 文档文件（已自动备份）

---

## 🆘 如果忘记备份怎么办？

### 紧急补救措施：

1. **不要关闭浏览器！**
   - LocalStorage数据在浏览器中
   - 关闭浏览器可能丢失数据

2. **立即执行备份脚本**
   - 按照第2步操作
   - 导出LocalStorage数据

3. **检查浏览器缓存**
   - 开发者工具 → Application → Local Storage
   - 手动复制数据

---

## 📞 常见问题

**Q: 自动备份脚本显示"数据库文件不存在"？**

A: 正常，因为数据主要存储在LocalStorage中，不影响备份。

**Q: LocalStorage备份脚本没反应？**

A: 
1. 确保已登录系统
2. 检查控制台是否有错误
3. 刷新页面重试

**Q: 下载的JSON文件很大？**

A: 正常，这说明数据很多，更要妥善保存！

**Q: 恢复后数据不完整？**

A: 
1. 检查备份JSON文件是否完整
2. 确认恢复脚本执行成功
3. 清除浏览器缓存重试

---

## ✅ 最后检查清单

重装IDE前，请确认：

- [ ] 已运行自动备份脚本
- [ ] 已手动导出LocalStorage数据
- [ ] 已保存 `localStorage_backup_*.json` 文件
- [ ] 已将备份文件复制到安全位置
- [ ] 已记录备份文件位置
- [ ] 已阅读恢复指南

---

**备份完成时间**: 2024-12-04 15:23:12

**重要提醒**: 
- ✅ 配置文件已自动备份
- ⚠️ LocalStorage数据必须手动备份
- 💾 备份文件请保存到安全位置
- 🔄 重装前务必完成所有备份步骤

**祝重装顺利！** 🎉
