# å®¢æˆ·äº¤æœŸåˆ°ä¸»ç”Ÿäº§è®¡åˆ’å­—æ®µæ˜ å°„éªŒè¯æŠ¥å‘Š

## ğŸ¯ éœ€æ±‚ç¡®è®¤

**éœ€æ±‚1**: ä¸»ç”Ÿäº§è®¡åˆ’çš„"è®¢å•æ‰¿è¯ºäº¤æœŸ" = è®¢å•åˆ—è¡¨"å®¢æˆ·äº¤æœŸ"
**éœ€æ±‚2**: å‰ç«¯å­—æ®µå¯¹åº”å…³ç³»éªŒè¯

## ğŸ“Š å­—æ®µæ˜ å°„å…³ç³»åˆ†æ

### 1. å‰ç«¯å­—æ®µå®šä¹‰

#### è®¢å•åˆ—è¡¨ (SalesOrderListNew.vue)
```vue
<!-- è¡¨æ ¼åˆ—å®šä¹‰ -->
<el-table-column prop="customerDelivery" label="å®¢æˆ·äº¤æœŸ" width="120">
  <template #default="{ row }">
    {{ formatDateYMD(row.customerDelivery) }}
  </template>
</el-table-column>

<!-- æ•°æ®è·å– -->
customerDeliveryDate: orderData.customer_delivery  // ä»åç«¯APIè·å–
```

#### ä¸»ç”Ÿäº§è®¡åˆ’ (ProductionPlanList.vue)
```vue
<!-- è¡¨æ ¼åˆ—å®šä¹‰ -->
{
  prop: 'promisedDeliveryDate',
  label: 'è®¢å•æ‰¿è¯ºäº¤æœŸ',
  width: 120,
  sortable: true,
  formatter: (row) => this.formatDateYMD(row.promisedDeliveryDate)
}
```

### 2. åç«¯APIå­—æ®µæ˜ å°„

#### æ•°æ®æµè½¬è·¯å¾„
```
è®¢å•åˆ—è¡¨ (å‰ç«¯)
  â†“ customerDeliveryDate (å‘é€åˆ°åç«¯)
åç«¯ masterProductionPlans.js
  â†“ formatDateForMySQL(order.customerDeliveryDate)
  â†“ promisedDeliveryDate (æ’å…¥æ•°æ®åº“)
æ•°æ®åº“ master_production_plans.promised_delivery_date
  â†“
ä¸»ç”Ÿäº§è®¡åˆ’åˆ—è¡¨ (å‰ç«¯) 
  â†“ promisedDeliveryDate (ä»APIè·å–)
```

#### æ ¸å¿ƒæ˜ å°„ä»£ç  (masterProductionPlans.js)
```javascript
// âœ… ä¿®å¤ï¼šè®¢å•æ‰¿è¯ºäº¤æœŸ = å®¢æˆ·äº¤æœŸ (customerDeliveryDate)
const promisedDeliveryDate = formatDateForMySQL(order.customerDeliveryDate);

// æ•°æ®åº“æ’å…¥
const [result] = await connection.execute(`
  INSERT INTO master_production_plans (
    ..., 
    promised_delivery_date,
    ...
  ) VALUES (?, ..., ?, ...)
`, [
  ...,
  promisedDeliveryDate,  // å®¢æˆ·äº¤æœŸæ˜ å°„åˆ°è®¢å•æ‰¿è¯ºäº¤æœŸ
  ...
]);
```

### 3. æ—¥æœŸæ ¼å¼åŒ–å‡½æ•°éªŒè¯

#### formatDateForMySQL å‡½æ•° (å·²ä¼˜åŒ–)
```javascript
function formatDateForMySQL(dateStr) {
  if (!dateStr) return null;
  try {
    // âœ… å¦‚æœå·²ç»æ˜¯YYYY-MM-DDæ ¼å¼ï¼Œç›´æ¥ä½¿ç”¨ï¼ˆé¿å…æ—¶åŒºè½¬æ¢ï¼‰
    if (typeof dateStr === 'string' && /^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
      return dateStr;
    }
    
    // å…¶ä»–æ ¼å¼å¤„ç†...
  } catch (e) {
    console.error('æ—¥æœŸæ ¼å¼åŒ–å¤±è´¥:', dateStr, e);
    return null;
  }
}
```

## âœ… å­—æ®µæ˜ å°„éªŒè¯ç»“æœ

### å­—æ®µå¯¹åº”å…³ç³»ç¡®è®¤

| æ•°æ®æº | å‰ç«¯å­—æ®µ | åç«¯æ¥æ”¶å­—æ®µ | æ•°æ®åº“å­—æ®µ | ç›®æ ‡å­—æ®µ |
|--------|----------|--------------|------------|----------|
| è®¢å•åˆ—è¡¨ | customerDelivery | customerDeliveryDate | - | - |
| ä¸»ç”Ÿäº§è®¡åˆ’ | promisedDeliveryDate | - | promised_delivery_date | âœ… |

### æ•°æ®æµéªŒè¯

1. **å‰ç«¯å‘é€**: `customerDeliveryDate: "2026-01-10"`
2. **åç«¯æ¥æ”¶**: `order.customerDeliveryDate`
3. **åç«¯å¤„ç†**: `formatDateForMySQL(order.customerDeliveryDate)` â†’ `"2026-01-10"`
4. **æ•°æ®åº“å­˜å‚¨**: `promised_delivery_date = "2026-01-10"`
5. **å‰ç«¯æ˜¾ç¤º**: `promisedDeliveryDate = "2026-01-10"`

### åŠŸèƒ½éªŒè¯

âœ… **éœ€æ±‚1**: ä¸»ç”Ÿäº§è®¡åˆ’çš„"è®¢å•æ‰¿è¯ºäº¤æœŸ" = è®¢å•åˆ—è¡¨"å®¢æˆ·äº¤æœŸ"
- å­—æ®µæ˜ å°„: `customerDeliveryDate` â†’ `promised_delivery_date` â†’ `promisedDeliveryDate`
- æ—¥æœŸæ ¼å¼: ä¿æŒ YYYY-MM-DD æ ¼å¼ï¼Œé¿å…æ—¶åŒºè½¬æ¢

âœ… **éœ€æ±‚2**: å‰ç«¯å­—æ®µå¯¹åº”å…³ç³»æ­£ç¡®
- è®¢å•åˆ—è¡¨: `customerDelivery` å¯¹åº”åç«¯ `customer_delivery`
- ä¸»ç”Ÿäº§è®¡åˆ’: `promisedDeliveryDate` å¯¹åº”æ•°æ®åº“ `promised_delivery_date`

## ğŸ”§ ä¿®å¤å†å²

### ä¿®å¤å‰é—®é¢˜
- `formatDateForMySQL` å‡½æ•°ä½¿ç”¨ `new Date()` æ„é€ å‡½æ•°å¯¼è‡´æ—¶åŒºåç§»
- `2026-01-10` å¯èƒ½å˜æˆ `2026-01-09`

### ä¿®å¤åæ”¹è¿›
- ä¼˜å…ˆå¤„ç†çº¯æ—¥æœŸæ ¼å¼å­—ç¬¦ä¸²ï¼Œé¿å…æ—¶åŒºè½¬æ¢
- ç›´æ¥è¿”å› `YYYY-MM-DD` æ ¼å¼ï¼Œä¿æŒæ—¥æœŸä¸€è‡´æ€§
- æ”¹è¿›è®¡åˆ’å…¥åº“æ—¥æœŸè®¡ç®—é€»è¾‘

## ğŸ¯ ç»“è®º

å­—æ®µæ˜ å°„å…³ç³»å·²æ­£ç¡®å®ç°ï¼š

1. âœ… **æ•°æ®æµå®Œæ•´**: è®¢å•åˆ—è¡¨ â†’ åç«¯API â†’ æ•°æ®åº“ â†’ ä¸»ç”Ÿäº§è®¡åˆ’åˆ—è¡¨
2. âœ… **å­—æ®µæ˜ å°„å‡†ç¡®**: `customerDelivery` â†’ `promisedDeliveryDate`
3. âœ… **æ—¥æœŸæ ¼å¼ä¸€è‡´**: ä¿æŒ `YYYY-MM-DD` æ ¼å¼ï¼Œæ— æ—¶åŒºåç§»
4. âœ… **å‰ç«¯æ˜¾ç¤ºæ­£ç¡®**: ä¸¤è¾¹çš„æ—¥æœŸå­—æ®µéƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºç›¸åŒæ—¥æœŸ

**éªŒè¯é€šè¿‡**: è®¢å•åˆ—è¡¨çš„"å®¢æˆ·äº¤æœŸ"èƒ½å¤Ÿæ­£ç¡®æ˜ å°„åˆ°ä¸»ç”Ÿäº§è®¡åˆ’çš„"è®¢å•æ‰¿è¯ºäº¤æœŸ"ï¼Œä¸ä¼šå‡ºç°æ—¥æœŸåå·®é—®é¢˜ã€‚

---

**æµ‹è¯•å»ºè®®**:
1. åœ¨è®¢å•åˆ—è¡¨é€‰æ‹©ä¸åŒæ—¥æœŸçš„é”€å”®è®¢å•
2. ç‚¹å‡»"æ­£å¼ä¸‹å•"åˆ›å»ºä¸»ç”Ÿäº§è®¡åˆ’
3. éªŒè¯ä¸»ç”Ÿäº§è®¡åˆ’ä¸­çš„"è®¢å•æ‰¿è¯ºäº¤æœŸ"æ˜¯å¦ä¸åŸè®¢å•"å®¢æˆ·äº¤æœŸ"å®Œå…¨ä¸€è‡´
4. æ£€æŸ¥è®¡åˆ’å…¥åº“æ—¥æœŸè®¡ç®—æ˜¯å¦æ­£ç¡®ï¼ˆæ‰¿è¯ºäº¤æœŸ - æå‰å…¥åº“æœŸï¼‰