# 企业大脑系统技术栈文档

## 1. 运行环境信息

### 1.1 操作系统
```
Ubuntu 24.04.3 LTS (Noble Numbat)
```

### 1.2 Node.js 环境
```
Node.js 版本: v24.12.0
npm 版本: 11.6.2
```

## 2. 项目概述

基于 UniApp 和 Node.js 的企业大脑系统，包含前端跨平台应用和后端服务，主要功能包括生产计划管理、物料管理、采购管理等企业资源规划功能。

## 3. 项目结构

```
enterprise-brain/
├── backend/              # 后端服务目录
│   ├── config/          # 配置文件
│   ├── controllers/     # 控制器
│   ├── database/        # SQLite数据库文件
│   ├── db/              # 数据库迁移文件
│   ├── migrations/      # 数据库迁移脚本
│   ├── models/          # 数据模型
│   ├── routes/          # API路由
│   ├── scripts/         # 工具脚本
│   ├── services/        # 业务逻辑服务
│   ├── utils/           # 工具函数
│   └── server.js        # 后端入口文件
├── src/                 # 前端UniApp代码
├── package.json         # 项目依赖配置
└── 技术栈文档.md        # 本技术文档
```

## 4. 技术栈详情

### 4.1 前端技术栈
- **框架**: UniApp 3.0.0
- **Vue版本**: Vue 3.4.21
- **构建工具**: Vite 5.2.8
- **语言**: TypeScript 4.9.4
- **UI组件**: @dcloudio/uni-ui 1.5.8
- **云开发**: @cloudbase/js-sdk (腾讯云开发)

### 4.2 后端技术栈
- **运行环境**: Node.js 24.12.0
- **Web框架**: Express 5.1.0
- **数据库**: 
  - SQLite (主数据库)
  - MySQL (可选，配置文件支持)
- **ORM**: 自定义SQL查询
- **工具库**:
  - node-cron: 定时任务
  - uuid: 生成唯一ID
  - cors: 跨域支持

### 4.3 开发工具
- **代码检查**: vue-tsc
- **热重载**: nodemon
- **CSS预处理器**: Sass

## 5. 依赖清单

### 5.1 核心依赖 (dependencies)
```json
{
  "@cloudbase/adapter-uni-app": "^1.0.0-beta.1",
  "@cloudbase/js-sdk": "latest",
  "@dcloudio/uni-app": "3.0.0-4060620250520001",
  "@dcloudio/uni-components": "3.0.0-4060620250520001",
  "better-sqlite3": "^12.5.0",
  "cors": "^2.8.5",
  "express": "^5.1.0",
  "mysql2": "^3.15.3",
  "node-cron": "^4.2.1",
  "sortablejs": "^1.15.6",
  "sqlite3": "^5.1.7",
  "uuid": "^13.0.0",
  "vue": "3.4.21",
  "vue-i18n": "9.14.4",
  "xlsx": "^0.18.5"
}
```

### 5.2 开发依赖 (devDependencies)
```json
{
  "@dcloudio/types": "3.4.15",
  "@dcloudio/uni-automator": "3.0.0-4060620250520001",
  "@dcloudio/vite-plugin-uni": "3.0.0-4070520250711001",
  "@vue/runtime-core": "3.5.17",
  "@vue/tsconfig": "^0.1.3",
  "nodemon": "^3.1.11",
  "sass": "^1.89.2",
  "typescript": "^4.9.4",
  "vite": "5.2.8",
  "vue-tsc": "^1.0.24"
}
```

## 6. 系统重装后恢复步骤

### 6.1 环境搭建

1. **安装Ubuntu 24.04.3 LTS**
   - 选择最小安装或桌面安装
   - 配置网络连接

2. **安装Node.js和npm**
   ```bash
   # 使用nvm安装Node.js (推荐)
   curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash
   source ~/.bashrc
   nvm install v24.12.0
   nvm use v24.12.0
   
   # 验证安装
   node --version  # 应显示 v24.12.0
   npm --version   # 应显示 11.6.2 或更高
   ```

3. **安装git**
   ```bash
   sudo apt update
   sudo apt install git
   ```

### 6.2 项目恢复

1. **克隆代码仓库**
   ```bash
   git clone <仓库地址> /home/sardensy/enterprise-brain/enterpise-brain
   cd /home/sardensy/enterprise-brain/enterpise-brain
   ```

2. **安装依赖**
   ```bash
   npm install
   ```

3. **恢复数据库**
   - 如果使用SQLite，确保`backend/database/enterprise.db`文件存在
   - 如果数据库文件丢失，需要从备份恢复或重新初始化

4. **启动后端服务**
   ```bash
   npm run backend
   # 或使用nodemon进行开发
   npm run dev:backend
   ```

5. **启动前端开发服务器**
   ```bash
   # 启动H5开发环境
   npm run dev:h5
   
   # 或启动微信小程序开发环境
   npm run dev:mp-weixin
   ```

## 7. 常见问题及解决方案

### 7.1 依赖安装失败
- **问题**: npm install 失败，显示依赖冲突
- **解决方案**: 
  ```bash
  # 清除npm缓存
  npm cache clean --force
  
  # 删除node_modules和package-lock.json
  rm -rf node_modules package-lock.json
  
  # 重新安装
  npm install
  ```

### 7.2 数据库连接失败
- **问题**: 后端启动时无法连接数据库
- **解决方案**:
  - 检查SQLite数据库文件是否存在：`backend/database/enterprise.db`
  - 确保数据库文件权限正确：`chmod 644 backend/database/enterprise.db`
  - 检查数据库配置文件：`backend/config/database.js`

### 7.3 端口占用问题
- **问题**: 后端启动失败，显示端口已被占用
- **解决方案**:
  ```bash
  # 查找占用3005端口的进程
  lsof -i :3005
  
  # 终止占用端口的进程
  kill -9 <进程ID>
  
  # 重新启动后端
  npm run backend
  ```

## 8. 维护与更新

### 8.1 数据库备份
- 定期备份SQLite数据库文件：`backend/database/enterprise.db`
- 可使用系统定时任务自动备份

### 8.2 代码更新
```bash
# 拉取最新代码
git pull

# 安装新依赖
npm install

# 重启服务
npm run backend
```

### 8.3 数据库迁移
如果有新的数据库迁移脚本，运行：
```bash
node backend/run-migration.js
```

## 9. 系统服务管理

### 9.1 后端服务启动
```bash
# 启动后端服务
npm run backend

# 开发模式启动（带热重载）
npm run dev:backend
```

### 9.2 前端构建
```bash
# 构建H5版本
npm run build:h5

# 构建微信小程序版本
npm run build:mp-weixin
```

## 10. 联系方式与支持

- 开发团队: [团队名称]
- 技术支持: [联系人信息]
- 文档更新日期: 2025年12月

---

**注意**: 本文档应随系统更新而定期维护，确保环境配置和依赖版本信息的准确性。