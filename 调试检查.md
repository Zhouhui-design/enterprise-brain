# 🔧 调试检查清单

## 问题: 强制刷新后仍无法计算

---

## ✅ 请按顺序执行以下检查步骤:

### 步骤1: 检查浏览器是否加载了最新代码

1. **打开页面**: http://localhost:3004/production-planning/process-plan
2. **打开开发者工具**: 按 F12
3. **切换到 Sources 标签**
4. **找到文件**: 
   - 左侧文件树 → localhost:3004 → src → pages → production-planning → ProcessPlanList.vue
5. **搜索函数**: 按 Ctrl+F 搜索 `calculateRequiredWorkHours`
6. **验证**: 
   - ✅ 能找到该函数 → 代码已加载
   - ❌ 找不到该函数 → 代码未加载(需清除缓存)

---

### 步骤2: 清除浏览器缓存(强制)

**方法1: 硬性刷新**
- Windows/Linux: `Ctrl + Shift + R`
- Mac: `Cmd + Shift + R`

**方法2: 清除缓存并硬性刷新**
1. 按 F12 打开开发者工具
2. 右键点击刷新按钮(地址栏左边)
3. 选择 "清空缓存并硬性刷新"

**方法3: 手动清除**
1. 按 F12 打开开发者工具
2. 切换到 Application 标签
3. 左侧选择 "Storage" 下的 "Clear site data"
4. 点击 "Clear site data" 按钮
5. 刷新页面

---

### 步骤3: 检查控制台是否有JavaScript错误

1. **切换到 Console 标签**
2. **查看是否有红色错误信息**
3. **常见错误**:
   ```
   Uncaught ReferenceError: xxx is not defined
   Uncaught TypeError: Cannot read property 'xxx' of undefined
   Uncaught SyntaxError: Unexpected token
   ```
4. **如果有错误**: 
   - 截图错误信息
   - 发送给我,我会帮您修复

---

### 步骤4: 手动测试函数是否存在

1. **打开 Console 标签**
2. **点击页面上的"新增"按钮**
3. **观察控制台输出**:
   - ✅ 应该看到: `=== handleAdd 被调用 ===`
   - ✅ 应该看到: `设置后的 formData: {...}`
   - ❌ 如果什么都没有 → 函数没有被调用

4. **如果没有任何输出**:
   - 说明代码根本没有加载
   - 或者有JavaScript错误阻止了代码执行

---

### 步骤5: 检查前端服务是否正常运行

```bash
# 检查前端进程
ps aux | grep "npm.*dev" | grep -v grep

# 或者
lsof -i :3004
```

**预期结果**:
- 应该能看到前端服务运行在端口 3004

**如果没有运行**:
```bash
cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend
npm run dev
```

---

### 步骤6: 重启前端服务(如果需要)

```bash
# 停止前端服务
pkill -f "npm.*dev"

# 等待2秒
sleep 2

# 启动前端服务
cd /home/sardenesy/ai_workspaces/ai_desktop_3/07-frontend
nohup npm run dev > /tmp/frontend.log 2>&1 &

# 查看启动日志
tail -f /tmp/frontend.log
```

**等待启动完成**: 看到类似 "Local: http://localhost:3004" 的输出

---

### 步骤7: 验证计算功能

1. **重新打开页面**: http://localhost:3004/production-planning/process-plan
2. **打开 Console 标签**
3. **点击"新增"按钮**
4. **输入测试数据**:
   ```
   需补货数量: 100
   定时工额: 50
   ```
5. **观察控制台输出**:
   ```
   === handleAdd 被调用 ===
   设置后的 formData: {...}
   🔢 计算需求工时: { replenishmentQty: 100, standardWorkQuota: 50 }
   ✅ 需求工时计算结果: 100 / 50 = 2.00
   ```
6. **观察界面**: "需求工时"字段应显示 `2.00`

---

## 🔍 快速诊断命令

**在浏览器Console中执行**:

```javascript
// 1. 检查函数是否存在
console.log('calculateRequiredWorkHours 存在:', typeof calculateRequiredWorkHours !== 'undefined')

// 2. 检查formData是否有值
console.log('formData:', formData)

// 3. 手动触发计算(如果函数存在)
if (typeof calculateRequiredWorkHours !== 'undefined') {
  calculateRequiredWorkHours()
}
```

---

## 📊 预期vs实际对比

### ✅ 正常情况:

**控制台输出**:
```
=== handleAdd 被调用 ===
设置后的 formData: {planNo: "PP2025...", ...}
🔢 计算需求工时: { replenishmentQty: 0, standardWorkQuota: 0 }
⚠️ 需求工时计算条件不满足，设为0
```

**输入数据后**:
```
🔄 需补货数量或定时工额发生变化，重新计算需求工时
🔢 计算需求工时: { replenishmentQty: 100, standardWorkQuota: 50 }
✅ 需求工时计算结果: 100 / 50 = 2.00
```

### ❌ 异常情况:

**情况1: 完全没有输出**
- 原因: 代码未加载或有JavaScript错误
- 解决: 清除缓存、检查错误、重启前端

**情况2: 只有 handleAdd 输出,没有计算输出**
- 原因: calculateRequiredWorkHours 函数未定义
- 解决: 确认代码是否正确保存、重启前端

**情况3: 有计算输出,但界面不显示**
- 原因: v-model绑定问题或字段未渲染
- 解决: 检查表单字段是否正确定义

---

## 🆘 如果以上都无效

请提供以下信息:

1. **控制台完整输出**: 复制所有Console内容
2. **Network标签**: 检查是否有404或500错误
3. **Sources标签截图**: ProcessPlanList.vue 文件内容
4. **操作步骤**: 详细描述您的操作过程
5. **浏览器版本**: Chrome/Firefox/Edge 版本号

---

## 💡 临时调试方案

如果还是不行,可以临时在浏览器Console中手动测试:

```javascript
// 手动设置formData
formData.value = {
  replenishmentQty: 100,
  standardWorkQuota: 50,
  requiredWorkHours: 0
}

// 手动调用计算
const result = 100 / 50
formData.value.requiredWorkHours = parseFloat(result.toFixed(2))
console.log('手动计算结果:', formData.value.requiredWorkHours)
```

这样可以验证数据绑定是否正常。

---

## 📞 需要帮助?

执行完这些步骤后,请告诉我:
- ✅ 哪些步骤成功了
- ❌ 哪些步骤失败了
- 📋 控制台的完整输出

我会根据这些信息进一步帮您诊断! 🔧
