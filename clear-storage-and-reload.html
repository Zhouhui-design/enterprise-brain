<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>æ¸…ç†å¤‡æ–™è®¡åˆ’é…ç½®</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1>å¤‡æ–™è®¡åˆ’é¡µé¢é—®é¢˜ä¿®å¤å·¥å…·</h1>
    
    <h2>ğŸ”§ é—®é¢˜è¯Šæ–­</h2>
    <p>å¦‚æœæ‚¨åœ¨å¤‡æ–™è®¡åˆ’é¡µé¢é‡åˆ°ä»¥ä¸‹é—®é¢˜ï¼š</p>
    <ul>
        <li>æ‰“å¼€é¡µé¢åæ— æ³•åˆ‡æ¢åˆ°å…¶ä»–é¡µé¢</li>
        <li>é¡µé¢æ•°æ®ä¸æ˜¾ç¤ºä½†åç«¯æœ‰æ•°æ®</li>
        <li>æ§åˆ¶å°å‡ºç° "null has no properties" é”™è¯¯</li>
    </ul>
    
    <h2>ğŸ› ï¸ è‡ªåŠ¨ä¿®å¤</h2>
    <button onclick="clearStorage()" class="primary-button">
        æ¸…ç†localStorageé…ç½®
    </button>
    
    <div id="result" class="result-container"></div>
    
    <h2>ğŸ“‹ æ‰‹åŠ¨æ“ä½œæ­¥éª¤</h2>
    <ol>
        <li>ç‚¹å‡»ä¸Šé¢çš„"æ¸…ç†localStorageé…ç½®"æŒ‰é’®</li>
        <li>ç­‰å¾…æ¸…ç†å®Œæˆ</li>
        <li>åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ˆF5ï¼‰</li>
        <li>é‡æ–°è®¿é—®å¤‡æ–™è®¡åˆ’é¡µé¢</li>
        <li>å¦‚æœé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œè¯·æŒ‰F12æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯</li>
    </ol>
    
    <h2>ğŸš€ å¿«é€Ÿå¯¼èˆª</h2>
    <p>ä¿®å¤å®Œæˆåï¼Œç‚¹å‡»ä»¥ä¸‹é“¾æ¥æµ‹è¯•ï¼š</p>
    <ul>
        <li><a href="http://localhost:3004/production-planning/material-preparation-new" target="_blank" rel="noopener">å¤‡æ–™è®¡åˆ’é¡µé¢</a></li>
        <li><a href="http://localhost:3004/bom/production" target="_blank" rel="noopener">ç”Ÿäº§BOMé¡µé¢</a></li>
    </ul>
    
    <script>
        function clearStorage() {
            const result = document.getElementById('result')
            result.innerHTML = '<p>ğŸ”„ æ­£åœ¨æ¸…ç†é…ç½®...</p>'
            
            try {
                const keysToRemove = [
                    'material-preparation_columns',
                    'material-preparation_business_vars',
                    'material-preparation_workflow_configs',
                    'material-preparation_code_rules'
                ]
                
                let successCount = 0
                let errorCount = 0
                let errorDetails = []
                
                keysToRemove.forEach(key => {
                    try {
                        localStorage.removeItem(key)
                        successCount++
                        console.log(`âœ… å·²åˆ é™¤: ${key}`)
                    } catch (error) {
                        errorCount++
                        errorDetails.push(`${key}: ${error.message}`)
                        console.error(`âŒ åˆ é™¤å¤±è´¥: ${key}`, error)
                    }
                })
                
                const resultHtml = `
                    <h3>ğŸ“Š æ¸…ç†ç»“æœ</h3>
                    <p>âœ… æˆåŠŸæ¸…ç†: ${successCount} é¡¹</p>
                    <p>âŒ æ¸…ç†å¤±è´¥: ${errorCount} é¡¹</p>
                    ${errorDetails.length > 0 ? '<p>âŒ é”™è¯¯è¯¦æƒ…:</p><ul>' + errorDetails.map(detail => '<li>' + detail + '</li>').join('') + '</ul>' : ''}
                    <p><strong>ğŸ¯ æ¸…ç†å®Œæˆï¼è¯·åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼ˆæŒ‰F5ï¼‰</strong></p>
                `
                
                result.innerHTML = resultHtml
                
                // 3ç§’åè‡ªåŠ¨æç¤ºåˆ·æ–°
                setTimeout(() => {
                    result.innerHTML += '<p style="color: #E6A23C;">ğŸ’¡ å»ºè®®ç°åœ¨åˆ·æ–°é¡µé¢ï¼ˆæŒ‰F5ï¼‰</p>'
                }, 3000)
                
            } catch (error) {
                result.innerHTML = `<p style="color: #F56C6C;">âŒ æ¸…ç†è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯: ${error.message}</p>`
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥localStorageçŠ¶æ€
        window.onload = function() {
            const materialKeys = [
                'material-preparation_columns',
                'material-preparation_business_vars',
                'material-preparation_workflow_configs',
                'material-preparation_code_rules'
            ]
            
            let existingKeys = materialKeys.filter(key => localStorage.getItem(key))
            
            if (existingKeys.length > 0) {
                document.getElementById('result').innerHTML = `
                    <p style="color: #E6A23C;">âš ï¸ æ£€æµ‹åˆ° ${existingKeys.length} ä¸ªå¤‡æ–™è®¡åˆ’ç›¸å…³çš„localStorageé…ç½®é¡¹ï¼š</p>
                    <ul>${existingKeys.map(key => '<li>' + key + '</li>').join('')}</ul>
                    <p>è¿™äº›é…ç½®å¯èƒ½å¯¼è‡´é¡µé¢é—®é¢˜ï¼Œå»ºè®®ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ¸…ç†ã€‚</p>
                `
            } else {
                document.getElementById('result').innerHTML = `
                    <p style="color: #67C23A;">âœ… æœªæ£€æµ‹åˆ°å¼‚å¸¸çš„localStorageé…ç½®</p>
                    <p>å¦‚æœé¡µé¢ä»æœ‰é—®é¢˜ï¼Œå¯èƒ½æ˜¯å…¶ä»–åŸå› é€ æˆçš„ã€‚</p>
                `
            }
        }
    </script>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        h1, h2 {
            color: #303133;
        }
        
        .primary-button {
            background: #409EFF;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .primary-button:hover {
            background: #66b1ff !important;
        }
        
        .result-container {
            margin-top: 20px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 4px;
        }
        
        a {
            color: #409EFF;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
    </style>
</body>
</html>