# âœ… ç‰©æ–™åˆ—è¡¨å­—æ®µæ˜ å°„ä¿®å¤å®ŒæˆæŠ¥å‘Š

## é—®é¢˜æè¿°
è®¿é—® http://localhost:3003/material/list é¡µé¢æ—¶ï¼š
- âœ… **æ€»è®°å½•æ•°**ï¼š756æ¡ï¼ˆæ­£å¸¸ï¼‰
- âœ… **éƒ¨åˆ†åˆ—æ­£å¸¸**ï¼šåºå·ã€å‹å·ã€æ¥æºã€æœ€å°åŒ…è£…é‡
- âŒ **ç©ºç™½å­—æ®µ**ï¼šç‰©æ–™ç¼–å·ã€ç‰©æ–™åç§°ç­‰å…¶ä»–æ ¸å¿ƒåˆ—

### æ§åˆ¶å°é”™è¯¯
```
ç‰©æ–™ undefined çš„sourceå­—æ®µJSONè§£æå¤±è´¥ï¼Œä½¿ç”¨é€—å·åˆ†å‰²: è‡ªåˆ¶
ç‰©æ–™ undefined çš„sourceå­—æ®µJSONè§£æå¤±è´¥ï¼Œä½¿ç”¨é€—å·åˆ†å‰²: å¤–è´­
```

## é—®é¢˜æ ¹æºåˆ†æ

### 1. åç«¯APIè¿”å›çš„æ•°æ®ç»“æ„
```json
{
  "id": 1513,
  "material_code": "å‡çš„04",           // â† snake_case
  "material_name": "æµ‹è¯•SOPæ˜¯å¦åœ¨æ‰‹æœºç«¯æŸ¥çœ‹",
  "materialCode": "å‡çš„04",            // â† camelCase
  "materialName": "æµ‹è¯•SOPæ˜¯å¦åœ¨æ‰‹æœºç«¯æŸ¥çœ‹"
}
```

**å‘ç°ï¼šåç«¯åŒæ—¶è¿”å›äº†ä¸¤å¥—å­—æ®µå‘½åï¼**

### 2. åç«¯ä»£ç ç¡®è®¤
ğŸ“ `backend/services/materialService.js:15-42`
```javascript
return rows.map(row => ({
  ...row,  // â† ä¿ç•™åŸå§‹snake_caseå­—æ®µ
  materialCode: row.material_code,  // â† æ–°å¢camelCaseå­—æ®µ
  bomNumber: row.bom_number,
  materialName: row.material_name,
  // ... å…¶ä»–å­—æ®µæ˜ å°„
}));
```

### 3. å‰ç«¯è½¬æ¢å‡½æ•°çš„é—®é¢˜
ğŸ“ `07-frontend/src/services/api/materialApiService.js:31-91`

**ä¿®å¤å‰çš„é”™è¯¯é€»è¾‘**ï¼š
```javascript
convertToCamelCase(obj) {
  return {
    id: obj.id,
    materialCode: obj.material_code,  // âŒ åªä»snake_caseè¯»å–
    materialName: obj.material_name,  // âŒ å¦‚æœä¸å­˜åœ¨å°±æ˜¯undefined
    // ...
  }
}
```

**é—®é¢˜**ï¼š
- å‰ç«¯å¼ºåˆ¶ä»`obj.material_code`è¯»å–ï¼Œå¿½ç•¥äº†åç«¯å·²æä¾›çš„`obj.materialCode`
- å½“`obj.material_code`ä¸ºundefinedæ—¶ï¼Œå¯¼è‡´æ‰€æœ‰å­—æ®µä¸ºç©º

## ä¿®å¤æ–¹æ¡ˆ

### ä¿®æ”¹æ–‡ä»¶
ğŸ“ `07-frontend/src/services/api/materialApiService.js`

### ä¿®å¤ä»£ç 
```javascript
convertToCamelCase(obj) {
  if (!obj) return obj
  
  // å®‰å…¨è§£æsourceå­—æ®µ
  let sourceValue = []
  const sourceField = obj.source
  if (sourceField) {
    if (typeof sourceField === 'string') {
      try {
        const trimmed = sourceField.trim()
        if (trimmed && trimmed !== '[]' && trimmed !== '') {
          sourceValue = JSON.parse(trimmed)
        }
      } catch (error) {
        // âœ… ä¿®å¤ï¼šä½¿ç”¨å·²å­˜åœ¨çš„materialCodeæˆ–fallbackåˆ°material_code
        const materialCode = obj.materialCode || obj.material_code || 'unknown'
        console.warn(`ç‰©æ–™ ${materialCode} çš„sourceå­—æ®µJSONè§£æå¤±è´¥ï¼Œä½¿ç”¨é€—å·åˆ†å‰²: ${sourceField}`)
        sourceValue = sourceField.split(',').map(s => s.trim()).filter(s => s)
      }
    } else if (Array.isArray(sourceField)) {
      sourceValue = sourceField
    }
  }
  
  // âœ… æ ¸å¿ƒä¿®å¤ï¼šä¼˜å…ˆä½¿ç”¨camelCaseå­—æ®µï¼Œfallbackåˆ°snake_case
  return {
    id: obj.id,
    materialCode: obj.materialCode || obj.material_code,  // âœ…
    bomNumber: obj.bomNumber || obj.bom_number,  // âœ…
    materialName: obj.materialName || obj.material_name,  // âœ…
    sizeSpec: obj.sizeSpec || obj.size_spec,  // âœ…
    color: obj.color,
    material: obj.material,
    majorCategory: obj.majorCategory || obj.major_category,  // âœ…
    middleCategory: obj.middleCategory || obj.middle_category,  // âœ…
    minorCategory: obj.minorCategory || obj.minor_category,  // âœ…
    model: obj.model,
    series: obj.series,
    source: sourceValue,
    description: obj.description,
    materialImage: obj.materialImage || obj.material_image,  // âœ…
    baseUnit: obj.baseUnit || obj.base_unit,  // âœ…
    saleUnit: obj.saleUnit || obj.sale_unit,  // âœ…
    saleConversionRate: obj.saleConversionRate || obj.sale_conversion_rate,  // âœ…
    purchaseUnit: obj.purchaseUnit || obj.purchase_unit,  // âœ…
    purchaseConversionRate: obj.purchaseConversionRate || obj.purchase_conversion_rate,  // âœ…
    kgPerPcs: obj.kgPerPcs || obj.kg_per_pcs,  // âœ…
    pcsPerKg: obj.pcsPerKg || obj.pcs_per_kg,  // âœ…
    processName: obj.processName || obj.process_name,  // âœ…
    outputProcessName: obj.outputProcessName || obj.output_process_name || '',  // âœ…
    standardTime: obj.standardTime || obj.standard_time,  // âœ…
    quotaTime: obj.quotaTime || obj.quota_time,  // âœ…
    minimumPackagingQuantity: parseFloat(obj.minimumPackagingQuantity || obj.minimum_packaging_quantity) || 1,  // âœ…
    processPrice: parseFloat(obj.processPrice || obj.process_price) || 0,  // âœ…
    materialLoss: obj.materialLoss || obj.material_loss,  // âœ…
    purchaseCycle: obj.purchaseCycle || obj.purchase_cycle,  // âœ…
    purchasePrice: parseFloat(obj.purchasePrice || obj.purchase_price) || 0,  // âœ…
    basePrice: parseFloat(obj.basePrice || obj.base_price) || 0,  // âœ…
    status: obj.status,
    createTime: obj.createTime || obj.created_at,  // âœ…
    updateTime: obj.updateTime || obj.updated_at  // âœ…
  }
}
```

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
```
æ§åˆ¶å°é”™è¯¯ï¼š
  ç‰©æ–™ undefined çš„sourceå­—æ®µJSONè§£æå¤±è´¥
  
é¡µé¢æ˜¾ç¤ºï¼š
  âœ… æ€»è®°å½•æ•°ï¼š756æ¡
  âœ… åºå·ã€å‹å·ï¼šæ­£å¸¸
  âŒ ç‰©æ–™ç¼–å·ï¼šç©ºç™½
  âŒ ç‰©æ–™åç§°ï¼šç©ºç™½
  âŒ å…¶ä»–æ ¸å¿ƒå­—æ®µï¼šç©ºç™½
```

### ä¿®å¤åï¼ˆé¢„æœŸï¼‰
```
æ§åˆ¶å°é”™è¯¯ï¼š
  âœ… æ— é”™è¯¯ï¼ˆæˆ–æ˜¾ç¤ºæ­£ç¡®çš„ç‰©æ–™ç¼–å·ï¼‰
  
é¡µé¢æ˜¾ç¤ºï¼š
  âœ… æ€»è®°å½•æ•°ï¼š756æ¡
  âœ… åºå·ã€å‹å·ï¼šæ­£å¸¸
  âœ… ç‰©æ–™ç¼–å·ï¼šæ˜¾ç¤ºå®Œæ•´
  âœ… ç‰©æ–™åç§°ï¼šæ˜¾ç¤ºå®Œæ•´
  âœ… æ‰€æœ‰å­—æ®µï¼šæ•°æ®å®Œæ•´
```

## æŠ€æœ¯è¦ç‚¹

### 1. å­—æ®µä¼˜å…ˆçº§ç­–ç•¥
```javascript
materialCode: obj.materialCode || obj.material_code
```
- **ä¼˜å…ˆ**ï¼šä½¿ç”¨åç«¯å·²è½¬æ¢çš„camelCaseå­—æ®µ
- **Fallback**ï¼šå¦‚æœä¸å­˜åœ¨ï¼Œæ‰ä½¿ç”¨snake_caseå­—æ®µ
- **å…¼å®¹æ€§**ï¼šæ”¯æŒåç«¯ä»»æ„æ—¶åˆ»ç§»é™¤å†—ä½™å­—æ®µ

### 2. ç±»å‹å®‰å…¨å¤„ç†
```javascript
minimumPackagingQuantity: parseFloat(obj.minimumPackagingQuantity || obj.minimum_packaging_quantity) || 1
```
- åŒæ—¶å°è¯•è¯»å–ä¸¤ç§å‘½å
- è§£æä¸ºæµ®ç‚¹æ•°
- é»˜è®¤å€¼ä¸º1

### 3. Sourceå­—æ®µç‰¹æ®Šå¤„ç†
```javascript
const materialCode = obj.materialCode || obj.material_code || 'unknown'
console.warn(`ç‰©æ–™ ${materialCode} çš„sourceå­—æ®µJSONè§£æå¤±è´¥...`)
```
- ä¿®å¤äº†æ—¥å¿—ä¸­æ˜¾ç¤º"undefined"çš„é—®é¢˜
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯

## éªŒè¯æ­¥éª¤

### 1. åˆ·æ–°æµè§ˆå™¨
è®¿é—®ï¼šhttp://localhost:3003/material/list

### 2. æ£€æŸ¥è¡¨æ ¼åˆ—
- [ ] ç‰©æ–™ç¼–å·åˆ—æœ‰æ•°æ®
- [ ] ç‰©æ–™åç§°åˆ—æœ‰æ•°æ®
- [ ] å°ºå¯¸è§„æ ¼åˆ—æœ‰æ•°æ®
- [ ] å¤§ç±»/ä¸­ç±»/å°ç±»åˆ—æœ‰æ•°æ®
- [ ] æ‰€æœ‰756æ¡è®°å½•å®Œæ•´æ˜¾ç¤º

### 3. æ£€æŸ¥æ§åˆ¶å°
- [ ] æ— "undefined"é”™è¯¯
- [ ] Sourceå­—æ®µè§£æè­¦å‘Šæ˜¾ç¤ºæ­£ç¡®çš„ç‰©æ–™ç¼–å·

## å­—æ®µæ˜ å°„å®Œæ•´æ¸…å•

| å‰ç«¯å­—æ®µï¼ˆcamelCaseï¼‰ | åç«¯å­—æ®µï¼ˆsnake_caseï¼‰ | çŠ¶æ€ |
|---|---|---|
| materialCode | material_code | âœ… |
| bomNumber | bom_number | âœ… |
| materialName | material_name | âœ… |
| sizeSpec | size_spec | âœ… |
| majorCategory | major_category | âœ… |
| middleCategory | middle_category | âœ… |
| minorCategory | minor_category | âœ… |
| materialImage | material_image | âœ… |
| baseUnit | base_unit | âœ… |
| saleUnit | sale_unit | âœ… |
| saleConversionRate | sale_conversion_rate | âœ… |
| purchaseUnit | purchase_unit | âœ… |
| purchaseConversionRate | purchase_conversion_rate | âœ… |
| kgPerPcs | kg_per_pcs | âœ… |
| pcsPerKg | pcs_per_kg | âœ… |
| processName | process_name | âœ… |
| outputProcessName | output_process_name | âœ… |
| standardTime | standard_time | âœ… |
| quotaTime | quota_time | âœ… |
| minimumPackagingQuantity | minimum_packaging_quantity | âœ… |
| processPrice | process_price | âœ… |
| materialLoss | material_loss | âœ… |
| purchaseCycle | purchase_cycle | âœ… |
| purchasePrice | purchase_price | âœ… |
| basePrice | base_price | âœ… |
| createTime | created_at | âœ… |
| updateTime | updated_at | âœ… |

## åç»­ä¼˜åŒ–å»ºè®®

### 1. åç«¯ç»Ÿä¸€è¿”å›æ ¼å¼ï¼ˆå¯é€‰ï¼‰
ğŸ“ `backend/services/materialService.js`
```javascript
// é€‰é¡¹Aï¼šä»…è¿”å›camelCaseï¼Œç§»é™¤snake_caseå†—ä½™
return rows.map(row => ({
  id: row.id,
  materialCode: row.material_code,
  materialName: row.material_name,
  // ... ä¸ä½¿ç”¨å±•å¼€è¿ç®—ç¬¦
}));
```

### 2. å‰ç«¯ç§»é™¤è½¬æ¢å‡½æ•°ï¼ˆæœªæ¥ï¼‰
å½“åç«¯å®Œå…¨ç»Ÿä¸€ä¸ºcamelCaseåï¼Œå‰ç«¯å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼š
```javascript
async getAllMaterials() {
  const data = await materialAPI.getAllMaterials()
  return data  // æ— éœ€è½¬æ¢
}
```

## æ€»ç»“

âœ… **é—®é¢˜æ ¹æº**ï¼šå‰ç«¯è½¬æ¢å‡½æ•°åªè¯»å–snake_caseå­—æ®µï¼Œå¿½ç•¥åç«¯å·²æä¾›çš„camelCaseå­—æ®µ  
âœ… **ä¿®å¤æ–¹æ¡ˆ**ï¼šä¼˜å…ˆä½¿ç”¨camelCaseï¼Œfallbackåˆ°snake_case  
âœ… **å½±å“èŒƒå›´**ï¼šç‰©æ–™åˆ—è¡¨æ‰€æœ‰å­—æ®µæ­£å¸¸æ˜¾ç¤º  
âœ… **å…¼å®¹æ€§**ï¼šæ”¯æŒåç«¯ä»»æ„å­—æ®µå‘½åç­–ç•¥  
âœ… **æ— å‰¯ä½œç”¨**ï¼šä¸å½±å“å…¶ä»–åŠŸèƒ½  

---
**ä¿®å¤å®Œæˆæ—¶é—´**ï¼š2025-12-29  
**ä¿®å¤æ–‡ä»¶**ï¼š`07-frontend/src/services/api/materialApiService.js`  
**æµ‹è¯•çŠ¶æ€**ï¼šâœ… å·²ä¿®å¤ï¼Œå¾…æµè§ˆå™¨éªŒè¯
